//A5, Copyright (c) 2011, Jeff dePascale & Brian Sutliffe. http://www.jeffdepascale.com(function(a,b){a.Package("a5.cl").Extends("a5.cl.CLBase").Prototype("CLMVCBase",function(c){c.CLMVCBase=function(){c.superclass(this)};c.mvcName=function(){return this._cl_mvcName||this.instanceUID()};c.redirect=function(f,e,d){this.MVC().redirect(f,e,d)};c._cl_setMVCName=function(d){this._cl_mvcName=d}});a.Package("a5.cl.mvc").Extends("a5.Attribute").Class("InferRenderAttribute",function(c){c.InferRenderAttribute=function(){c.superclass(this)};c.Override.methodPre=function(i,g,j,d,h,f){var e=d.getName(),k=e.substr(0,1).toUpperCase()+e.substr(1)+"Controller";var l=i[0].im[k].instance(true);l.index.apply(l,g);j.render(l);return a.Attribute.SUCCESS}});a.Package("a5.cl.mvc").Extends("a5.Event").Static(function(c){c.VIEW_READY="clViewReady"}).Prototype("CLViewEvent",function(c){c.CLViewEvent=function(){c.superclass(this)}});a.Package("a5.cl.mvc").Extends("a5.Event").Static(function(c){c.CHILDREN_READY="childrenReady";c.LOADER_STATE_CHANGE="loaderStateChange";c.WILL_REMOVE_VIEW="willRemoveView";c.WILL_ADD_VIEW="willAddView";c.VIEW_ADDED="viewAdded";c.VIEW_REMOVED="viewRemoved"}).Prototype("CLViewContainerEvent",function(c){c.CLViewContainerEvent=function(){c.superclass(this)}});a.Package("a5.cl.mvc.core").Import("a5.cl.CLEvent").Extends("a5.cl.CLMVCBase").Class("RedrawEngine","singleton final",function(n,k){var m,e=[],j=false,h,c,i;this.RedrawEngine=function(){n.superclass(this);m=n.cl().MVC().application().view();i=a.cl.core.Utils.getVendorWindowMethod("requestAnimationFrame");n.cl().addEventListener(k.CLEvent.PLUGINS_LOADED,d)};var d=function(){n.cl().removeEventListener(k.CLEvent.PLUGINS_LOADED,d);if(n.cl().plugins().PerformanceTester){h=n.cl().plugins().PerformanceTester().createTimer("redraw")}};this.loaderWentIdle=function(o){l(o)};this.attemptRedraw=function(o){var p=o||n;l(p)};this.triggerAppRedraw=function(o){j=o||j;f()};var l=function(r){var p=true,q,o;for(q=0,o=e.length;q<o;q++){if(r==e[q]||r.isChildOf(e[q])){p=false;break}}if(p){for(q=0;q<e.length;q++){if(e[q].isChildOf(r)){e.splice(q,1);q--}}e.push(r)}f()};var f=function(){if(!c&&(e.length||j)){c=true;if(i){i(g)}else{n.cl().addEventListener(k.CLEvent.GLOBAL_UPDATE_TIMER_TICK,g)}}};var g=function(){if(!i){n.cl().removeEventListener(k.CLEvent.GLOBAL_UPDATE_TIMER_TICK,g)}if(h){h.startTest()}var p=j;j=false;if(p){m._cl_redraw(p);e=[]}else{while(e.length){var o=e.shift();o._cl_redraw(false)}}if(h){h.completeTest()}c=false}});a.SetNamespace("a5.cl.mvc.core.AppSetup",{genericSetup:function(){a.cl.instance().MVC().setTitle()},desktopSetup:function(){if(a.cl.instance().config().faviconPath){var c=document.getElementsByTagName("head")[0],d=document.createElement("link");d.rel="shortcut icon";d.href=a.cl.instance().config().faviconPath;d.type="image/x-icon";c.appendChild(d);d=null}if(a.cl.instance().config().forceIE7){var c=document.getElementsByTagName("head")[0],d=document.createElement("meta");d.httpEquiv="X-UA-Compatible";d.content="IE=7";c.appendChild(d);d=null}this.genericSetup()},mobileSetup:function(){var c=document.getElementsByTagName("head")[0],d=document.createElement("meta");d.name="viewport";d.content="width=device-width, minimum-scale=1, maximum-scale=1";c.appendChild(d);this.genericSetup();d=null},tabletSetup:function(){this.mobileSetup()}});a.Package("a5.cl.mvc.core").Import("a5.cl.CLEvent").Extends("a5.cl.CLMVCBase").Class("LocationManager","singleton final",function(d,c){var g;var e;var f;this.LocationManager=function(){d.superclass(this);g=a.cl.mvc.core.Mappings.instance();e=a.cl.mvc.core.Filters.instance();f=d.plugins().HashManager()};this._renderError=function(h,j){d.cl().dispatchEvent(c.CLEvent.APPLICATION_ERROR,{errorType:h,info:j});var k;switch(h){case 404:k='Resource not found: "'+(j.toString().length?j.toString():"/")+'"';break;case 500:if(!j._a5_initialized){j=d.create(a.Error,[j])}k=j.toString();break;default:k="Error loading resource.";break}var i=g.getErrorSignature(h);if(i){i.id=[k,j];d.redirect(i)}else{d.MVC().application()._cl_renderError(h,k,j)}};this.Override.redirect=function(l,k,j){var h=true;var i=typeof l;if(i=="string"&&l.indexOf("://")!=-1){l={url:l};i="object"}if(l instanceof Array){f.setHash(l,false,j)}if(l.hash!=b){f.setHash(l.hash,false,j)}else{if(i=="string"){f.setHash(l,false,j)}else{if(i=="number"){d._renderError(l,k)}else{if(l.url){window.location=l.url}else{h=false}}}}if(!h){if(l.forceHash!=b){f.setHash(l.forceHash,true)}if(l.controller!=b){this.processMapping(l)}}};this.processMapping=function(o){var k=g.geLastCallSignature();if(Object.prototype.toString.call(o)==="[object Array]"){var n=g.getCallSignature(o);if(n){e.test(n,k,function(i){if(i){d.dispatchEvent("CONTROLLER_CHANGE",{controller:n.controller,action:n.action,id:n.id})}})}else{var m="";for(var j=0,h=o.length;j<h;j++){m+=o[j]+(j<(h-1)?"/":"")}d._renderError(404,m)}}else{e.test(o,k,function(i){if(i){d.dispatchEvent("CONTROLLER_CHANGE",{controller:o.controller,action:o.action,id:o.id})}})}}});a.Package("a5.cl.mvc.core").Extends("a5.cl.CLViewContainer").Class("WindowContainer",function(d,c){d.WindowContainer=function(){d.superclass(this)}});a.Package("a5.cl.mvc.core").Extends("a5.cl.CLViewContainer").Prototype("AppViewContainer","singleton final",function(d,c){d.AppViewContainer=function(){d.superclass(this);this._cl_errorStopped=false;this._cl_systemWindowContainer=this.create(c.WindowContainer);this._cl_systemWindowContainer.hide();this._cl_appWindowContainer=this.create(c.WindowContainer);this._cl_appWindowContainer.hide();this._cl_appWindowContainer.showOverflow(true);this._cl_appWindowLoadingContainer=this.create(c.WindowContainer);this.showOverflow(true);this._cl_addedToTree()};d.Override.addSubView=d.Override.removeSubView=d.Override.subViewToTop=d.Override.subViewToBottom=d.Override.removeAllSubViews=d.Override.removeViewAtIndex=d.Override.replaceView=d.Override.replaceViewAtIndex=d.Override.swapViewsAtIndex=d.Override.addSubViewAtIndex=d.Override.addSubViewBelow=d.Override.addSubViewAbove=function(){this.throwError("View manipulations on AppViewContainer must use addWindow and removeWindow methods only.")};d.containsWindow=function(e){var f=this._cl_appWindowContainer.containsSubView(e);if(f){return true}return this._cl_systemWindowContainer.containsSubView(e)};d.addWindow=function(n){if(!this._cl_errorStopped){if(n instanceof a.cl.CLWindow){var f=a.cl.CLWindowLevel,g=n._cl_windowLevel;if(g===f.SYSTEM){var k=this._cl_systemWindowContainer.subViewCount();if(k>0){if(this._cl_systemWindowContainer.subViewAtIndex(0).blocking()){return this.throwError("system window blocking error")}else{this._cl_systemWindowContainer.replaceViewAtIndex(n,0)}}else{this._cl_systemWindowContainer.addSubView(n)}this._cl_systemWindowContainer.show()}else{var e=this._cl_appWindowContainer,m=0,o=false;if(e.containsSubView(n)){e.removeSubView(n,false)}for(var j=0,h=e.subViewCount();j<h;j++){var p=e.subViewAtIndex(j);if(p._cl_windowLevel===f.APPLICATION){m=j+1}else{if(p._cl_windowLevel===g){m=j;o=true}}}if((g===f.APPLICATION||e.subViewCount()===0)||!o){this._cl_appWindowContainer.addSubViewAtIndex(n,m)}else{this._cl_appWindowContainer.replaceViewAtIndex(n,m)}}}else{self.redirect(500,"Application addSubView only accepts views that subclass a5.cl.CLWindow")}}};d.removeWindow=function(f,e){if(f){if(this._cl_appWindowContainer.containsSubView(f)){this._cl_appWindowContainer.removeSubView(f,e)}else{if(this._cl_systemWindowContainer.containsSubView(f)){this._cl_systemWindowContainer.removeSubView(f,e);this._cl_systemWindowContainer.hide()}else{this.throwError('Cannot remove window "'+f.instanceUID()+'", window is not currently a child of AppViewContainer.')}}}};d._cl_initialRenderCompete=function(){this._cl_appWindowContainer.show();this.superclass().removeSubView.call(this,this._cl_appWindowLoadingContainer)};d.Override.viewReady=function(){};d.Override.width=function(e){return this.cl().MVC().envManager().windowProps().width};d.Override.height=function(e){return this.cl().MVC().envManager().windowProps().height};d.Override._cl_redraw=function(i){var j=this._cl_systemWindowContainer.subViewAtIndex(0),k=null;if(j&&j.offsetsApplication()!==a.cl.mvc.core.SystemWindow.OFFSET_NONE){didRedrawSysWin=true;this._cl_systemWindowContainer.height(j.height("value")==="100%"?"100%":"auto");this._cl_systemWindowContainer._cl_redraw(i);k=j.height()}else{this._cl_systemWindowContainer._cl_redraw(i)}if(k!==null){var e=this.height()-this._cl_systemWindowContainer.height();if(j.offsetsApplication()===a.cl.mvc.core.SystemWindow.OFFSET_TOP){this._cl_appWindowContainer.y(k).height(e);this._cl_systemWindowContainer.y(0)}else{this._cl_appWindowContainer.y(0).height(e);var g=this.height()-k;this._cl_systemWindowContainer.y(this.height()-k);this._cl_systemWindowContainer._cl_redraw(i)}}this._cl_appWindowContainer._cl_redraw(i)};d.Override.redraw=function(){this.cl().MVC().redrawEngine().attemptRedraw(this)};d.Override.draw=function(){var e=document.getElementsByTagName("body")[0];e.style.margin=e.style.padding=0;e.style.overflow="hidden";d.superclass().draw.call(this);this._cl_viewElement.style.width=this._cl_viewElement.style.height="100%";this._cl_width.percent=this._cl_height.percent=1;this._cl_width.value=this._cl_height.value="100%";e.appendChild(this._cl_viewElement);this._cl_viewElement.style.display="block";d.superclass().addSubView.call(this,this._cl_appWindowContainer);d.superclass().addSubView.call(this,this._cl_appWindowLoadingContainer);d.superclass().addSubView.call(this,this._cl_systemWindowContainer)}});a.Package("a5.cl.mvc.core").Extends("a5.cl.CLWindow").Static(function(c){c.OFFSET_TOP="systemWindowOffsetTop";c.OFFSET_BOTTOM="systemWindowOffsetBottom";c.OFFSET_NONE="systemWindowOffsetNone"}).Prototype("SystemWindow",function(d,c,e){this.Properties(function(){this._cl_blocking=false;this._cl_offsetsApplication=e.OFFSET_NONE});d.SystemWindow=function(){d.superclass(this);this._cl_windowLevel=a.cl.CLWindowLevel.SYSTEM};d.showWindow=function(){this.cl().application().view().addWindow(this)};d.blocking=function(f){if(f!==b){this._cl_blocking=f;return this}return this._cl_blocking};d.offsetsApplication=function(f){if(f!==b){this._cl_offsetsApplication=f;return}return this._cl_offsetsApplication}});a.Package("a5.cl").Import("a5.cl.CLEvent","a5.cl.mvc.CLViewEvent").Extends("CLMVCBase").Static(function(d,c){d.customViewDefNodes=["EventListener","Bind"];d._cl_calcOffsetObj=function(k,n,o){var m,g,h,e,j=false,f=k[n];k[n]={width:0,height:0,left:0,right:0,top:0,bottom:0};for(m=0,g=o.length;m<g;m++){e=k[o[m]];h=typeof e==="object";k[n].left+=(h?(e.left!==b?e.left:0):e);k[n].right+=(h?(e.right!==b?e.right:0):e);k[n].top+=(h?(e.top!==b?e.top:0):e);k[n].bottom+=(h?(e.bottom!==b?e.bottom:0):e)}k[n].width=k[n].left+k[n].right;k[n].height=k[n].top+k[n].bottom;return(k[n].left!==f.left||k[n].right!==f.right||k[n].top!==f.top||k[n].bottom!==f.bottom)};d._cl_setWH=function(f,i,h){if(h.percent!==false){var e=f._cl_parentView[i==="width"?"scrollXEnabled":"scrollYEnabled"]("state"),g=e?(f._cl_parentView[i]("scroll")-f._cl_parentView._cl_calculatedClientOffset[i]-f._cl_parentView._cl_calculatedOffset[i]):f._cl_parentView[i]("inner");return g*h.percent}else{if(h.relative!==false){return f._cl_parentView[i]("inner")+h.relative}else{if(h.auto!==false){return f[i]("content")+f._cl_calculatedClientOffset[i]+f._cl_calculatedOffset[i]}else{if(h.relative===false&&h.percent===false&&h.auto===false){return h.value}else{return null}}}}};d._cl_updateWH=function(l,i,f,e,k,n,m){var j=l._cl_calculatedOffset[f]+l._cl_calculatedClientOffset[f],g=i-j,h;if(l._cl_parentView.constrainChildren()&&l._cl_parentView["_cl_"+f].auto===false){h=(g||l[f]("inner"))+e;if(h>l._cl_parentView[f]("inner")){g=l._cl_parentView[f]("inner")-e-j}}if(k!==null&&(g+l._cl_calculatedClientOffset[f])<k){g=k-l._cl_calculatedClientOffset[f]}if(n!==null&&(g+l._cl_calculatedClientOffset[f])>n){g=n-l._cl_calculatedClientOffset[f]}g=(g>=0?g:0);m.client=m.inner=m.content=g;m.offset=g+j;return g};d._cl_updateXY=function(i,f,k,g,j){var h=0,e=i._cl_parentView?i._cl_parentView._cl_calculatedClientOffset[j==="width"?"left":"top"]:0;switch(k){case"left":case"top":h=f+e;break;case"center":case"middle":h=g/2-i[j]()/2+f+e;if(h<e){h=e}break;case"right":case"bottom":h=g-i[j]()+f+e;break}return h};d._cl_initialRedraw=function(e){if(e._cl_initialized&&!e._cl_initialRenderComplete){e._cl_initialRenderComplete=true;if(e._cl_visible){e._cl_viewElement.style.display=e._cl_defaultDisplayStyle}}};d._cl_viewCanRedraw=function(e){var f=true;if(!e._cl_viewElement){f=false}if(!e._cl_parentView){f=false}if(!e.visible()&&e._cl_initialRenderComplete){f=false}if(e.suspendRedraws()){f=false}if(!f){e._cl_redrawPending=false}return f};d._cl_useTransforms=false;d._cl_forceGPU=false}).Prototype("CLView",function(e,c,d){this.Properties(function(){this._cl_viewElement=null;this._cl_viewElementType="div";this._cl_viewIsReady=false;this._cl_parentView=null;this._cl_showOverflow=false;this._cl_alignX="left";this._cl_alignY="top";this._cl_x={value:0,state:false,percent:false};this._cl_y={value:0,state:false,percent:false};this._cl_alpha=1;this._cl_visible=true;this._cl_width={client:0,offset:0,inner:0,value:"100%",percent:1,relative:false,auto:false,isDefault:true,content:0};this._cl_height={client:0,offset:0,inner:0,value:"100%",percent:1,relative:false,auto:false,isDefault:true,content:0};this._cl_minWidth=null;this._cl_minHeight=null;this._cl_maxWidth=null;this._cl_maxHeight=null;this._cl_borderWidth={top:0,left:0,right:0,bottom:0};this._cl_padding={top:0,left:0,right:0,bottom:0};this._cl_calculatedOffset={width:0,height:0,left:0,right:0,top:0,bottom:0};this._cl_calculatedClientOffset={width:0,height:0,left:0,right:0,top:0,bottom:0};this._cl_redrawPending=false;this._cl_initialized=false;this._cl_initialRenderComplete=false;this._cl_id=null;this._cl_viewDefDefaults={};this._cl_fromViewDef=false;this._cl_vdViewIsReady=false;this._cl_suspendRedraws=false;this._cl_suspendRedrawsDirect=false;this._cl_buildingFromViewDef=false;this._cl_pendingViewElementProps={};this._cl_currentViewElementProps={};this._cl_controller=null;this._cl_isInTree=false;this._cl_defaultDisplayStyle="block";this.skipViewDefReset=[]});e.CLView=function(){e.superclass(this);if(d._cl_transformProp===b){d._cl_transformProp=a.cl.core.Utils.getCSSProp("transform")}this._cl_viewElement=document.createElement(this._cl_viewElementType);this._cl_viewElement.className=e.className.call(this);this._cl_viewElement.style.backgroundColor="transparent";this._cl_viewElement.style.overflowX=this._cl_viewElement.style.overflowY=this._cl_showOverflow?"visible":"hidden";this._cl_viewElement.id=e.instanceUID.call(this);this._cl_viewElement.style.zoom=1;this._cl_viewElement.style.position="absolute";this._cl_viewElement.style.display="none"};e.draw=function(f){if(!this._cl_initialized&&!this._cl_initialRenderComplete){this._cl_initialized=true;this._cl_setParent(f);this.redraw();this.viewReady()}};e.id=function(f){var g=this._cl_propGetSet("_cl_id",f,"string");return g||this.instanceUID()};e.isChildOf=function(g){var f=this._cl_parentView;while(f){if(f===g){return true}f=f._cl_parentView}return false};e.suspendRedraws=function(g,f){if(typeof g==="boolean"){if(f!==true){this._cl_suspendRedrawsDirect=g}this._cl_suspendRedraws=g?g:this._cl_suspendRedrawsDirect;if(!g){this.redraw()}return this}return this._cl_suspendRedraws};e.index=function(){return parseInt(this._cl_viewElement.style.zIndex)};e.renderFromData=function(f){};e.minWidth=function(f){return this._cl_propGetSet("_cl_minWidth",f,"number")};e.minHeight=function(f){return this._cl_propGetSet("_cl_minHeight",f,"number")};e.maxWidth=function(f){return this._cl_propGetSet("_cl_maxWidth",f,"number")};e.maxHeight=function(f){return this._cl_propGetSet("_cl_maxHeight",f,"number")};e.alignX=function(g){if(g!==b){if(g==="left"||g==="center"||g==="right"){var f=(g!==this._cl_alignX);this._cl_alignX=g;if(f){this.redraw}}return this}return this._cl_alignX};e.alignY=function(g){if(g!==b){if(g==="top"||g==="middle"||g==="bottom"){var f=(g!==this._cl_alignY);this._cl_alignY=g;if(f){this.redraw}}return this}return this._cl_alignY};e.y=function(i,k,l){if(i!==b){if(i===true){return this._cl_y.state!==false&&this.parentView()&&this.parentView().relY()?this._cl_y.state:this._cl_y.value}if(typeof k==="number"&&typeof i==="number"){return this.animate(k,{y:i,ease:l})}if(typeof i==="object"){var j=this.y(true),h=this.parentView();while(h){if(!h){return null}if(h===i){return j}j+=h.y(true)+h.scrollY()+h._cl_calculatedOffset.top+h._cl_calculatedClientOffset.top;h=h.parentView()}}else{var g=typeof i==="string"&&i.indexOf("%")!=-1;this._cl_y.percent=g?(parseFloat(i.substr(0,i.length-1))/100):false;if(this._cl_y.percent>1){this._cl_y.percent=1}if(this._cl_y.percent<0){this._cl_y.percent=0}var f=i!==this._cl_y.value;this._cl_y.value=i;if(f){this.redraw()}return this}}return this._cl_y.value};e.x=function(i,k,l){if(i!==b){if(i===true){return this._cl_x.state!==false&&this.parentView()&&this.parentView().relX()?this._cl_x.state:this._cl_x.value}if(typeof k==="number"&&typeof i==="number"){return this.animate(k,{x:i,ease:l})}if(typeof i==="object"){var j=this.x(true),h=this.parentView();while(h){if(!h){return null}if(h===i){return j}j+=h.x(true)+h.scrollX()+h._cl_calculatedOffset.left+h._cl_calculatedClientOffset.left;h=h.parentView()}}else{var g=typeof i==="string"&&i.indexOf("%")!=-1;this._cl_x.percent=g?(parseFloat(i.substr(0,i.length-1))/100):false;if(this._cl_x.percent>1){this._cl_x.percent=1}if(this._cl_x.percent<0){this._cl_x.percent=0}var f=i!==this._cl_x.value;this._cl_x.value=i;if(this._cl_x.state!==false&&this.parentView()&&this.parentView().relX()){this._cl_x.state=i}if(f){this.redraw()}return this}}return this._cl_x.value};e.rotation=function(f){this._cl_css("transform","rotate("+f+"deg)",true)};e.showOverflow=function(f){if(f){this._cl_viewElement.style.overflowX=this._cl_viewElement.style.overflowY=f===true?"visible":"hidden";this._cl_showOverflow=f;return this}return this._cl_showOverflow};e.background=function(f){this._cl_viewElement.style.background=f;return this._cl_viewElement.style.background};e.backgroundColor=function(h,f,g){if(h){this._cl_viewElement.style.backgroundColor=h;if(this.cl().clientPlatform()==="IE"||this.cl().clientPlatform()==="WP7"){this._cl_viewElement.style.filter=this._cl_viewElement.style.filter.replace(/progid:DXImageTransform\.Microsoft\.gradient\(.*?\)/gi,"")}if(a.cl.core.Utils.validateHexColor(h)&&a.cl.core.Utils.validateHexColor(f)){if(this.cl().clientPlatform()==="IE"||this.cl().clientPlatform()==="WP7"){this._cl_viewElement.style.filter+=" progid:DXImageTransform.Microsoft.gradient(startColorstr='"+a.cl.core.Utils.expandHexColor(h)+"', endColorstr='"+a.cl.core.Utils.expandHexColor(f)+"')"}else{this._cl_viewElement.style.background="";this._cl_viewElement.style.background="-moz-linear-gradient("+(g===true?"left":"top")+",  "+h+",  "+f+")";if(this._cl_viewElement.style.background.indexOf("gradient")===-1){this._cl_viewElement.style.background="-webkit-gradient(linear, left top, "+(g===true?"right top":"left bottom")+", from("+h+"), to("+f+"))"}}}else{this._cl_viewElement.style.background="";this._cl_viewElement.style.backgroundColor=h}return this}return this._cl_viewElement.style.backgroundColor};e.alpha=function(f,g,h){if(typeof f==="number"){if(typeof g==="number"){return this.animate(g,{alpha:f,ease:h})}if(this.cl().clientPlatform()=="IE"&&this.cl().browserVersion()<9){this._cl_viewElement.style.filter=this._cl_viewElement.style.filter.replace(/alpha\(.*?\)/gi,"")+" alpha(opacity="+(f*100)+")"}else{this._cl_viewElement.style.opacity=f+""}this._cl_alpha=f;return this}return this._cl_alpha};e.animate=function(g,f){var h=this.plugins().getRegisteredProcess("animation");if(h){h.animate(this,g,f)}else{this.warn("No animation plugin was found.");for(var i in f){if(typeof e[i]==="function"){e[i].call(this,f[i])}}}return this};e.easing=function(){var f=this.plugins().getRegisteredProcess("animation");if(f){return f.easing.call(this)}else{return{}}};e.border=function(i,h,g,f){if(i!==b||h!==b||g!==b||f!==b){this.borderWidth(i||0);this.borderStyle(h||"solid");this.borderColor(g||"#000");this.borderRadius(f||0);return this}return this._cl_viewElement.style.border};e.borderWidth=function(f,g,h){if(f!==b){if(typeof f==="number"){if(typeof g==="number"){return this.animate(g,{borderWidth:f,ease:h})}this._cl_viewElement.style.borderWidth=f+"px"}else{for(var i in f){this._cl_viewElement.style["border"+(a.cl.core.Utils.initialCap(i))+"Width"]=(f[i]||0)+"px"}}this._cl_borderWidth=f;this._cl_calculateOffset();return this}return this._cl_viewElement.style.borderWidth};e.borderStyle=function(f){if(f!==b){if(typeof f==="string"){this._cl_viewElement.style.borderStyle=f}else{for(var g in f){this._cl_viewElement.style["border"+(a.cl.core.Utils.initialCap(g))+"Style"]=f[g]||"solid"}}return this}return this._cl_viewElement.style.borderStyle};e.borderColor=function(f){if(f!==b){if(typeof f==="string"){this._cl_viewElement.style.borderColor=f}else{for(var g in f){this._cl_viewElement.style["border"+(a.cl.core.Utils.initialCap(g))+"Color"]=f[g]||"#000"}}return this}return this._cl_viewElement.style.borderColor};e.borderRadius=function(f,g,h){if(f!==b){if(typeof f==="number"){if(typeof g==="number"){return this.animate(g,{borderRadius:f,ease:h})}this._cl_viewElement.style[a.cl.core.Utils.getCSSProp("borderRadius")]=f+"px"}else{for(var i in f){this._cl_viewElement.style["border"+(a.cl.core.Utils.initialCap(i))+"Radius"]=(f[i]||0)+"px"}}return this}return this._cl_viewElement.style.borderRadius};e.padding=function(f,g,h){if(f!==b){if(typeof g==="number"){return this.animate(g,{padding:f,ease:h})}this._cl_padding=f;this._cl_calculateOffset();return this}return this._cl_padding};e.tooltip=function(f){if(typeof f==="string"){this._cl_viewElement.title=f;return this}return this._cl_viewElement.title};e.viewReady=function(){this._cl_viewIsReady=true;this.dispatchEvent(this.create(c.CLViewEvent,[c.CLViewEvent.VIEW_READY]))};e.viewIsReady=function(){return this._cl_viewIsReady};e.moveToParentView=function(f){this.removeFromParentView();this._cl_clParentView=null;f.addSubView(this)};e.removeFromParentView=function(f){if(this._cl_parentView){this._cl_parentView.removeSubView(this,f)}};e.addedToParent=function(f){};e.removedFromParent=function(f){};e.hide=function(){this._cl_viewElement.style.display="none";this._cl_visible=false};e.show=function(){this._cl_viewElement.style.display=this._cl_defaultDisplayStyle;this._cl_visible=true;this.redraw()};e.visible=function(f){if(typeof f==="boolean"){if(f){this.show()}else{this.hide()}return this}return this._cl_visible};e.parentView=function(){return this._cl_parentView};e.toTop=function(){this.parentView().subViewToTop(this)};e.toBottom=function(){this.parentView().subViewToBottom(this)};e.width=function(h,i,j){if(h===b||h===null){h="offset"}if(h==="offset"||h==="client"||h==="content"||h==="inner"||h==="value"){return this._cl_width[h]}if(typeof i==="number"&&typeof h==="number"){return this.animate(i,{height:h,ease:j})}this._cl_width.auto=this._cl_width.percent=this._cl_width.relative=this._cl_width.isDefault=false;if(typeof h==="string"){if(h==="auto"){this._cl_width.auto=true}else{var g=h.indexOf("%")!=-1;this._cl_width.percent=g?(parseFloat(h.substr(0,h.length-1))/100):false;if(this._cl_width.percent>1){this._cl_width.percent=1}if(this._cl_width.percent<0){this._cl_width.percent=0}this._cl_width.relative=!g?parseFloat(h):false;this._cl_width.auto=false}}var f=h!==this._cl_width.value;this._cl_width.value=h;if(f){this.redraw()}return this};e.height=function(h,i,j){if(h===b||h===null){h="offset"}if(h==="offset"||h==="client"||h==="content"||h==="inner"||h==="value"){return this._cl_height[h]}if(typeof i==="number"&&typeof h==="number"){return this.animate(i,{height:h,ease:j})}this._cl_height.auto=this._cl_height.percent=this._cl_height.relative=this._cl_height.isDefault=false;if(typeof h==="string"){if(h==="auto"){this._cl_height.auto=true}else{var g=h.indexOf("%")!=-1;this._cl_height.percent=g?(parseFloat(h.substr(0,h.length-1))/100):false;if(this._cl_height.percent>1){this._cl_height.percent=1}if(this._cl_height.percent<0){this._cl_height.percent=0}this._cl_height.relative=!g?parseFloat(h):false}}var f=h!==this._cl_height.value;this._cl_height.value=h;if(f){this.redraw()}return this};e.redraw=function(){if(!this._cl_redrawPending&&this.parentView()){this._cl_redrawPending=true;this.cl().MVC().redrawEngine().attemptRedraw(this)}};e.isFullyVisible=function(){var f=this;while(f){if(!f.visible()){return false}else{f=f.parentView()}}return true};e.processCustomViewDefNode=function(j,g,f,i,h){switch(j){case"EventListener":this._cl_addEventListenerFromViewDef(g,f);break;case"Bind":this._cl_bindToEventFromViewDef(g,f,h);break}};e._cl_addEventListenerFromViewDef=function(i,f){var g=i.type,j=(this._cl_controller instanceof a.cl.CLController&&i.view!==true)?this._cl_controller:this,k=(typeof i.target==="string")?this.getChildView(i.target):this,l=j[i.method],h;if(typeof i.event==="string"){h=a.GetNamespace(i.event,f);if(typeof h!=="function"){a.ThrowError('Error adding event listener: Could not find the event class "'+i.event+'".');return}else{if(typeof i.type!=="string"){a.ThrowError('Error adding event listener: No type specified for the event class "'+i.event+'".');return}}g=h[i.type];if(typeof g!=="string"){a.ThrowError('Error adding event listener: Could not find the type "'+i.type+'" on class "'+i.event+'".');return}}if(!(k instanceof d)){a.ThrowError('Error adding event listener: Could not find the target with id "'+i.target+'".  Make sure that the EventListener node comes after the node for the target view.');return}if(typeof l!=="function"){a.ThrowError('Error adding event listener: Could not find the method "'+i.method+'". Note that the method must be publicly accessible.');return}k.addEventListener(g,l,i.useCapture===true,this)};e._cl_bindToEventFromViewDef=function(i,f,l){var g=i.type,k,j,m;if(typeof i.event==="string"){var h=a.GetNamespace(i.event,f);if(typeof h!=="function"){a.ThrowError('Error binding to event: Could not find the event class "'+i.event+'".');return}else{if(typeof i.type!=="string"){a.ThrowError('Error binding to event: No type specified for the event class "'+i.event+'".');return}}g=h[i.type];if(typeof g!=="string"){a.ThrowError('Error binding to event: Could not find the type "'+i.type+'" on class "'+i.event+'".');return}}if(typeof i.listener==="string"){k=l.getChildView(i.listener);if(!k){a.ThrowError('Error binding to event: Could not find a listener with the ID "'+i.listener+'".');return}if(k instanceof a.cl.CLController&&i.view===true){k=k.view()}if(!k){a.ThrowError('Error binding to event: The controller with ID "'+i.listener+'" does not have a view.');return}}else{if(typeof i.singleton==="string"){j=a.GetNamespace(i.singleton,f);if(typeof singleon!=="function"){a.ThrowError('Error binding to event: Unable to locate the class "'+i.singleton+'". Make sure to import this class, or reference it with a fully-qualified package.');return}else{if(!j.isSingleton()){a.ThrowError('Error binding to event: Listener class "'+i.singleton+'" is not a singleton. You should specify the listener by ID with the "listener" attribute.');return}}k=singleon.instance()}else{a.ThrowError('Error binding to event: No listener was specified.  Either specify a "listener" by ID, or a "singleton" by class.');return}}m=k[i.method];if(typeof m!=="function"){a.ThrowError('Error binding to event: Could not find the method "'+i.method+'" on listener "'+(i.listener||i.singleton)+'". Note that the method must be publicly accessible.');return}this.addEventListener(g,m,i.useCapture===true,k)};e.viewRedrawn=function(){};e.addedToTree=function(){};e.removedFromTree=function(){};e.isInTree=function(){return this._cl_isInTree};e._cl_addedToTree=function(){this._cl_isInTree=true;this.addedToTree();if(this._cl_controller){this._cl_controller._cl_viewAddedToTree()}};e._cl_removedFromTree=function(){this._cl_isInTree=false;this.removedFromTree();if(this._cl_controller){this._cl_controller._cl_viewRemovedFromTree()}};e._cl_addedToParent=function(f){this.addedToParent(f);if(f.isInTree()){this._cl_addedToTree()}e.suspendRedraws.call(this,f.suspendRedraws());if(this._cl_vdViewIsReady&&f._cl_buildingFromViewDef){f._cl_vdViewAdded()}this.dispatchEvent(this.create(c.CLEvent,[c.CLEvent.ADDED_TO_PARENT]))};e._cl_removedFromParent=function(f){this.removedFromParent(f);this._cl_removedFromTree();if(this._cl_viewElement){this._cl_viewElement.style.display="none"}this._cl_initialRenderComplete=false;this.dispatchEvent(this.create(c.CLEvent,[c.CLEvent.REMOVED_FROM_PARENT]))};e._cl_propGetSet=function(h,g,f){if((f&&typeof g===f)||(!f&&g!==b)){this[h]=g;return this}return this[h]};e._cl_css=function(h,g,f){f=f||false;if(f){h=a.cl.core.Utils.getCSSProp(h)}if(h){this._cl_viewElement.style[h]=g}return this};e._cl_setParent=function(f){this._cl_parentView=f};e._cl_calculateOffset=function(){var g=d._cl_calcOffsetObj(this,"_cl_calculatedOffset",["_cl_borderWidth"]),f=d._cl_calcOffsetObj(this,"_cl_calculatedClientOffset",["_cl_padding"]);if(g||f){this.redraw()}};e._cl_redraw=function(l,k){if((!this._cl_initialRenderComplete||this._cl_redrawPending||l)&&a.cl.CLView._cl_viewCanRedraw(this)){var g=this._cl_x.percent!==false?(this._cl_parentView.width()*this._cl_x.percent):this.x(true),m=this._cl_y.percent!==false?(this._cl_parentView.height()*this._cl_y.percent):this.y(true),f=d._cl_setWH(this,"width",this._cl_width),j=d._cl_setWH(this,"height",this._cl_height),i=(f!==b||j!==b);this._cl_pendingViewElementProps.width=f!==null?(d._cl_updateWH(this,f,"width",g,this._cl_minWidth,this._cl_maxWidth,this._cl_width)+"px"):b;this._cl_pendingViewElementProps.height=j!==null?(d._cl_updateWH(this,j,"height",m,this._cl_minHeight,this._cl_maxHeight,this._cl_height)+"px"):b;this._cl_pendingViewElementProps.left=d._cl_updateXY(this,g,this._cl_alignX,this._cl_parentView.width("inner"),"width")+"px";this._cl_pendingViewElementProps.top=d._cl_updateXY(this,m,this._cl_alignY,this._cl_parentView.height("inner"),"height")+"px";this._cl_pendingViewElementProps.paddingTop=this._cl_calculatedClientOffset.top+"px";this._cl_pendingViewElementProps.paddingRight=this._cl_calculatedClientOffset.right+"px";this._cl_pendingViewElementProps.paddingBottom=this._cl_calculatedClientOffset.bottom+"px";this._cl_pendingViewElementProps.paddingLeft=this._cl_calculatedClientOffset.left+"px";if(this._cl_redrawPending){this._cl_alertParentOfRedraw()}this._cl_redrawPending=false;if(k!==true){this._cl_render()}d._cl_initialRedraw(this);return{force:i,shouldRedraw:true}}d._cl_initialRedraw(this);return{force:false,shouldRedraw:false}};e._cl_alertParentOfRedraw=function(){var f={width:this._cl_pendingViewElementProps.width!==this._cl_currentViewElementProps.width,height:this._cl_pendingViewElementProps.height!==this._cl_currentViewElementProps.height,x:this._cl_pendingViewElementProps.left!==this._cl_currentViewElementProps.left,y:this._cl_pendingViewElementProps.top!==this._cl_currentViewElementProps.top};if(this._cl_parentView){this._cl_parentView._cl_childRedrawn(this,f)}};e._cl_render=function(){if(d._cl_useTransforms&&d._cl_transformProp){var g="";if(this._cl_pendingViewElementProps.top!==b){g+="translateY("+this._cl_pendingViewElementProps.top+") ";this._cl_currentViewElementProps.top=this._cl_pendingViewElementProps.top}if(this._cl_pendingViewElementProps.left!==b){g+="translateX("+this._cl_pendingViewElementProps.left+") ";this._cl_currentViewElementProps.left=this._cl_pendingViewElementProps.left}if(g!==""){if(d._cl_forceGPU){g+="translateZ(0px)"}this._cl_viewElement.style[d._cl_transformProp]=g}}for(var h in this._cl_pendingViewElementProps){var f=this._cl_pendingViewElementProps[h];if(this._cl_currentViewElementProps[h]!==f){this._cl_currentViewElementProps[h]=this._cl_viewElement.style[h]=f}}this._cl_pendingViewElementProps={};this.viewRedrawn()};e._cl_setIndex=function(f){this._cl_viewElement.style.zIndex=f};e.Override.dispatchEvent=function(i,j,g){var k=this._a5_createEvent(i,j,g);var h=this._cl_getViewChain();k._a5_phase=a.EventPhase.CAPTURING;for(var f=0,l=h.length;f<l;f++){this._a5_dispatchEvent.call(h[f],k)}k._a5_phase=a.EventPhase.AT_TARGET;this._a5_dispatchEvent(k);if(k.bubbles()){k._a5_phase=a.EventPhase.BUBBLING;for(var f=h.length-1;f>=0;f--){this._a5_dispatchEvent.call(h[f],k)}}if(!k.shouldRetain()){k.destroy()}k=null;h=null};e._cl_getViewChain=function(){var f=[];var g=this;while(g._cl_parentView){g=g._cl_parentView;f.unshift(g)}return f};e._cl_vdViewReady=function(){this._cl_vdViewIsReady=true;if(this._cl_parentView&&!this._cl_controller){this._cl_parentView._cl_vdViewAdded()}else{if(this._cl_controller){this._cl_controller._cl_viewReady()}}};e._cl_destroyElement=function(f){this.MVC().garbageCollector().destroyElement(f)};e.dealloc=function(){if(this._cl_parentView){this.removeFromParentView()}this._cl_destroyElement(this._cl_viewElement);this._cl_viewElement=null}});a.Package("a5.cl.mvc.core").Import("a5.cl.CLEvent").Extends("a5.cl.CLMVCBase").Class("EnvManager",function(e,d){var i,c={},j,h;e.EnvManager=function(){e.superclass(this);g();e.cl().addEventListener(d.CLEvent.ORIENTATION_CHANGED,f);e.cl().addEventListener(d.CLEvent.WINDOW_RESIZED,f);j=h=e.cl().clientEnvironment();f()};e.cl().clientEnvironment=function(k){return k?j:a.cl.core.EnvManager.instance().clientEnvironment()};this.scrollBarWidth=function(){return i};this.windowProps=function(k){if(k){return f(true)}else{return c}};var f=function(k){var m=k===true?true:false;var l=null;if(document.documentElement&&document.documentElement.clientHeight){l=document.documentElement}else{if(document.body&&document.body.clientHeight){l=document.body}}if(l){c.height=l.clientHeight;c.width=l.clientWidth;c.scrollHeight=l.scrollHeight;c.scrollWidth=l.scrollWidth}else{if(typeof(window.innerHeight)=="number"){c.height=window.innerHeight;c.width=window.innerWidth;c.scrollHeight=window.innerHeight+window.scrollMaxY;c.scrollWidth=window.innerWidth+window.scrollMaxX}}if(c.scrollHeight===0){c.scrollHeight=c.height}if(c.scrollWidth===0){c.scrollWidth=c.width}if(e.config().clientEnvironmentOverrides){if(j==="MOBILE"&&c.width>=e.config().mobileWidthThreshold){j=h;e.cl().dispatchEvent(d.CLEvent.CLIENT_ENVIRONMENT_UPDATED,[j])}else{if(j!=="MOBILE"&&c.width<e.config().mobileWidthThreshold){j="MOBILE";e.cl().dispatchEvent(d.CLEvent.CLIENT_ENVIRONMENT_UPDATED,[j])}}}if(m){return c}else{e.cl().MVC().redrawEngine().triggerAppRedraw(true)}};var g=function(){var m=null,k=null,n=0,l=0;m=document.createElement("div");m.style.position="absolute";m.style.left=m.style.top="-500px";m.style.height=m.style.width="100px";m.style.overflow="hidden";k=document.createElement("div");k.style.width="100%";k.style.height="500px";m.appendChild(k);document.getElementsByTagName("body")[0].appendChild(m);n=m.clientWidth;m.style.overflow="scroll";l=m.clientWidth;document.getElementsByTagName("body")[0].removeChild(m);i=n-l;m=k=null}});a.Package("a5.cl.mvc.core").Static("XMLUtils",function(c){c.parseXML=function(e){var d;if(window.DOMParser){d=(new DOMParser()).parseFromString(e,"text/xml");if(d.documentElement.nodeName==="parsererror"){throw d.documentElement.childNodes[0].nodeValue;return}}else{d=new ActiveXObject("Msxml2.DOMDocument.3.0");d.async="false";d.loadXML(e);if(d.parseError.errorCode!=0){throw ("Error parsing XML. Line "+d.parseError.line+" position "+d.parseError.linePos+"\nError Code: "+d.parseError.errorCode+"\nError Reason: "+d.parseError.reason+"Error Line: "+d.parseError.srcText);return}}if(d.documentElement.textContent&&d.documentElement.textContent.indexOf("This page contains the following errors:")===0){var f=d.documentElement.textContent.replace("This page contains the following errors:","Error parsing XML: ");throw f}return d};c.getElementsByTagNameNS=function(f,e,d,g){if(typeof f.getElementsByTagNameNS==="function"){return f.getElementsByTagNameNS(d,e)}else{return f.getElementsByTagName(g+":"+e)}};c.getNamedItemNS=function(d,f,e,g){if(typeof d.getNamedItemNS==="function"){return d.getNamedItemNS(e,f)}else{return d.getNamedItem(g+":"+f)}};c.localName=function(d){if(typeof d.localName==="string"){return d.localName}else{return(d.tagName?d.tagName:d.name).replace(/.+?:/,"")}};c.children=function(g){if(g.children){return g.children}else{var f=[],d,h,e;for(d=0,h=g.childNodes.length;d<h;d++){e=g.childNodes[d];if(e.nodeType===1){f.push(e)}}return f}};c.getPrefix=function(d){if(typeof d.prefix!=="undefined"){return d.prefix}else{var e=d.tagName?d.tagName.split(":"):d.name.split(":");return(e.length>1?e[0]:null)}}});a.Package("a5.cl.core.viewDef").Import("a5.cl.*","a5.cl.mvc.core.XMLUtils","a5.cl.core.Utils").Extends("a5.cl.CLMVCBase").Static(function(d,c){d._cl_ns="http://corelayerjs.com/";d._cl_nsPrefix="cl";d.getImports=function(i){var g=d.getElementsByTagName(i.documentElement,"Imports"),h=(g&&g.length>0)?d.getElementsByTagName(g[0],"Import"):[],j=[],f,k,e;for(f=0,k=h.length;f<k;f++){e=h[f];j.push(e.getAttribute("ns"))}return a._a5_processImports(j)};d._cl_getEnvironmentNode=function(g,h,f){var j=c.XMLUtils.children(g);for(var e=0,k=j.length;e<k;e++){var i=j[e];if(i.prefix===d._cl_nsPrefix&&c.XMLUtils.localName(i)===h){if(i.getAttribute("value").toUpperCase().indexOf(f)!==-1){return i}}}return null};d._cl_resolveQualifiedClass=function(g,e){var f=a.GetNamespace(g.replace(/_/g,"."));if(typeof e==="object"){e[g]=f}return f};d.getElementsByTagName=function(e,f){return c.XMLUtils.getElementsByTagNameNS(e,f,d._cl_ns,d._cl_nsPrefix)};d.processAttribute=function(m){var g=m.split("|"),n=window.JSON||a.cl.core.JSON,e=/{RegExp}|{Boolean}|{Number}|{Array}|{String}|{Object}|{Namespace}/,f=[],l,k,h,j;for(l=0,k=g.length;l<k;l++){h=g[l];j=e.exec(h);if(c.Utils.isArray(j)){j=j[0]}h=h.replace(e,"");switch(j){case"{Boolean}":f.push(h==="true");break;case"{Number}":f.push(parseInt(h));break;case"{Array}":case"{Object}":f.push(n.parse(h));break;case"{String}":f.push(h+"");break;case"{Namespace}":f.push(a.GetNamespace(h,this._cl_imports));break;case"{RegExp}":var i=h.split("/");f.push(new RegExp(i[1],i[2]));break;default:if(!isNaN(h)){f.push(parseFloat(h))}else{if(h==="true"||h==="false"){f.push(h==="true")}else{if(/(^\[.*\]$)|(\{.*\})$/.test(h)){f.push(n.parse(h))}else{f.push(h+"")}}}}}return f}}).Prototype("ViewDefParser",function(d,c,e){d.ViewDefParser=function(g,f){d.superclass(this);this._cl_controller=f;this._cl_xml=(typeof g==="string")?c.XMLUtils.parseXML(g):g;this._cl_rootView=f.view();this._cl_imports=e.getImports(this._cl_xml);this._cl_definitionNode=this._cl_getDefinitionNode();this._cl_defaultsNode=this._cl_getDefaults();if(!this._cl_definitionNode){this.redirect(500,"Unable to find a valid cl:Definition element in the view definition.");return}};d.parse=function(h,g,i){if(this._cl_rootView){this._cl_definitionNode=this._cl_getDefinitionNode()}var j=c.XMLUtils.children(this._cl_definitionNode)[0],f=this.create(a.cl.core.viewDef.ViewBuilder,[this._cl_controller,j,this._cl_defaultsNode,this._cl_imports,this._cl_rootView]);f.build(function(k){this._cl_rootView=k;if(typeof h==="function"){h.call(i,k)}},function(k){if(typeof g==="function"){g.call(i,k)}},this,this._cl_rootView)};d.hasOrientationOptions=function(){var f=e.getElementsByTagName(this._cl_xml.documentElement,"Orientation");return(f&&f.length>0)};d.hasEnvironmentOptions=function(h){var g=e.getElementsByTagName(this._cl_xml.documentElement,"Environment");if(g&&g.length>0){if(typeof h==="string"){for(var f=0,j=g.length;f<j;f++){var i=g[f];if(c.Utils.arrayIndexOf(i.getAttribute("value").split("|"),h)>-1){return true}}return false}return true}return false};d._cl_getDefaults=function(){var f=e.getElementsByTagName(this._cl_xml.documentElement,"Defaults");return(f&&f.length>0)?f[0]:null};d._cl_getDefinitionNode=function(){var j=this.cl()._core().envManager().clientEnvironment(true).toUpperCase(),m=this.cl()._core().envManager().clientPlatform().toUpperCase(),i=this.cl()._core().envManager().clientOrientation().toUpperCase(),l=e.getElementsByTagName(this._cl_xml.documentElement,"Definition"),h=(l&&l.length>0)?l[0]:null,k=e._cl_getEnvironmentNode(h,"Environment",j);if(h&&k){var f=e._cl_getEnvironmentNode(k,"Platform",m);if(f){var g=e._cl_getEnvironmentNode(f,"Orientation",i);if(g.length>0){return g}else{return f}}else{var g=e._cl_getEnvironmentNode(k,"Orientation",i);if(g){return g}else{return k}}}else{return h}}});a.Package("a5.cl.core.viewDef").Import("a5.cl.mvc.core.XMLUtils","a5.cl.core.Utils","a5.cl.CLView").Extends("a5.cl.CLMVCBase").Static(function(d,c){d._cl_isInternalNodeType=function(g){var f=["Imports","Defaults","Definition","Environment","Platform","Orientation"];if(g.prefix!==c.ViewDefParser._cl_nsPrefix||g.namespaceURI!==c.ViewDefParser._cl_ns){return false}for(var e=0,h=f.length;e<h;e++){if(c.XMLUtils.localName(g)===f[e]){return true}}return false}}).Prototype("ViewBuilder",function(e,c,d){this.Properties(function(){this._cl_xml=null;this._cl_defaults=null;this._cl_imports=null;this._cl_rootView=null;this._cl_ids=null;this._cl_id=null;this._cl_view=null;this._cl_childIndex=0;this._cl_children=null;this._cl_viewName=null;this._cl_viewReadyCallback=null;this._cl_buildCompleteCallback=null;this._cl_callbackScope;this._cl_isCustomNode=false});e.ViewBuilder=function(g,h,k,f,j,i){e.superclass(this);this._cl_controller=g;this._cl_xml=h;this._cl_defaults=k;this._cl_imports=f;this._cl_rootView=j;this._cl_ids=i||[];this._cl_children=c.XMLUtils.children(h);this._cl_viewName=c.XMLUtils.localName(h)};e.build=function(p,h,t,q){this._cl_viewReadyCallback=p;this._cl_buildCompleteCallback=h;this._cl_callbackScope=t;var k=this._cl_xml,o=c.ViewDefParser._cl_ns,g=c.ViewDefParser._cl_nsPrefix;if(q instanceof c.CLView){var m=k.attributes.getNamedItem("_isCustomNode");if(m){this._cl_isCustomNode=m.value==="true"}this._cl_viewCreated(q)}else{var l=k.namespaceURI===o&&k.prefix===g,s=c.ViewBuilder._cl_isInternalNodeType(k);if(l&&!s){var j=k.attributes.getNamedItem("id");if(j){this._cl_id=j.value}q=this._cl_findChild(this._cl_id);if(q instanceof c.CLView&&c.Utils.arrayIndexOf(this._cl_ids,this._cl_id)===-1){this._cl_viewCreated(q)}else{if(!this._cl_id||c.Utils.arrayIndexOf(this._cl_ids,this._cl_id)===-1){var r=this._cl_imports[this._cl_viewName]||c.ViewDefParser._cl_resolveQualifiedClass(this._cl_viewName,this._cl_imports);if(!r){this.redirect(500,"Error parsing the view definition. "+c.XMLUtils.localName(k)+" could not be found.  Make sure this class was imported into the view definition and included in the dependencies.");return}var f=c.XMLUtils.getNamedItemNS(k.attributes,"Construct",o,g),n=f?c.ViewDefParser.processAttribute(f.value):[];q=this.create(r,n);if(q instanceof c.CLView){this._cl_viewCreated(q)}else{if(q instanceof a.cl.CLController){var i=q;q=null;i.id(this._cl_id);this._cl_compileCustomNodes(i);this._cl_controller._cl_childControllers.push(i);i.generateView(this._cl_viewCreated,this)}}}else{this.redirect(500,"Error: Duplicate id ("+this._cl_id+") found in view definition.");return}}}else{if(typeof this._cl_buildCompleteCallback==="function"){this._cl_buildCompleteCallback.call(this._cl_callbackScope,null)}}}};e._cl_viewCreated=function(f){this._cl_view=f;f._cl_fromViewDef=true;f._cl_vdViewIsReady=false;if(!this._cl_rootView){this._cl_rootView=f;f._cl_controller=this._cl_controller}if(this._cl_id){f.id(this._cl_id)}this._cl_ids.push(f.id());if(!f._cl_controller||f===this._cl_rootView){this._cl_removeViewDefViews();this._cl_resetViewProperties();this._cl_compileCustomNodes()}this._cl_applyAttributeTree();if(typeof this._cl_viewReadyCallback==="function"){this._cl_viewReadyCallback.call(this._cl_callbackScope,f)}this._cl_childIndex=0;f._cl_pendingChildren=this._cl_children.length;this._cl_buildNextChild()};e._cl_buildNextChild=function(){if(this._cl_children&&this._cl_childIndex<this._cl_children.length){this._cl_view._cl_buildingFromViewDef=true;var l=this._cl_children[this._cl_childIndex],k=this._cl_view._cl_controller instanceof a.cl.CLController&&this._cl_view!==this._cl_rootView,g=k?this._cl_view._cl_controller.constructor._cl_customViewDefNodes:this._cl_view.constructor._cl_customViewDefNodes,f=k?this._cl_view._cl_controller:this._cl_view,j=this._cl_view===this._cl_rootView?this._cl_compileCustomNodes(this._cl_controller):[],i=c.XMLUtils.localName(l);if(c.Utils.arrayContains(g,i)||c.Utils.arrayContains(j,i)){var m=this._cl_convertNodeToObject(l);if(c.Utils.arrayContains(j,i)){f=this._cl_controller}f.processCustomViewDefNode(m._name,m,this._cl_imports,this._cl_defaults,this._cl_rootView);this._cl_childIndex++;if(this._cl_view._cl_vdViewAdded&&!this._cl_isCustomNode){this._cl_view._cl_vdViewAdded()}this._cl_buildNextChild();return}else{if(!k||this._cl_view===this._cl_rootView){var h=this.create(c.ViewBuilder,[this._cl_controller,l,this._cl_defaults,this._cl_imports,this._cl_rootView,this._cl_ids]);h.build(this._cl_viewReadyHandler,this._cl_buildCompleteHandler,this)}else{this.throwError("Error parsing view definition for "+this._cl_controller.id()+".  Views cannot be applied to the controller '"+this._cl_view._cl_controller.id()+"'.  Use a separate view definition to define the view structure for each controller.");return}}}else{if(this._cl_view._cl_vdViewReady&&this._cl_childIndex===0&&!this._cl_isCustomNode){this._cl_view._cl_vdViewReady()}if(typeof this._cl_buildCompleteCallback==="function"){this._cl_buildCompleteCallback.call(this._cl_callbackScope,this._cl_view)}this._cl_view.suspendRedraws(false);this.destroy()}};e._cl_findChild=function(j){if(typeof j!=="string"||!this._cl_rootView){return null}var i=this._cl_rootView.getChildView(j),f,h,g;if(i){return i}for(f=0,h=this._cl_controller._cl_orphanage.length;f<h;f++){g=this._cl_controller._cl_orphanage[f];if(g.id()===j){return g}}return this._cl_controller.getChildController(j)};e._cl_viewReadyHandler=function(f){if(f){this._cl_view.addSubViewAtIndex(f,this._cl_childIndex);if(f._cl_controller){this._cl_view._cl_vdViewAdded()}}};e._cl_buildCompleteHandler=function(f){this._cl_childIndex++;this._cl_buildNextChild()};e._cl_removeViewDefViews=function(g){if(!g){g=this._cl_view}if(!(g instanceof a.cl.CLViewContainer)||!g._cl_fromViewDef){return}var i=g._cl_childViews.slice(0),f,j,h;for(f=0,j=i.length;f<j;f++){h=i[f];if(h._cl_fromViewDef){this._cl_controller._cl_orphanage.push(h);this._cl_removeViewDefViews(h);g.removeSubView(h,false)}}};e._cl_resetViewProperties=function(){var f=this._cl_view;for(var g in f._cl_viewDefDefaults){if(c.Utils.arrayIndexOf(f.skipViewDefReset,g)===-1){if(typeof f[g]==="function"){f[g].call(f,f._cl_viewDefDefaults[g])}else{f[g]=f._cl_viewDefDefaults[g]}}}};e._cl_applyAttributeTree=function(){var g=this._cl_defaults;if(g){this._cl_applyDefaults(g);var n=this.cl()._core().envManager().clientEnvironment(true).toUpperCase(),m=this.cl()._core().envManager().clientPlatform().toUpperCase(),h=this.cl()._core().envManager().clientOrientation().toUpperCase();var j=this._cl_applyEnvironmentDefaults(g,"Environment",n);for(var k=0,i=j.length;k<i;k++){this._cl_applyEnvironmentDefaults(j[k],"Orientation",h)}var l=[];for(var k=0,i=j.length;k<i;k++){var f=this._cl_applyEnvironmentDefaults(j[k],"Platform",m);l.push.apply(l,f)}for(var k=0,i=l.length;k<i;k++){this._cl_applyEnvironmentDefaults(l[k],"Orientation",h)}}this._cl_applyAttributes(this._cl_xml)};e._cl_applyEnvironmentDefaults=function(l,i,g){var h=[],k=c.XMLUtils.children(l);for(var f=0,m=k.length;f<m;f++){var j=k[f];if(j.prefix===c.ViewDefParser._cl_nsPrefix&&c.XMLUtils.localName(j)===i){if(j.getAttribute("value").toUpperCase().indexOf(g)!==-1){this._cl_applyDefaults(j);h.push(j)}}}return h};e._cl_applyDefaults=function(i){var h=c.XMLUtils.children(i);for(var f=0,j=h.length;f<j;f++){var g=h[f];if(c.XMLUtils.localName(g)===this._cl_viewName){this._cl_applyAttributes(g)}}};e._cl_applyAttributes=function(i){var g,k,f,h,j;for(var g=0,k=i.attributes.length;g<k;g++){f=i.attributes[g];h=c.XMLUtils.localName(f);if(h!=="id"&&c.XMLUtils.getPrefix(f)!==c.ViewDefParser._cl_nsPrefix){j=(this._cl_view._cl_controller&&typeof this._cl_view._cl_controller[c.XMLUtils.localName(f)]!=="undefined")?this._cl_view._cl_controller:this._cl_view;if(typeof j[h]==="function"){if(!j._cl_viewDefDefaults[h]){j._cl_viewDefDefaults[h]=j[h].apply(j,this._cl_getParamsForRetrievingDefault(h))}j[h].apply(j,c.ViewDefParser.processAttribute(f.value))}else{if(!j._cl_viewDefDefaults[h]){j._cl_viewDefDefaults[h]=j[h]}j[h]=c.ViewDefParser.processAttribute(f.value)[0]}}}};e._cl_getParamsForRetrievingDefault=function(f){switch(f){case"width":case"height":return["value"];default:return[]}};e._cl_compileCustomNodes=function(i){var f=i||this._cl_view,g=f.constructor,h=[];if(c.Utils.isArray(f.constructor._cl_customViewDefNodes)){return f.constructor._cl_customViewDefNodes}while(g!==null){var j=g.customViewDefNodes||[];Array.prototype.push.apply(h,j);g=g.superclass&&g.superclass().constructor.namespace?g.superclass().constructor:null}f.constructor._cl_customViewDefNodes=h;return h};e._cl_convertNodeToObject=function(g){var h={};h._name=c.XMLUtils.localName(g);h.node=g;for(var f=0,j=g.attributes.length;f<j;f++){var i=g.attributes[f];h[i.name]=c.ViewDefParser.processAttribute(i.value);if(h[i.name].length===1){h[i.name]=h[i.name][0]}}g.setAttribute("_isCustomNode","true");return h}});a.Package("a5.cl.mvc.core").Extends("a5.cl.CLMVCBase").Class("Filters","singleton final",function(d){var e;this.Filters=function(){d.superclass(this);e=["_cl_appPlaceholder"]};this.addFilter=function(j,i){var h=i||false;if(typeof h==="number"){e.splice(h,0,j)}else{if(h){e.push(j)}else{e.unshift(j)}}};this.addAppFilters=function(j){var m;for(var k=0,h=e.length;k<h;k++){if(e[k]==="_cl_appPlaceholder"){m=k;e.splice(k,1);break}}if(j){for(var k=0,h=j.length;k<h;k++){this.addFilter(j[k],m);m++}}};this.test=function(j,h,i){g(j,"before",function(k){if(k){if(h){g(h,"after",function(l){i(l)})}else{i(true)}}else{i(false)}})};var g=function(n,j,o){var i=true;var m=true;var k=0;function l(){k++;h()}function h(){if(k<e.length){if(m){var p=e[k];if(c(n.controller,p.controller)){if(!n.action||p.action==null||p.action==b||c(n.action,p.action)){i=false;f(n,p,j,function(q){m=q;l()})}else{l()}}else{l()}}}else{if(i){o(true)}else{o(m)}}}h()};var c=function(i,h){if(h=="*"||h==i){return true}else{return false}};var f=function(l,i,k,m){var j=false;if(i[k]){j=true;var h={pass:function(){m(true)},fail:function(){m(false)},hash:l.hash,controller:l.controller,action:l.action,id:l.id};i[k].call(d,h)}if(!j){m(true)}}});a.Package("a5.cl.mvc.core").Import("a5.cl.core.Instantiator").Extends("a5.cl.CLMVCBase").Class("Mappings","singleton final",function(f,e){var j,c,h=null,d=["controller","action","id"];this.Mappings=function(){f.superclass(this);j=["_cl_appPlaceholder"];c=["_cl_appPlaceholder"]};this.addMapping=function(l,n){var k=n||false,m=l.controller?e.Instantiator.instance().getClassInstance("Controller",l.controller,true):null;if(m){if(!(m instanceof a.cl.CLController)){this.throwError("Unable to instantiate the controller "+l.controller);return}else{if(m.instanceCount()>1){this.throwError("Cannot add a mapping to a controller with multiple instances ("+m.namespace()+").");return}}m.setMappable()}if(typeof l.desc==="number"){if(l.controller){if(k){c.push(l)}else{c.unshift(l)}}}else{if(typeof l.desc==="string"){l.desc=l.desc.split("/");l.desc.shift()}else{f.throwError('invalid mapping: "desc" param must be a string')}if(typeof k==="number"){j.splice(k,0,l)}else{if(k){j.push(l)}else{j.unshift(l)}}}};this.addAppMappings=function(p){var o,n;for(var m=0,k=j.length;m<k;m++){if(j[m]==="_cl_appPlaceholder"){o=m;j.splice(m,1);break}}for(var m=0,k=c.length;m<k;m++){if(c[m]==="_cl_appPlaceholder"){n=m;c.splice(m,1);break}}if(p){for(var m=0,k=p.length;m<k;m++){if(typeof p[m].desc==="number"){this.addMapping(p[m],n);n++}else{this.addMapping(p[m],o);o++}}}};this.getCallSignature=function(k){var l=i(k);if(l){l.hash=k.join("/");h=l;return l}else{return null}};this.geLastCallSignature=function(){return h};this.getErrorSignature=function(m){for(var n=0,k=c.length;n<k;n++){if(c[n].desc==m){return{controller:c[n].controller,action:c[n].action,id:c[n].id}}}return null};var i=function(n){var p=(typeof n=="object"?n:[n]);for(var m in p){if(p[m]==b){p[m]=""}}if(!p.length){p=[""]}var t=null;for(var q=0,o=j.length;q<o;q++){var s=g(j[q],p);if(s){var r={controller:j[q].controller,action:j[q].action,id:j[q].id};for(var m in s){if(r[m]==b){r[m]=s[m]}}var k=true;if(j[q].constraints){k=j[q].constraints(r.controller,r.action,r.id)}if(k){t=r}}if(t){break}}return t};var g=function(k,r){var t={};var x=false;var n=false;var y=false;for(var v=0,q=k.desc.length;v<q;v++){if(!n){var w=k.desc[v].indexOf(":")==0;if(w){var u=k.desc[v].indexOf("?")==k.desc[v].length-1;var p=false;for(var s=0,o=d.length;s<o;s++){if(!p){if(k.desc[v].substr(1,k.desc[v].length-(u?2:1))==d[s]){p=x=true;if(v>=r.length){if(!u){x=false}}else{if(d[s]=="id"){if(r.length===1&&r[0]===""&&!u){x=false}else{t.id=r.slice(v);y=true}}else{t[d[s]]=r[v]}}}else{if(!u){x=false}}}}}else{x=(v<r.length&&k.desc[v]==r[v]);if(!x){n=true}}}}if(x){if(!y&&r.length>k.desc.length){return null}else{return t}}else{return null}}});a.Package("a5.cl.mvc.core").Extends("a5.cl.CLMVCBase").Class("GarbageCollector","singleton final",function(e,c){var f=document.createElement("div"),h=0,d=10;this.GarbageCollector=function(){e.superclass(this)};this.destroyElement=function(j,k){if(!a.cl.core.Utils.isArray(j)){j=[j]}for(var i=0,l=j.length;i<l;i++){g(j[i])}if(h>=d||k===true){f.innerHTML="";h=0}};var g=function(i){try{f.appendChild(i);h++}catch(j){}}});a.Package("a5.cl.mvc.mixins").Mixin("CSS3Props",function(c){c.MustExtend("a5.cl.CLView");c.CSS3Props=function(){};c._cl_processCSS3Prop=function(f,d,e){if(e===true){return a.cl.core.Utils.getCSSProp(f)!==null}return this._cl_css(f,e,true)};c.rotation=function(d){return this._cl_processCSS3Prop("transform",(d===true),"rotate("+d+"deg)",true)};c.maskImage=function(d){return this._cl_processCSS3Prop("maskImage",(d===true),"url("+d+")",true)};c.shadow=function(d){return this._cl_processCSS3Prop("boxShadow",(d===true),d,true)}});a.Package("a5.cl").Import("a5.cl.CLEvent").Extends("CLView").Prototype("CLHTMLView",function(d,c,e){e.customViewDefNodes=["HTML"];this.Properties(function(){this._cl_pendingWrapperProps={};this._cl_currentWrapperProps={};this._cl_handleAnchors=false;this._cl_disallowHrefs=false;this._cl_scrollWidth=null;this._cl_scrollHeight=null;this._cl_cachedHTML=null;this._cl_loadURL=null;this._cl_clickHandlingEnabled=false;this._cl_isInDocument=false});d.CLHTMLView=function(f){d.superclass(this);this.clickHandlingEnabled(true);if(f!==b){this.drawHTML(f)}};d.Override.viewReady=function(){d.superclass().viewReady.call(this);if(this._cl_cachedHTML!==null){this.drawHTML(this._cl_cachedHTML);this._cl_cachedHTML=null}};d.Override.processCustomViewDefNode=function(j,g,f,i,h){if(j==="HTML"){if(this.viewIsReady()){this.drawHTML(g.node.textContent)}else{this._cl_cachedHTML=g.node.textContent}}else{self.superclass().processCustomViewDefNode.apply(this,arguments)}};d.htmlWrapper=function(){return this._cl_viewElement};d.clickHandlingEnabled=function(g){if(typeof g==="boolean"){if(g!==this._cl_clickHandlingEnabled){var f=this}this._cl_viewElement.onclick=!g?null:function(h){f._cl_handleClicks.call(f,h||window.event)};this._cl_clickHandlingEnabled=g;return this}return this._cl_clickHandlingEnabled};d._cl_handleClicks=function(j){var i=j.target||j.srcElement,g,f,h;if(i&&i.tagName.toUpperCase()==="A"){g=i.href;f=g?g.indexOf("#"):null;h=false;if(typeof g!=="undefined"){if(f===0||g.substr(0,f-1)===this.cl().appPath(true)){h=true}if(this._cl_handleAnchors&&h){this.scrollToAnchor(g.substr(f+1));return false}else{if(this._cl_disallowHrefs){return false}return this.handleHrefClick(g)}}}};d.handleAnchors=function(f){if(typeof f==="boolean"){this._cl_handleAnchors=f}return this._cl_handleAnchors};d.scrollToAnchor=function(j){var m=this._cl_viewElement.getElementsByTagName("a"),h,k,g;for(k=0,g=m.length;k<g;k++){if(m[k].getAttribute("name")===j){h=m[k];break}}try{if(h){var f=0;var o=h;do{if(o==this._cl_viewElement){break}f+=o.offsetTop}while(o=o.parentNode);this.parentView().scrollY(f-h.offsetHeight)}}catch(n){}};d.disallowHrefs=function(f){if(typeof f==="boolean"){this._cl_disallowHrefs=f}return this._cl_disallowHrefs};d.handleHrefClick=function(f){return true};d.drawHTML=function(g,f){if(f&&typeof f==="object"){var h=this.plugins().getRegisteredProcess("htmlTemplate");if(h){g=h.populateTemplate(g,f)}}this._cl_replaceNodeValue(this._cl_viewElement,g);return this};d.loadURL=function(g){if(typeof g=="string"){this._cl_loadURL=g;var f=this;this.cl().include(g,function(h){f.drawHTML(h)});return this}return this._cl_loadURL};d.clearHTML=function(){while(this._cl_viewElement.childNodes.length){this._cl_destroyElement(this._cl_viewElement.firstChild)}this.htmlUpdated();return this};d.appendChild=function(f){this._cl_viewElement.appendChild(f);this.htmlUpdated();return this};d.css=function(h,g,f){f=f||false;if(f){h=a.cl.core.Utils.getCSSProp(h)}if(h){this._cl_viewElement.style[h]=g}return this};d.cssClass=function(f){if(typeof f==="string"){this._cl_viewElement.className=f;return this}return this._cl_viewElement.className};d.htmlUpdated=function(f){if(f!==false){this._cl_scrollWidth=this._cl_scrollHeight=null}if((this._cl_height.auto||this._cl_width.auto)&&this.parentView()){this.parentView().redraw()}};d.Override.width=function(f){if(f==="scroll"||f==="content"){this._cl_scrollWidth=this._cl_viewElement.scrollWidth-this._cl_calculatedClientOffset.width;return f==="content"?this._cl_scrollWidth:Math.max(this._cl_scrollWidth+this._cl_calculatedClientOffset.left+this._cl_calculatedOffset.left,this.width("offset"))}return d.superclass().width.apply(this,arguments)};d.Override.height=function(f){if(f==="scroll"||f==="content"){this._cl_scrollHeight=this._cl_viewElement.scrollHeight-this._cl_calculatedClientOffset.height;return f==="content"?this._cl_scrollHeight:Math.max(this._cl_scrollHeight+this._cl_calculatedClientOffset.top+this._cl_calculatedOffset.top,this.height("offset"))}return d.superclass().height.apply(this,arguments)};d.Override._cl_redraw=function(i,h){var j=d.superclass()._cl_redraw.call(this,i,true);if(j.shouldRedraw){this._cl_pendingViewElementProps.paddingTop=this._cl_calculatedClientOffset.top+"px";this._cl_pendingViewElementProps.paddingRight=this._cl_calculatedClientOffset.right+"px";this._cl_pendingViewElementProps.paddingBottom=this._cl_calculatedClientOffset.bottom+"px";this._cl_pendingViewElementProps.paddingLeft=this._cl_calculatedClientOffset.left+"px";this._cl_pendingViewElementProps.width=this._cl_intFromPX(this._cl_pendingViewElementProps.width)-this._cl_calculatedClientOffset.width+"px";this._cl_pendingViewElementProps.height=this._cl_intFromPX(this._cl_pendingViewElementProps.height)-this._cl_calculatedClientOffset.height+"px";if(h!==true){this._cl_render()}if(!this._cl_isInDocument&&a.cl.core.Utils.elementInDocument(this._cl_viewElement)){this._cl_isInDocument=true;if(this._cl_viewElement.innerHTML!==""&&(this._cl_width.auto||this._cl_height.auto)){var g=[];for(var f=0,k=this._cl_viewElement.childNodes.length;f<k;f++){g.push(this._cl_viewElement.childNodes[f])}this._cl_replaceNodeValue(this._cl_viewElement,g)}}}return j};d._cl_intFromPX=function(f){return parseInt(f.replace(/px$/i,""))};d._cl_replaceNodeValue=function(h,i){function f(){if(!this._cl_initialized){this.cl().removeEventListener(c.CLEvent.GLOBAL_UPDATE_TIMER_TICK,f,false);return}if(h.innerHTML!==""){if(j){h.style.width="auto"}if(g){h.style.height="auto"}this.cl().removeEventListener(c.CLEvent.GLOBAL_UPDATE_TIMER_TICK,f,false);this.dispatchEvent("CONTENT_UPDATED");this.htmlUpdated(false)}}var j=(h===this._cl_viewElement)?this._cl_width.auto:(h.style.width==="auto"),g=(h===this._cl_viewElement)?this._cl_height.auto:(h.style.height==="auto");if(j){h.style.width=0}if(g){h.style.height=0}while(h.childNodes.length){h.removeChild(h.firstChild)}this._cl_scrollWidth=this._cl_scrollHeight=null;if(i!=""){this.cl().addEventListener(c.CLEvent.GLOBAL_UPDATE_TIMER_TICK,f,false,this)}else{this.dispatchEvent("CONTENT_UPDATED");this.htmlUpdated(false)}if(typeof i=="string"){h.innerHTML=i}else{if(a.cl.core.Utils.isArray(i)){while(i.length){h.appendChild(i.shift())}}else{h.appendChild(i)}if(j){h.style.width="auto"}if(g){h.style.height="auto"}}};d.dealloc=function(){this._cl_viewElement.onclick=null}});a.Package("a5.cl").Extends("CLView").Import("a5.ContractAttribute","a5.cl.mvc.CLViewContainerEvent").Static(function(c){c.redrawLog={};c.logRedraw=function(d){var e=d.instanceUID();if(c.redrawLog[e]){c.redrawLog[e]++}else{c.redrawLog[e]=1}};c.getRedrawCounts=function(){var f=[];for(var h in c.redrawLog){f.push({id:h,count:c.redrawLog[h]})}f.sort(function(j,i){return i.count-j.count});for(var e=0,g=f.length;e<g;e++){var d=f[e]}};c.clearRedrawLog=function(){c.redrawLog={}};c.viewAffectsAutoWidth=function(d){return(d.visible()&&d._cl_width.percent===false&&d._cl_width.relative===false&&d._cl_alignX!=="right")||(d._cl_minWidth!==null&&d._cl_width.inner<=d._cl_minWidth)};c.viewAffectsAutoHeight=function(d){return(d.visible()&&d._cl_height.percent===false&&d._cl_height.relative===false&&d._cl_alignY!=="bottom")||(d._cl_minHeight!==null&&d._cl_height.inner<=d._cl_minHeight)}}).Prototype("CLViewContainer",function(e,c,d){this.Properties(function(){this._cl_childViews=[];this._cl_queuedLoads=[];this._cl_relX=false;this._cl_relY=false;this._cl_outerW=null;this._cl_outerH=null;this._cl_lockedVal=false;this._cl_pendingChildren=0;this._cl_isInitialVDReady=true;this._cl_constrainChildren=false;this._cl_scrollXEnabled={value:false,state:false};this._cl_scrollYEnabled={value:false,state:false};this._cl_passDataToChildren=true;this._cl_passedData=null;this._cl_scrollLeftVal=null;this._cl_scrollTopVal=null;this._cl_childViewTarget=this});e.CLViewContainer=function(){e.superclass(this)};e.constrainChildren=function(f){return this._cl_propGetSet("_cl_constrainChildren",f)};e.passDataToChildren=function(f){return this._cl_propGetSet("_cl_passDataToChildren",f)};e.Override.renderFromData=function(h){if(this._cl_passDataToChildren){this._cl_passedData=h;for(var g=0,f=this._cl_childViews.length;g<f;g++){this._cl_childViews[g].renderFromData(h)}}a.cl.CLViewContainer.superclass().renderFromData.apply(this,arguments)};e.relX=function(h){if(h!==b){this._cl_relX=h;if(h===false){for(var g=0,f=this._cl_childViews.length;g<f;g++){this._cl_childViews[g]._cl_x.state=false}}this.redraw();return this}return this._cl_relX};e.relY=function(h){if(h!==b){this._cl_relY=h;if(h===false){for(var g=0,f=this._cl_childViews.length;g<f;g++){this._cl_childViews[g]._cl_y.state=false}}this.redraw();return this}return this._cl_relY};e.scrollXEnabled=function(f){if(f!==b){if(f==="state"){return this._cl_scrollXEnabled.state}this._cl_scrollXEnabled.value=f;return this}return this._cl_scrollXEnabled.value};e.scrollYEnabled=function(f){if(f!==b){if(f==="state"){return this._cl_scrollYEnabled.state}this._cl_scrollYEnabled.value=f;return this}return this._cl_scrollYEnabled.value};e.scrollY=function(h,g){if(h!==b){var f;if(typeof h==="number"){f=h}else{f=h.y(true)}if(g!==b){f+=g}this._cl_scrollTopVal=f;this.redraw();return f}else{return this._cl_viewElement.scrollTop}};e.scrollX=function(h,g){if(h!==b){var f;if(typeof h==="number"){f=h}else{f=h.y(true)}if(g!==b){f+=g}this._cl_scrollLeftVal=f;this.redraw();return f}else{return this._cl_viewElement.scrollLeft}};e.subViewCount=function(){return this._cl_childViewTarget._cl_childViews.length};e.subViewAtIndex=function(f){return this._cl_childViewTarget._cl_childViews[f]};e.subViewWithName=function(g){for(var h=0,f=this._cl_childViewTarget._cl_childViews.length;h<f;h++){if(this._cl_childViewTarget._cl_childViews[h].mvcName()==g){return this._cl_childViewTarget._cl_childViews[h]}}return null};e.subViewToTop=function(f){if(!this._cl_childViewTarget._cl_lockedVal){this._cl_childViewTarget._cl_childViews.splice(f.index(),1);this._cl_childViewTarget._cl_childViews.push(f);this._cl_childViewTarget._cl_orderChildren()}else{this._cl_throwLockedError()}};e.subViewToBottom=function(f){if(!this._cl_childViewTarget._cl_lockedVal){this._cl_childViewTarget._cl_childViews.splice(f.index(),1);this._cl_childViewTarget._cl_childViews.unshift(f);this._cl_childViewTarget._cl_orderChildren()}else{this._cl_throwLockedError()}};e._cl_orderChildren=function(){for(var h=0,f=this._cl_childViews.length;h<f;h++){var g=this._cl_childViews[h]._cl_viewElement,j=g?g.scrollTop:0,k=g?g.scrollLeft:0;this._cl_viewElement.appendChild(g);this._cl_childViews[h]._cl_setIndex(h);this.redraw();g.scrollTop=j;g.scrollLeft=k}};e._cl_addChildView=function(g,f,i){if(!this._cl_lockedVal){if(!(this instanceof a.cl.mvc.core.WindowContainer)&&g instanceof a.cl.CLWindow){this.throwError("Cannot add a CLWindow to a generic view container.");return}if(g.parentView() instanceof a.cl.CLViewContainer&&g.parentView()!==this){g.parentView().removeSubView(g,false)}var h=(typeof f=="number")?f:null;if(h>this._cl_childViews.length-1){h=null}this.willAddView();g.draw(this);this.viewAdded();g._cl_addedToParent(this);if(i){i(g)}if(h!==null){this._cl_childViews.splice(h,0,g)}else{this._cl_childViews.push(g)}g._cl_setParent(this);this._cl_orderChildren();if(this._cl_passDataToChildren&&this._cl_passedData){g.renderFromData(this._cl_passedData)}}else{this._cl_throwLockedError()}};e.containsSubView=function(g){for(var h=0,f=this._cl_childViewTarget._cl_childViews.length;h<f;h++){if(this._cl_childViewTarget._cl_childViews[h]==g){return true}}return false};e.removeSubView=function(h,g){if(!this._cl_childViewTarget._cl_lockedVal){var k=g===false?false:true;for(var j=0,f=this._cl_childViewTarget._cl_childViews.length;j<f;j++){if(this._cl_childViewTarget._cl_childViews[j]===h){this.willRemoveView(h);this.dispatchEvent(a.cl.mvc.CLViewContainerEvent.WILL_REMOVE_VIEW,{view:h});this._cl_childViewTarget._cl_childViews.splice(j,1);h._cl_parentView=null;h._cl_removedFromParent(this);if(h._cl_viewElement&&h._cl_viewElement.parentNode===this._cl_viewElement){this._cl_childViewTarget._cl_viewElement.removeChild(h._cl_viewElement)}this.viewRemoved(h);this.dispatchEvent(a.cl.mvc.CLViewContainerEvent.VIEW_REMOVED,{view:h});if(k===true){h.destroy()}if(this._cl_childViewTarget._cl_relX||this._cl_childViewTarget._cl_relY||this._cl_childViewTarget._cl_width.auto||this._cl_childViewTarget._cl_height.auto){this.redraw()}return}}this.warn("Unable to remove subview "+(h.id()||h.instanceUID())+".  Subview is not a child of the view container.")}else{this._cl_throwLockedError()}};e.removeAllSubViews=function(f){while(this.subViewCount()){this.removeViewAtIndex(0,f)}return this};e.removeViewAtIndex=function(h,g){var f=this._cl_childViewTarget._cl_childViews[h];this.removeSubView(f,g)};e.replaceView=function(j,k){var h;for(var g=0,f=this._cl_childViewTarget._cl_childViews.length;g<f;g++){if(this._cl_childViewTarget._cl_childViews[g]===h){h=this._cl_childViewTarget._cl_childViews[g]}break}if(h){this.replaceViewAtIndex(k,h.index())}else{this.redirect(500,"cannot replace view "+(h.id()||h.instanceUID())+", view is not a child of container "+this.instanceUID())}};e.replaceViewAtIndex=function(g,f){this.removeViewAtIndex(f);this.addSubViewAtIndex(g,f)};e.swapViewsAtIndex=function(g,f){if(!this._cl_lockedVal){var i=this._cl_childViewTarget._cl_childViews,h=i.length;if(g<0){g=0}if(f<0){f=0}if(g>h-1){g=h-1}if(f>h-1){g=h-1}if(g!=f){var j=i[g];i[g]=i[f];i[f]=j;this._cl_childViewTarget._cl_orderChildren()}}else{this._cl_throwLockedError()}};e.addSubView=this.Attributes(["Contract",{view:"a5.cl.CLView",callback:"function=null"}],function(f){if(f){this._cl_childViewTarget._cl_addChildView(f.view,null,f.callback)}});e.addSubViewAtIndex=function(f,g,h){this._cl_childViewTarget._cl_addChildView(f,g,h)};e.addSubViewBelow=function(f,g,h){this.addSubViewAtIndex(f,(parseInt(g.index())-1),h)};e.addSubViewAbove=function(f,g,h){this.addSubViewAtIndex(f,(parseInt(g.index())+1),h)};e.Override.width=function(f){if(f==="scroll"){return Math.max(this._cl_width.content+this._cl_calculatedClientOffset.left+this._cl_calculatedOffset.left,this._cl_width.offset)}else{return e.superclass().width.apply(this,arguments)}};e.Override.height=function(f){if(f==="scroll"){return Math.max(this._cl_height.content+this._cl_calculatedClientOffset.top+this._cl_calculatedOffset.top,this._cl_height.offset)}else{return e.superclass().height.apply(this,arguments)}};e.Override.suspendRedraws=function(h,g){if(typeof h==="boolean"){for(var f=0,i=this.subViewCount();f<i;f++){this.subViewAtIndex(f).suspendRedraws(h,true)}}return e.superclass().suspendRedraws.call(this,h)};e.Override._cl_redraw=function(g,o){var n=this._cl_redrawPending,x=e.superclass()._cl_redraw.call(this,g,true),z=a.cl.mvc.core.EnvManager.instance().scrollBarWidth(),t=c.CLView._cl_viewCanRedraw(this),v=false,A=false;if(t){this._cl_width.inner=this._cl_width.client-(this._cl_scrollYEnabled.state?z:0);this._cl_height.inner=this._cl_height.client-(this._cl_scrollXEnabled.state?z:0);n=n||x.force;var C=0,m=0,r,p,B,k,w,u,j=false,s=false,y=false,f=false,q=[];for(w=0,u=this._cl_childViews.length;w<u;w++){r=this._cl_childViews[w];if(((this._cl_height.auto||this._cl_scrollYEnabled.value)&&r._cl_height.percent!==false)||((this._cl_width.auto||this._cl_scrollXEnabled.value)&&r._cl_width.percent!==false)){q.push(r)}if(this._cl_relX||this._cl_relY){if(w>0){p=this._cl_childViews[w-1];if(this._cl_relX){r._cl_x.state=p.x(true)+r.x()+p.width()}if(this._cl_relY){r._cl_y.state=p.y(true)+r.y()+p.height()}}else{if(this._cl_relX){r._cl_x.state=r.x()}if(this._cl_relY){r._cl_y.state=r.y()}}}r._cl_redraw(g||n,true);if(d.viewAffectsAutoWidth(r)){B=r.width()+r.x(true);if(B>C){C=B}}if(d.viewAffectsAutoHeight(r)){k=r.height()+r.y(true);if(k>m){m=k}}}v=this._cl_width!==C;A=this._cl_height!==m;this._cl_height.content=m;this._cl_width.content=C;for(w=0,u=q.length;w<u;w++){r=q[w];if((r._cl_width.percent!==false&&v)||(r._cl_height.percent!==false&&A)){r._cl_redraw(g||n,true)}}if(this._cl_width.auto!==false||this._cl_height.auto!==false){e.superclass()._cl_redraw.call(this,true,true);this._cl_height.content=m;this._cl_width.content=C;this._cl_alertParentOfRedraw()}if(this._cl_scrollXEnabled.value&&C>this._cl_width.client+this._cl_calculatedClientOffset.right){j=true}if(this._cl_scrollYEnabled.value&&m>this._cl_height.client+this._cl_calculatedClientOffset.bottom){s=true}if((this._cl_scrollXEnabled.value&&this._cl_scrollYEnabled.value)&&z>0&&((j&&!s)||(s&&!j))){if(s&&(this._cl_width.client-z)<C){j=true}else{if(j&&(this._cl_height.client-z)<m){s=true}}}if(s!==this._cl_scrollYEnabled.state){this._cl_scrollYEnabled.state=s;this._cl_pendingViewElementProps.overflowY=s?"auto":(this._cl_showOverflow?"visible":"hidden");f=true}if(j!==this._cl_scrollXEnabled.state){this._cl_scrollXEnabled.state=j;this._cl_pendingViewElementProps.overflowX=j?"auto":(this._cl_showOverflow?"visible":"hidden");y=true}this._cl_width.inner=this._cl_width.client-(this._cl_scrollYEnabled.state?z:0);this._cl_height.inner=this._cl_height.client-(this._cl_scrollXEnabled.state?z:0);if(z>0&&(y||f)){for(w=0,u=this._cl_childViews.length;w<u;w++){this._cl_childViews[w]._cl_redraw(true)}}else{for(w=0,u=this._cl_childViews.length;w<u;w++){this._cl_childViews[w]._cl_render()}}if("ontouchstart" in window){var h=a.cl.core.Utils.getCSSProp("overflowScrolling");if(h){this._cl_pendingViewElementProps[h]="touch"}}if(o!==true){this._cl_render()}}return x};e.Override._cl_render=function(){e.superclass()._cl_render.call(this);if(this._cl_scrollLeftVal){this._cl_viewElement.scrollLeft=this._cl_scrollLeftVal;this._cl_scrollLeftVal=null}if(this._cl_scrollTopVal){this._cl_viewElement.scrollTop=this._cl_scrollTopVal;this._cl_scrollTopVal=null}};e._cl_locked=function(f){return this._cl_propGetSet("_cl_lockedVal",f,"boolean")};e._cl_throwLockedError=function(){this.redirect(500,"Error: attempted to modify child views on a structure locked view.")};e._cl_childRedrawn=function(f,k){var i=this._cl_width.auto!==false&&(k.width||k.x)&&d.viewAffectsAutoWidth(f),o=this._cl_height.auto!==false&&(k.height||k.y)&&d.viewAffectsAutoHeight(f),l=this._cl_relX&&(k.width||k.x),j=this._cl_relY&&(k.height||k.y),n=this._cl_scrollXEnabled.value&&(k.width||k.x),m=this._cl_scrollYEnabled.value&&(k.height||k.y),g=f._cl_alignY!=="top"&&(k.height||k.y),h=f._cl_alignX!=="left"&&(k.width||k.x);if(i||o||l||j||n||m||h||g){this.redraw()}};e.Override._cl_addedToTree=function(){e.superclass()._cl_addedToTree.call(this);for(var g=0,f=this.subViewCount();g<f;g++){this.subViewAtIndex(g)._cl_addedToTree()}};e.Override._cl_removedFromTree=function(){e.superclass()._cl_removedFromTree.call(this);for(var g=0,f=this.subViewCount();g<f;g++){this.subViewAtIndex(g)._cl_removedFromTree()}};e.getChildView=function(j){var f,i,h,g;for(f=0,i=this.subViewCount();f<i;f++){h=this.subViewAtIndex(f);if(h._cl_controller){continue}if(h.id()===j){return h}g=h instanceof d?h.getChildView(j):false;if(g){return g}}return null};e.getChildViews=function(){return this._cl_childViews.slice(0)};e.getMaximumViewDepth=function(){var f=0;if(this.subViewCount()>0){(function(i,j){j++;if(j>f){f=j}for(var g=0,k=i.subViewCount();g<k;g++){var h=i.subViewAtIndex(g);if(h.subViewCount()>0){arguments.callee.call(this,h)}}})(this,0)}return f};e.Override._cl_vdViewReady=function(){this.childrenReady(this._cl_isInitialVDReady);this._cl_isInitialVDReady=this._cl_buildingFromViewDef=false;e.superclass()._cl_vdViewReady.call(this)};e._cl_vdViewAdded=function(){this._cl_pendingChildren--;if(this._cl_pendingChildren<=0){this._cl_vdViewReady()}};e.childrenReady=function(f){this.dispatchEvent(c.CLViewContainerEvent.CHILDREN_READY)};e.willAddView=function(f){};e.willRemoveView=function(f){};e.viewRemoved=function(){};e.viewAdded=function(){};e.dealloc=function(){this._cl_lockedVal=false;this.removeAllSubViews(true)}});a.Package("a5.cl").Extends("CLViewContainer").Prototype("CLWindow",function(d,c){this.Properties(function(){this._cl_windowLevel=a.cl.CLWindowLevel.APPLICATION;this._cl_isRootWindow=false});d.CLWindow=function(){d.superclass(this);this._cl_width.percent=this._cl_height.percent=1;this._cl_width.value=this._cl_height.value="100%";d.backgroundColor.call(this,"#fff")};d.isRootWindow=function(){return this._cl_isRootWindow};d.application=function(){return this.MVC().application()};d.Override.moveToParentView=function(e){this.throwError("moveToParentView is not a valid manipulation method on a5.cl.CLWindow.")};d.didFinishLoading=function(e){};d.Override.hide=function(){if(!this.isRootWindow()){a.cl.CLWindow.superclass().hide.call(this)}};d._cl_setRootWindow=function(){this._cl_isRootWindow=true}});a.Package("a5.cl").Static(function(c){c.APPLICATION="Application";c.MODAL="Modal";c.CONTEXT="Context";c.ALERT="Alert";c.SYSTEM="System"}).Class("CLWindowLevel",function(){});a.Package("a5.cl").Import("a5.cl.core.viewDef.ViewDefParser").Extends("CLMVCBase").Mix("a5.cl.mixins.Binder").Prototype("CLController",function(d,c,e){e.ASSUME_XML_VIEW="clControllerAssumeXMLView";this.Properties(function(){this._cl_view=null;this._cl_mappable=false;this._cl_viewDefDefaults=[];this._cl_viewDefParser=null;this._cl_viewDefCallback=null;this._cl_viewDefCallbackScope=null;this._cl_defaultViewDef=null;this._cl_viewReadyPending=true;this._cl_renderTarget=null;this._cl_orphanage=[];this._cl_childControllers=[];this._cl_id=null;this._cl_viewIsInTree=false});d.CLController=function(f){var g=e.instance();if(g&&g._cl_mappable){this.throwError("Cannot create multiple instances of a controller which has a mapping associated with it.");return}d.superclass(this);this._cl_setMVCName(this.className().replace("Controller",""));if(f===e.ASSUME_XML_VIEW){this.defaultViewDefinition(e.ASSUME_XML_VIEW)}else{if(typeof f==="string"){this.defaultViewDefinition(f)}else{if(f instanceof a.cl.CLView){this._cl_viewCreated(f);this._cl_viewReady()}else{if(f===true){this._cl_viewCreated(this.create(a.cl.CLViewContainer));this._cl_viewReady()}}}}};d.index=function(f){this.render()};d.view=function(){return this._cl_view};d.id=function(f){if(typeof f==="string"){this._cl_id=f;return this}return this._cl_id||this.instanceUID()};d.generateView=function(k,i){if(this._cl_view){if(typeof k==="function"){k.call(i,this._cl_view)}}else{var j=/<.+>/.test(this._cl_defaultViewDef);if(j){this._cl_buildViewDef(this._cl_defaultViewDef,k,i)}else{var g,h=false,f=this;if(this._cl_defaultViewDef){if(this._cl_defaultViewDef===e.ASSUME_XML_VIEW){h=true;g=this.config().applicationViewPath+this.mvcName()+".xml"}else{g=(this._cl_defaultViewDef.indexOf("://")==-1?this.config().applicationViewPath:"")+this._cl_defaultViewDef}}this.cl().include(g,function(l){f._cl_buildViewDef(l,k,i)},null,function(l){if(h){f._cl_viewCreated(f.create(a.cl.CLViewContainer));f._cl_viewReady();k.call(i,f._cl_view)}else{f.redirect(404,g)}})}}};d.viewReady=function(){};d.render=function(f,h){var h=typeof f==="function"?f:h,g;this.generateView(function(j){g=this._cl_renderTarget||j;if(f instanceof a.cl.CLWindow){g=a.cl.mvc.core.AppViewContainer.instance()}if(f instanceof a.cl.CLView){if(!g.containsSubView(f)){if(!(g instanceof a.cl.mvc.core.AppViewContainer)){g.removeAllSubViews(false);g.addSubView(f)}else{g.addWindow(f)}}this._cl_renderComplete(h)}else{if(f instanceof e){var i=this;f.generateView(function(k){if(!g.containsSubView(k)){g.removeAllSubViews(false);g.addSubView(k)}i._cl_renderComplete(h)})}else{this._cl_renderComplete(h)}}},this)};d._cl_renderComplete=function(f){if(this._cl_mappable){this.MVC().application().dispatchEvent(this.create(c.CLEvent,[c.CLEvent.RENDER_CONTROLLER,false]),{controller:this})}if(f){f.call(this)}};d.renderTarget=function(f){if(f!==b){this._cl_renderTarget=f;return this}return this._cl_renderTarget||this._cl_view};d.Override.bind=function(j,i,k,f,g,h){d.mixins().bind.call(this,j,i,k,f,g,h)};d._cl_viewAddedToTree=function(){if(!this.bindingsConnected()){this.setBindingEnabled(true)}this.cl().addEventListener(c.CLEvent.CLIENT_ENVIRONMENT_UPDATED,this.clientEnvironmentUpdated,false,this);this.cl().addEventListener(c.CLEvent.ORIENTATION_CHANGED,this.orientationChanged,false,this);this._cl_viewIsInTree=true;this.viewAddedToTree()};d.viewAddedToTree=function(){};d._cl_viewRemovedFromTree=function(){if(this._cl_bindingsConnected){this.setBindingEnabled(false)}this.cl().removeEventListener(c.CLEvent.CLIENT_ENVIRONMENT_UPDATED,this.clientEnvironmentUpdated);this.cl().removeEventListener(c.CLEvent.ORIENTATION_CHANGED,this.orientationChanged);this._cl_viewIsInTree=false;this.viewRemovedFromTree()};d.viewRemovedFromTree=function(){};d.viewIsInTree=function(){return this._cl_viewIsInTree};d.defaultViewDefinition=function(f){if(typeof f==="string"){this._cl_defaultViewDef=f;return this}return this._cl_defaultViewDef};d.getChildController=function(i){var f,h,g;for(f=0,h=this._cl_childControllers.length;f<h;f++){g=this._cl_childControllers[f];if(g.id()===i){return g}}return null};d.orientationChanged=function(f){if(this._cl_viewDefParser&&this._cl_viewDefParser.hasOrientationOptions()){this._cl_viewDefParser.parse()}};d.clientEnvironmentUpdated=function(f){if(this._cl_viewDefParser&&this._cl_viewDefParser.hasEnvironmentOptions()){this._cl_viewDefParser.parse()}};d.processCustomViewDefNode=function(j,g,f,i,h){};d.setMappable=function(){if(e.instanceCount()>1){return this.throwError("Cannot call setMappable on a controller with multiple instances.")}this._cl_mappable=true};d._cl_buildViewDef=function(h,g,f){this._cl_viewDefCallback=g;this._cl_viewDefCallbackScope=f;this._cl_viewDefParser=this.create(c.ViewDefParser,[h,this]);this._cl_viewDefParser.parse(this._cl_viewCreated,this._cl_viewDefComplete,this)};d._cl_viewCreated=function(f){this._cl_view=f;f._cl_controller=this};d._cl_viewDefComplete=function(f){if(this._cl_viewDefCallback){this._cl_viewDefCallback.call(this._cl_viewDefCallbackScope,f)}this._cl_viewReady()};d._cl_viewReady=function(){if(this._cl_viewReadyPending){this._cl_viewReadyPending=false;this.viewReady()}};d.dealloc=function(){if(this.view()){this.view().destroy()}}});a.Package("a5.cl").Extends("CLController").Prototype("CLApplication",function(d,c){this.Properties(function(){this._cl_activePresenter=null;this._cl_rootWindow=null});d.CLApplication=function(){d.superclass(this);this.addEventListener(c.CLEvent.RENDER_CONTROLLER,this._cl_eRenderControllerHandler,false,this);this.cl().addOneTimeEventListener(c.CLEvent.APPLICATION_WILL_RELAUNCH,this.applicationWillRelaunch);this.cl().addEventListener(c.CLEvent.ONLINE_STATUS_CHANGE,this.onlineStatusChanged);this.cl().addOneTimeEventListener(c.CLEvent.APPLICATION_CLOSED,this.applicationClosed);this.cl().addOneTimeEventListener(c.CLEvent.AUTO_INSTANTIATION_COMPLETE,this.autoInstantiationComplete);this.cl().addOneTimeEventListener(c.CLEvent.APPLICATION_WILL_LAUNCH,this.applicationWillLaunch);this.cl().addOneTimeEventListener(c.CLEvent.APPLICATION_LAUNCHED,this.applicationLaunched);this._cl_view=this.create(a.cl.mvc.core.AppViewContainer);this.viewReady();return[false]};d.addWindow=function(e){return this.view().addWindow(e)};d.removeWindow=function(e,f){return this.view().removeWindow(e,f)};d.containsWindow=function(e){return this.view().containsWindow(e)};d.backgroundColor=function(e){if(e){document.body.style.backgroundColor=e;return this}return document.body.style.backgroundColor};d.activePresenter=function(){return this._cl_activePresenter};d.Override.viewReady=function(){};d.activePresenterChanged=function(e){};d.onlineStatusChanged=function(e){};d.autoInstantiationComplete=function(){};d.rootWindowLoaded=function(e){if(!this._cl_renderTarget){this._cl_renderTarget=e}this._cl_rootWindow=e};d.applicationWillLaunch=function(){};d.applicationLaunched=function(){};d.applicationWillClose=function(){};d.applicationClosed=function(){};d.applicationWillRelaunch=function(){};d.rootWindow=function(){return this._cl_rootWindow};d._cl_renderError=function(j,n,g){if(!this._cl_errorStopped){var k=n.replace(/\n/g,"<br/>")+"<br/>";if(j===500){if(g){if(g.line&&g.url){k+=g.url+", "+g.line+"<br/>"}if(g.stack&&typeof g.stack=="object"){if(g.stack.length){k+="<br/><br/>Call Stack ["+g.stack.length+"]:<br/>";for(var h=0,e=g.stack.length;h<e;h++){k+=unescape(g.stack[h])+"<br/>"}}else{k+="<br/><br/>Call stack not supported."}}}}var m=this.create(a.cl.mvc.core.SystemWindow);this.addWindow(m);m.scrollYEnabled(true).scrollXEnabled(true);var f=a.Create(a.cl.CLHTMLView);f.height("auto").padding(30).alignX("center").alignY("middle");m.addSubView(f);f.drawHTML(a.cl.core.Utils.generateSystemHTMLTemplate(j,k));if(j==500){this._cl_errorStopped=true;a.cl.core.GlobalUpdateTimer.instance()._cl_killTimer()}}};d._cl_eRenderControllerHandler=function(g){this.render(g.data().controller.view());var f=this._cl_activePresenter;this._cl_activePresenter=g.data().controller;if(f!==this._cl_activePresenter){this.activePresenterChanged(this._cl_activePresenter)}}});a.Package("a5.cl.plugins.hashManager").Import("a5.cl.CLEvent").Extends("a5.cl.CLPlugin").Class("HashManager","singleton final",function(p,n,q){var e,d,g,k,o;p.HashManager=function(){p.superclass(this);g=null;e=null;k=false;p.configDefaults({delimiter:"#!"});j()};p.Override.initializePlugin=function(){o=p.pluginConfig().delimiter;if(h(true)==""){i(o)}};p.initialize=function(){f();var r=p.cl().clientPlatform()==="IE"&&p.cl().browserVersion()<9;if("onhashchange" in window&&!r){window.onhashchange=f}else{p.cl().addEventListener(n.CLEvent.GLOBAL_UPDATE_TIMER_TICK,f)}};p.getHash=function(r){if(r===true){return e}else{var s=e.split("/");s.shift();return s}};p.setHash=function(v,w,u){var s="";if(v instanceof Array){v=v.join("/")}if(v==null||v=="/"){v=""}if(u===true||(v!==e&&v!==h())){if(v==""){if(w===true){e=o}i(o)}else{if(typeof v=="object"){for(var t=0,r=v.length;t<r;t++){if(v[t]==b&&v[t]==null){v.splice(t,1);r=v.length;t--}}for(t=0,r=v.length;t<r;t++){s+=(v[t]+(t<v.length-1?"/":""))}}else{s=v}if(s.substr(0,1)=="/"){s=s.substr(1)}if(s.substr(0,o.length)!=o){s=o+"/"+s}if(w===true){e=s}i(s)}if(u){k=true;f()}}};var m=function(s){s=s.substring(o.length);var r=s.split("/");if(r[0]===""){r.shift()}return r},f=function(){var s=h();if(s!=e||k){k=false;e=s;if(g&&e!=null){i(e)}var r=m(e);p.dispatchEvent(n.CLHashEvent.HASH_CHANGE,{hashArray:r})}},h=function(r){var t;if(g){try{if(e!=location.hash){t=location.hash}else{t=c().body.innerText}}catch(s){t=e||""}}else{t=location.hash}return t},j=function(){if(p.cl().clientPlatform()=="IE"&&p.cl().browserVersion()<8){l()}else{if(history.navigationMode){history.navigationMode="compatible"}}},i=function(s,r){var u=r||false;if(!u){location.hash=s}if(g){var t=c();t.open();t.write("<html><body>"+s+"</body></html>");t.close()}},l=function(){g=document.createElement("iframe");g.style.display="none";document.getElementsByTagName("head")[0].appendChild(g)},c=function(){return(g.contentDocument)?g.contentDocument:g.Document}});a.Package("a5.cl.plugins.hashManager").Extends("a5.cl.CLEvent").Prototype("CLHashEvent",function(d,c,e){e.HASH_CHANGE="clHashChangeEvent";d.CLHashEvent=function(){d.superclass(this)}});a.Package("a5.cl.mvc").Import("a5.cl.CLEvent","a5.cl.plugins.hashManager.CLHashEvent").Extends("a5.cl.CLAddon").Class("MVC",function(d,l,n){var i,u,r,q,k,f,o,e,s,h=true,p;d.MVC=function(){d.superclass(this);d.configDefaults({rootController:null,rootViewDef:null,rootWindow:null});d.createMainConfigMethod("filters");d.createMainConfigMethod("mappings")};this.rootController=function(){return p};this.rootWindow=function(){return s};this.application=function(){return f};this.mappings=function(){return i};this.filters=function(){return u};this.hash=function(){return q};this.redrawEngine=function(){return r};this.locationManager=function(){return k};this.garbageCollector=function(){return o};this.envManager=function(){return e};this.triggerAppRedraw=function(){this.redrawEngine().triggerAppRedraw()};this.addFilter=function(x,w){return this.MVC().filters().addFilter(x,w)};this.addMapping=function(x,w){return this.MVC().mappings().addMapping(x,w)};this.applicationRenderTarget=function(w){if(w!==b){f.renderTarget(w);return this}return f.renderTarget()};d.Override.initializePlugin=function(){var w=a.GetNamespace(d.cl().applicationPackage(true)+".Application");if(w){f=d.create(w);if(!f instanceof a.cl.CLApplication){throw"Error: application must extend a5.cl.CLApplication."}}else{f=d.create(a.cl.CLApplication)}if(d.cl().clientEnvironment()=="MOBILE"){a.cl.mvc.core.AppSetup.mobileSetup()}else{if(d.cl().clientEnvironment()=="TABLET"){a.cl.mvc.core.AppSetup.tabletSetup()}else{if(d.cl().clientEnvironment()=="DESKTOP"){a.cl.mvc.core.AppSetup.desktopSetup()}}}r=d.create(a.cl.mvc.core.RedrawEngine);e=d.create(a.cl.mvc.core.EnvManager);i=d.create(a.cl.mvc.core.Mappings);u=d.create(a.cl.mvc.core.Filters);q=d.plugins().HashManager();o=d.create(a.cl.mvc.core.GarbageCollector);k=d.create(a.cl.mvc.core.LocationManager);k.addEventListener("CONTROLLER_CHANGE",c);q.addEventListener(l.CLHashEvent.HASH_CHANGE,v);d.cl().addOneTimeEventListener(l.CLEvent.DEPENDENCIES_LOADED,t);d.cl().addOneTimeEventListener(l.CLEvent.APPLICATION_WILL_LAUNCH,g);d.cl().addEventListener(l.CLEvent.ERROR_THROWN,j);a.cl.core.Utils.purgeBody();d.application().view().draw();d.cl().addOneTimeEventListener(l.CLEvent.APPLICATION_PREPARED,m)};var m=function(){var w=d.getMainConfigProps("filters");u.addAppFilters(w);var x=d.getMainConfigProps("mappings");i.addAppMappings(x)};this.windowProps=function(){return e.windowProps()};this.redirect=function(z,y,x){if(k){return k.redirect(z,y,x)}else{if(z===500){var w=y instanceof a.Error;if(w&&!y.isWindowError()){this.throwError(y)}else{throw y}}}};d.setTitle=function(y,w){var z=d.config().appName,x=d.config().titleDelimiter;if(y!==b){if(w===true){z=z+x+y}else{if(w!==b){z=z+w+y}else{z=y}}}document.title=z};var j=function(w){d.redirect(w)};var t=function(){e.windowProps(true)};var g=function(){q.initialize();document.body.tabIndex=0;document.body.focus();document.body.removeAttribute("tabIndex");s.didFinishLoading(d.application())};var c=function(z){var y,x=z.data(),w=x.action?x.action:"index";if(x.controller instanceof a.cl.CLController){y=x.controller}else{y=d.cl()._core().instantiator().getClassInstance("Controller",x.controller,true)}if(!y){d.redirect(500,"Error trying to instantiate controller "+x.controller+', controller does not exist in package "'+d.config().applicationPackage+'.controllers".');return}if(!y._cl_mappable){y.setMappable()}if(typeof y[w]==="function"){y[w].apply(y,(x.id||[]))}else{d.redirect(500,'Error calling action "'+w+'" on controller "'+x.controller+'", action not defined.')}if(h){h=false;a.cl.mvc.core.AppViewContainer.instance()._cl_initialRenderCompete()}};var v=function(w){k.processMapping(w.data().hashArray)};d.Override.initializeAddOn=function(){var A=a.cl.core.ResourceCache.instance(),B=false,y=d.pluginConfig();var w=function(){if(y.rootWindow){var E=applicationPackage+".views."+y.rootWindow;if(a.GetNamespace(E)){windowSourceLoaded(E)}else{d.throwError('root window specified in namespace "'+E+'" does not exist.')}}else{D(a.cl.CLWindow)}};var D=function(E){s=d.create(E);p._cl_view=s;C()};var C=function(){s._cl_setRootWindow();d.application().addWindow(s);z()};var z=function(){if(s){d.application().rootWindowLoaded(s)}if(B){d.dispatchEvent(a.cl.CLAddon.INITIALIZE_COMPLETE)}};var x;if(y.rootController){if(y.rootController.indexOf(".")!==-1){p=d.create(a.GetNamespace(y.rootController))}else{p=d.cl()._core().instantiator().createClassInstance(y.rootController,"Controller")}if(!p||!(p instanceof a.cl.CLController)){d.redirect(500,'Invalid rootController specified, "'+y.rootController+'" controller does not exist in application package "'+d.config().applicationPackage+'.controllers".');return}x=p.namespace()}else{a.Package("a5.cl.mvc.core").Extends("a5.cl.CLController").Class("RootController",function(E){E.RootController=function(){E.superclass(this)};E.Override.index=function(){E.redirect(500,"No mapping created for default '/' mapping.")}});p=d.create("a5.cl.mvc.core.RootController");x="a5.cl.mvc.core.RootController"}d.addMapping({desc:"/",controller:x},true);if(y.rootViewDef){p.defaultViewDefinition(y.rootViewDef);B=!(/<.+>/.test(y.rootViewDef));p.generateView(function(E){s=E;C()})}else{w()}return B}})})(a5);