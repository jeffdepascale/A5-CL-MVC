//A5, Copyright (c) 2011, Jeff dePascale & Brian Sutliffe. http://www.jeffdepascale.com(function(a,b){a.Package("a5.cl").Extends("a5.cl.CLBase").Prototype("CLMVCBase",function(c){c.CLMVCBase=function(){c.superclass(this)};c.mvcName=function(){return this._cl_mvcName||this.instanceUID()};c.redirect=function(f,e,d){this.MVC().redirect(f,e,d)};c._cl_setMVCName=function(d){this._cl_mvcName=d}});a.Package("a5.cl").Extends("a5.Event").Static(function(c){c.RENDER_CONTROLLER="clMVCEventRenderController";c.INITIAL_CONTROLLER_LOADED="clMVCEventControllerLoaded";c.PRIMARY_CONTROLLER_WILL_CHANGE="clMVCEventPrimaryControllerWillChange";c.PRIMARY_CONTROLLER_CHANGED="clMVCEventPrimaryControllerChanged";c.ADDED_TO_PARENT="clMVCEventAddedToParent";c.REMOVED_FROM_PARENT="clMVCEventRemovedFromParent"}).Class("CLMVCEvent",function(d,c){d.CLMVCEvent=function(){d.superclass(this)}});a.Package("a5.cl.mvc").Extends("a5.Attribute").Class("InferRenderAttribute",function(c){c.InferRenderAttribute=function(){c.superclass(this)};c.Override.methodPre=function(j,g,k,d,h,f){var e=d.getName(),l=e.substr(0,1).toUpperCase()+e.substr(1)+"Controller";var m=j[0].im[l].instance(true);m.index.apply(m,g);k.render(m);return a.Attribute.SUCCESS}});a.Package("a5.cl.mvc").Extends("a5.Event").Static(function(c){c.VIEW_READY="clViewReady"}).Prototype("CLViewEvent",function(c){c.CLViewEvent=function(){c.superclass(this)}});a.Package("a5.cl.mvc").Extends("a5.Event").Static(function(c){c.CHILDREN_READY="childrenReady";c.LOADER_STATE_CHANGE="loaderStateChange";c.WILL_REMOVE_VIEW="willRemoveView";c.WILL_ADD_VIEW="willAddView";c.VIEW_ADDED="viewAdded";c.VIEW_REMOVED="viewRemoved"}).Prototype("CLViewContainerEvent",function(c){c.CLViewContainerEvent=function(){c.superclass(this)}});a.Package("a5.cl.mvc.core").Import("a5.cl.CLEvent").Extends("a5.cl.CLMVCBase").Class("RedrawEngine","singleton final",function(p,m){var o,e=[],l=false,j,c,k;this.RedrawEngine=function(){p.superclass(this);o=p.cl().MVC().application().view();k=a.cl.initializers.dom.Utils.getVendorWindowMethod("requestAnimationFrame");p.cl().addEventListener(m.CLEvent.PLUGINS_LOADED,d)};var d=function(){p.cl().removeEventListener(m.CLEvent.PLUGINS_LOADED,d);if(p.cl().plugins().PerformanceTester){j=p.cl().plugins().PerformanceTester().createTimer("redraw")}};this.loaderWentIdle=function(q){n(q)};this.attemptRedraw=function(q,r){var s=q||p;n(s,r)};this.triggerAppRedraw=function(q){l=q||l;f()};var n=function(u,t){var r=true,s,q;for(s=0,q=e.length;s<q;s++){if(u==e[s]||u.isChildOf(e[s])){r=false;break}}if(r){for(s=0;s<e.length;s++){if(e[s].isChildOf(u)){e.splice(s,1);s--}}u.addOneTimeEventListener(a.Event.DESTROYED,g);e.push(u);f()}};var g=function(r){var q=r.target();for(i=0;i<e.length;i++){if(e[i]==q){e.splice(i,1);return}}};var f=function(){if(!c&&(e.length||l)){c=true;if(k){k(h)}else{p.cl().addEventListener(m.CLEvent.GLOBAL_UPDATE_TIMER_TICK,h)}}};var h=function(){if(!k){p.cl().removeEventListener(m.CLEvent.GLOBAL_UPDATE_TIMER_TICK,h)}var q=l;l=false;if(q){o._cl_redraw(q);e=[]}else{while(e.length){e.shift()._cl_redraw(false)}}c=false}});a.SetNamespace("a5.cl.mvc.core.AppSetup",{genericSetup:function(){a.cl.Instance().MVC().setTitle()},desktopSetup:function(){if(a.cl.Instance().MVC().pluginConfig().faviconPath){var c=document.getElementsByTagName("head")[0],d=document.createElement("link");d.rel="shortcut icon";d.href=a.cl.Instance().MVC().pluginConfig().faviconPath;d.type="image/x-icon";c.appendChild(d);d=null}if(a.cl.Instance().DOM().pluginConfig().forceIE7){var c=document.getElementsByTagName("head")[0],d=document.createElement("meta");d.httpEquiv="X-UA-Compatible";d.content="IE=7";c.appendChild(d);d=null}this.genericSetup()},mobileSetup:function(){var c=document.getElementsByTagName("head")[0],d=document.createElement("meta");d.name="viewport";d.content="width=device-width, minimum-scale=1, maximum-scale=1";c.appendChild(d);this.genericSetup();d=null},tabletSetup:function(){this.mobileSetup()}});a.Package("a5.cl.mvc.core").Import("a5.cl.CLEvent").Extends("a5.cl.CLMVCBase").Class("LocationManager","singleton final",function(d,c){var g;var e;var f;this.LocationManager=function(){d.superclass(this);g=a.cl.mvc.core.Mappings.instance();e=a.cl.mvc.core.Filters.instance();f=d.plugins().HashManager()};this._renderError=function(h,k){d.cl().dispatchEvent(c.CLEvent.APPLICATION_ERROR,{errorType:h,info:k});var l;switch(h){case 404:l='Resource not found: "'+(k.toString().length?k.toString():"/")+'"';break;case 500:if(!k._a5_initialized){k=new a.Error(k)}l=k.toString();break;default:l="Error loading resource.";break}var j=g.getErrorSignature(h);if(j){j.id=[l,k];d.redirect(j)}else{d.MVC().application()._cl_renderError(h,l,k)}};this.Override.redirect=function(m,l,k,n){var h=true;var j=typeof m;if(j=="string"&&m.indexOf("://")!=-1){m={url:m};j="object"}if(m instanceof Array){f.setHash(m,n,k)}if(m.hash!=b){f.setHash(m.hash,n,k)}else{if(j=="string"){f.setHash(m,n,k)}else{if(j=="number"){d._renderError(m,l)}else{if(m.url){window.location=m.url}else{h=false}}}}if(!h){if(m.forceHash!=b){m.hash=m.forceHash;f.setHash(m.forceHash,true)}if(m.controller!=b){this.processMapping(m)}}};this.processMapping=function(o){var k=g.geLastCallSignature();if(Object.prototype.toString.call(o)==="[object Array]"){var n=g.getCallSignature(o);if(n){e.test(n,k,function(l){if(l){d.dispatchEvent("CONTROLLER_CHANGE",n)}})}else{var m="";for(var j=0,h=o.length;j<h;j++){m+=o[j]+(j<(h-1)?"/":"")}d._renderError(404,m)}}else{e.test(o,k,function(l){if(l){d.dispatchEvent("CONTROLLER_CHANGE",{controller:o.controller,action:o.action,id:o.id})}})}}});a.Package("a5.cl.mvc.core").Extends("a5.cl.CLViewContainer").Class("WindowContainer",function(d,c){d.WindowContainer=function(){d.superclass(this)}});a.Package("a5.cl.mvc.core").Extends("a5.cl.CLViewContainer").Prototype("AppViewContainer","singleton final",function(d,c){d.AppViewContainer=function(){d.superclass(this);this._cl_errorStopped=false;this._cl_systemWindowContainer=new c.WindowContainer();this._cl_appWindowContainer=new c.WindowContainer();this._cl_appWindowLoadingContainer=new c.WindowContainer();this.showOverflow(true);this._cl_addedToTree()};d.initialize=function(){d.superclass().viewReady.apply(this,arguments);this._cl_systemWindowContainer.hide();this._cl_appWindowContainer.hide();this._cl_appWindowContainer.showOverflow(true);this.showOverflow(true)};d.Override.addSubView=d.Override.removeSubView=d.Override.subViewToTop=d.Override.subViewToBottom=d.Override.removeAllSubViews=d.Override.removeViewAtIndex=d.Override.replaceView=d.Override.replaceViewAtIndex=d.Override.swapViewsAtIndex=d.Override.addSubViewAtIndex=d.Override.addSubViewBelow=d.Override.addSubViewAbove=function(){this.throwError("View manipulations on AppViewContainer must use addWindow and removeWindow methods only.")};d.containsWindow=function(e){var f=this._cl_appWindowContainer.containsSubView(e);if(f){return true}return this._cl_systemWindowContainer.containsSubView(e)};d.addWindow=function(o){if(!this._cl_errorStopped){if(o instanceof a.cl.CLWindow){var g=a.cl.CLWindowLevel,h=o._cl_windowLevel;if(h===g.SYSTEM){var m=this._cl_systemWindowContainer.subViewCount();if(m>0){if(this._cl_systemWindowContainer.subViewAtIndex(0).blocking()){return this.throwError("system window blocking error")}else{this._cl_systemWindowContainer.replaceViewAtIndex(o,0)}}else{this._cl_systemWindowContainer.addSubView(o)}this._cl_systemWindowContainer.show()}else{var e=this._cl_appWindowContainer,n=0,p=false,s=null,r=null,f=null;if(e.containsSubView(o)){e.removeSubView(o,false)}for(var k=0,j=e.subViewCount();k<j;k++){var q=e.subViewAtIndex(k);if(q._cl_windowLevel===h&&q._cl_windowLevel!==g.APPLICATION){n=k;p=true;break}else{if(q._cl_windowLevel!==g.SYSTEM){switch(q._cl_windowLevel){case g.APPLICATION:n=k+1;break;case g.MODAL:s=k;break;case g.CONTEXT:r=k;break;case g.ALERT:f=k;break}}}}switch(h){case g.MODAL:if(s){n=s;replace=true}break;case g.CONTEXT:if(r){n=r;replace=true}else{if(s){n=s+1}}break;case g.ALERT:if(f){n=f;replace=true}else{if(r){n=r+1}else{if(s){n=s+1}}}break}if((h===g.APPLICATION||e.subViewCount()===0)||!p){this._cl_appWindowContainer.addSubViewAtIndex(o,n)}else{this._cl_appWindowContainer.replaceViewAtIndex(o,n)}}}else{self.redirect(500,"Application addSubView only accepts views that subclass a5.cl.CLWindow")}}};d.removeWindow=function(f,e){if(f){if(this._cl_appWindowContainer.containsSubView(f)){this._cl_appWindowContainer.removeSubView(f,e)}else{if(this._cl_systemWindowContainer.containsSubView(f)){this._cl_systemWindowContainer.removeSubView(f,e);this._cl_systemWindowContainer.hide()}else{this.throwError('Cannot remove window "'+f.instanceUID()+'", window is not currently a child of AppViewContainer.')}}}};d._cl_initialRenderCompete=function(){this._cl_appWindowContainer.show();this.superclass().removeSubView.call(this,this._cl_appWindowLoadingContainer)};d.Override.viewReady=function(){};d.Override.width=function(e){return this.cl().MVC().envManager().windowProps().width};d.Override.height=function(e){return this.cl().MVC().envManager().windowProps().height};d.Override._cl_redraw=function(j){var k=this._cl_systemWindowContainer.subViewAtIndex(0),l=null;if(k&&k.offsetsApplication()!==a.cl.mvc.core.SystemWindow.OFFSET_NONE){didRedrawSysWin=true;this._cl_systemWindowContainer.height(k.height("value")==="100%"?"100%":"auto");this._cl_systemWindowContainer._cl_redraw(j);l=k.height()}else{this._cl_systemWindowContainer._cl_redraw(j)}if(l!==null){var e=this.height()-this._cl_systemWindowContainer.height();if(k.offsetsApplication()===a.cl.mvc.core.SystemWindow.OFFSET_TOP){this._cl_appWindowContainer.y(l).height(e);this._cl_systemWindowContainer.y(0)}else{this._cl_appWindowContainer.y(0).height(e);var g=this.height()-l;this._cl_systemWindowContainer.y(this.height()-l);this._cl_systemWindowContainer._cl_redraw(j)}}this._cl_appWindowContainer._cl_redraw(j)};d.Override.redraw=function(){this.cl().MVC().redrawEngine().attemptRedraw(this)};d.Override.draw=function(){var e=document.getElementsByTagName("body")[0];e.style.margin=e.style.padding=0;e.style.overflow="hidden";d.superclass().draw.call(this);this._cl_viewElement.style.width=this._cl_viewElement.style.height="100%";this._cl_width.percent=this._cl_height.percent=1;this._cl_width.value=this._cl_height.value="100%";e.appendChild(this._cl_viewElement);this._cl_viewElement.style.display="block";d.superclass().addSubView.call(this,this._cl_appWindowContainer);d.superclass().addSubView.call(this,this._cl_appWindowLoadingContainer);d.superclass().addSubView.call(this,this._cl_systemWindowContainer)}});a.Package("a5.cl.mvc.core").Extends("a5.cl.CLWindow").Static(function(c){c.OFFSET_TOP="systemWindowOffsetTop";c.OFFSET_BOTTOM="systemWindowOffsetBottom";c.OFFSET_NONE="systemWindowOffsetNone"}).Prototype("SystemWindow",function(d,c,e){this.Properties(function(){this._cl_blocking=false;this._cl_offsetsApplication=e.OFFSET_NONE});d.SystemWindow=function(){d.superclass(this);this._cl_windowLevel=a.cl.CLWindowLevel.SYSTEM};d.showWindow=function(){this.cl().application().view().addWindow(this)};d.blocking=function(f){if(f!==b){this._cl_blocking=f;return this}return this._cl_blocking};d.offsetsApplication=function(f){if(f!==b){this._cl_offsetsApplication=f;return}return this._cl_offsetsApplication}});a.Package("a5.cl").Import("a5.cl.CLMVCEvent","a5.cl.mvc.CLViewEvent").Extends("CLMVCBase").Static(function(d,c){d.customViewDefNodes=["EventListener","Bind"];d._cl_calcOffsetObj=function(k,n,o){var m,g,h,e,j=false,f=k[n];k[n]={width:0,height:0,left:0,right:0,top:0,bottom:0};for(m=0,g=o.length;m<g;m++){e=k[o[m]];h=typeof e==="object";k[n].left+=(h?(e.left!==b?e.left:0):e);k[n].right+=(h?(e.right!==b?e.right:0):e);k[n].top+=(h?(e.top!==b?e.top:0):e);k[n].bottom+=(h?(e.bottom!==b?e.bottom:0):e)}k[n].width=k[n].left+k[n].right;k[n].height=k[n].top+k[n].bottom;return(k[n].left!==f.left||k[n].right!==f.right||k[n].top!==f.top||k[n].bottom!==f.bottom)};d._cl_setWH=function(f,j,h){if(h.percent!==false){var e=f._cl_parentView[j==="width"?"scrollXEnabled":"scrollYEnabled"]("state"),g=e?(f._cl_parentView[j]("scroll")-f._cl_parentView._cl_calculatedClientOffset[j]-f._cl_parentView._cl_calculatedOffset[j]):f._cl_parentView[j]("inner");return g*h.percent}else{if(h.relative!==false){return f._cl_parentView[j]("inner")+h.relative}else{if(h.auto!==false){return f[j]("content")+f._cl_calculatedClientOffset[j]+f._cl_calculatedOffset[j]}else{if(h.relative===false&&h.percent===false&&h.auto===false){return h.value}else{return null}}}}};d._cl_updateWH=function(m,j,f,e,l,o,n){var k=m._cl_calculatedOffset[f]+m._cl_calculatedClientOffset[f],g=j-k,h;if(m._cl_parentView.constrainChildren()&&m._cl_parentView["_cl_"+f].auto===false){h=(g||m[f]("inner"))+e;if(h>m._cl_parentView[f]("inner")){g=m._cl_parentView[f]("inner")-e-k}}if(l!==null&&(g+m._cl_calculatedClientOffset[f])<l){g=l-m._cl_calculatedClientOffset[f]}if(o!==null&&(g+m._cl_calculatedClientOffset[f])>o){g=o-m._cl_calculatedClientOffset[f]}g=(g>=0?g:0);n.client=n.inner=n.content=g;n.offset=g+k;return g};d._cl_updateXY=function(j,f,l,g,k){var h=0,e=j._cl_parentView?j._cl_parentView._cl_calculatedClientOffset[k==="width"?"left":"top"]:0;switch(l){case"left":case"top":h=f+e;break;case"center":case"middle":h=g/2-j[k]()/2+f+e;if(h<e){h=e}break;case"right":case"bottom":h=g-j[k]()+f+e;break}return h};d._cl_initialRedraw=function(e){if(e._cl_initialized&&!e._cl_initialRenderComplete){e._cl_initialRenderComplete=true;if(e._cl_visible){e._cl_viewElement.style.display=e._cl_defaultDisplayStyle}}};d._cl_viewCanRedraw=function(e){var f=true;if(!e._cl_viewElement){f=false}if(!e._cl_parentView){f=false}if(!e.visible()&&e._cl_initialRenderComplete){f=false}if(e.suspendRedraws()){f=false}if(!f){e._cl_redrawPending=false}return f};d._cl_useTransforms=false;d._cl_forceGPU=false}).Prototype("CLView",function(e,c,d){this.Properties(function(){this._cl_viewElement=null;this._cl_viewElementType="div";this._cl_viewIsReady=false;this._cl_parentView=null;this._cl_showOverflow=false;this._cl_alignX="left";this._cl_alignY="top";this._cl_x={value:0,state:false,percent:false};this._cl_y={value:0,state:false,percent:false};this._cl_alpha=1;this._cl_visible=true;this._cl_width={client:0,offset:0,inner:0,value:"100%",percent:1,relative:false,auto:false,isDefault:true,content:0};this._cl_height={client:0,offset:0,inner:0,value:"100%",percent:1,relative:false,auto:false,isDefault:true,content:0};this._cl_minWidth=null;this._cl_minHeight=null;this._cl_maxWidth=null;this._cl_maxHeight=null;this._cl_borderWidth={top:0,left:0,right:0,bottom:0};this._cl_padding={top:0,left:0,right:0,bottom:0};this._cl_calculatedOffset={width:0,height:0,left:0,right:0,top:0,bottom:0};this._cl_calculatedClientOffset={width:0,height:0,left:0,right:0,top:0,bottom:0};this._cl_redrawPending=false;this._cl_initialized=false;this._cl_initialRenderComplete=false;this._cl_id=null;this._cl_viewDefDefaults={};this._cl_fromViewDef=false;this._cl_vdViewIsReady=false;this._cl_suspendRedraws=false;this._cl_suspendRedrawsDirect=false;this._cl_buildingFromViewDef=false;this._cl_pendingViewElementProps={};this._cl_currentViewElementProps={};this._cl_controller=null;this._cl_isInTree=false;this._cl_defaultDisplayStyle="block";this.skipViewDefReset=[]});e.CLView=function(){e.superclass(this);if(d._cl_transformProp===b){d._cl_transformProp=a.cl.initializers.dom.Utils.getCSSProp("transform")}this._cl_viewElement=document.createElement(this._cl_viewElementType);this._cl_initializeElement()};e.draw=function(f){if(!this._cl_initialized&&!this._cl_initialRenderComplete){this._cl_initialized=true;if(f){this._cl_setParent(f)}this.redraw();this.viewReady()}};e.id=function(f){var g=this._cl_propGetSet("_cl_id",f,"string");return g||this.instanceUID()};e.addCSSClass=function(f){if(this._cl_viewElement.className.indexOf(f)!==0&&this._cl_viewElement.className.indexOf(" "+f)===-1){this._cl_viewElement.className+=" "+f}};e.pullExistingElem=function(g){var f=typeof id=="string"?document.getElementById(g):g;if(f){if(this._cl_parentView){this._cl_parentView._cl_viewElement.replaceChild(f,this._cl_viewElement)}this._cl_viewElement=f;this._cl_initializeElement()}};e._cl_initializeElement=function(){var f="a5View ",j=this.constructor.getAncestors(),k=false;for(var h=0,g=j.length;h<g;h++){if(j[h].namespace()==="a5.cl.CLView"){k=true}if(k){if(j[h].fullPackageCSSName===true){f+=j[h].namespace().replace(/\./g,"_")}else{f+=j[h].className()}f+=" "}}f+=this.constructor.fullPackageCSSName?this.namespace().replace(/\./g,"_"):this.className();this._cl_viewElement.className=f;this._cl_viewElement.style.overflowX=this._cl_viewElement.style.overflowY=this._cl_showOverflow?"visible":"hidden";this._cl_viewElement.id=this.instanceUID();this._cl_viewElement.style.display="none";this._cl_viewElement.style.backgroundColor="transparent";this._cl_viewElement.style.position="absolute";this._cl_viewElement.style.zoom=1;this._cl_viewElement.a5Ref=this};e.isChildOf=function(g){var f=this._cl_parentView;while(f){if(f===g){return true}f=f._cl_parentView}return false};e.controller=function(g){if(g){return this._cl_controller}var f=this;do{if(f._cl_controller){return f._cl_controller}f=f.parentView()}while(f);return null};e.suspendRedraws=function(g,f){if(typeof g==="boolean"){if(f!==true){this._cl_suspendRedrawsDirect=g}this._cl_suspendRedraws=g?g:this._cl_suspendRedrawsDirect;if(!g){this.redraw()}return this}return this._cl_suspendRedraws};e.index=function(){return parseInt(this._cl_viewElement.style.zIndex)};e.renderFromData=function(f){};e.minWidth=function(f){return this._cl_propGetSet("_cl_minWidth",f,"number")};e.minHeight=function(f){return this._cl_propGetSet("_cl_minHeight",f,"number")};e.maxWidth=function(f){return this._cl_propGetSet("_cl_maxWidth",f,"number")};e.maxHeight=function(f){return this._cl_propGetSet("_cl_maxHeight",f,"number")};e.alignX=function(g){if(g!==b){if(g==="left"||g==="center"||g==="right"){var f=(g!==this._cl_alignX);this._cl_alignX=g;if(f){this.redraw}}return this}return this._cl_alignX};e.alignY=function(g){if(g!==b){if(g==="top"||g==="middle"||g==="bottom"){var f=(g!==this._cl_alignY);this._cl_alignY=g;if(f){this.redraw}}return this}return this._cl_alignY};e.y=function(j,l,m){if(j!==b){if(j===true){return this._cl_y.state!==false&&this.parentView()&&this.parentView().relY()?this._cl_y.state:this._cl_y.value}if(typeof l==="number"&&typeof j==="number"){return this.animate(l,{y:j,ease:m})}if(typeof j==="object"){var k=this.y(true),h=this.parentView();while(h){if(!h){return null}if(h===j){return k}k+=h.y(true)+h.scrollY()+h._cl_calculatedOffset.top+h._cl_calculatedClientOffset.top;h=h.parentView()}}else{var g=typeof j==="string"&&j.indexOf("%")!=-1;this._cl_y.percent=g?(parseFloat(j.substr(0,j.length-1))/100):false;if(this._cl_y.percent>1){this._cl_y.percent=1}if(this._cl_y.percent<0){this._cl_y.percent=0}var f=j!==this._cl_y.value;this._cl_y.value=j;if(f){this.redraw()}return this}}return this._cl_y.value};e.x=function(j,l,m){if(j!==b){if(j===true){return this._cl_x.state!==false&&this.parentView()&&this.parentView().relX()?this._cl_x.state:this._cl_x.value}if(typeof l==="number"&&typeof j==="number"){return this.animate(l,{x:j,ease:m})}if(typeof j==="object"){var k=this.x(true),h=this.parentView();while(h){if(!h){return null}if(h===j){return k}k+=h.x(true)+h.scrollX()+h._cl_calculatedOffset.left+h._cl_calculatedClientOffset.left;h=h.parentView()}}else{var g=typeof j==="string"&&j.indexOf("%")!=-1;this._cl_x.percent=g?(parseFloat(j.substr(0,j.length-1))/100):false;if(this._cl_x.percent>1){this._cl_x.percent=1}if(this._cl_x.percent<0){this._cl_x.percent=0}var f=j!==this._cl_x.value;this._cl_x.value=j;if(this._cl_x.state!==false&&this.parentView()&&this.parentView().relX()){this._cl_x.state=j}if(f){this.redraw()}return this}}return this._cl_x.value};e.rotation=function(f){this._cl_css("transform","rotate("+f+"deg)",true)};e.showOverflow=function(f){if(f){this._cl_viewElement.style.overflowX=this._cl_viewElement.style.overflowY=f===true?"visible":"hidden";this._cl_showOverflow=f;return this}return this._cl_showOverflow};e.background=function(f){this._cl_viewElement.style.background=f;return this._cl_viewElement.style.background};e.backgroundColor=function(h,f,g){if(h){this._cl_viewElement.style.backgroundColor=h;if(this.DOM().clientPlatform()==="IE"||this.DOM().clientPlatform()==="WP7"){this._cl_viewElement.style.filter=this._cl_viewElement.style.filter.replace(/progid:DXImageTransform\.Microsoft\.gradient\(.*?\)/gi,"")}if(a.cl.core.Utils.validateHexColor(h)&&a.cl.core.Utils.validateHexColor(f)){if(this.DOM().clientPlatform()==="IE"||this.DOM().clientPlatform()==="WP7"){this._cl_viewElement.style.filter+=" progid:DXImageTransform.Microsoft.gradient(startColorstr='"+a.cl.core.Utils.expandHexColor(h)+"', endColorstr='"+a.cl.core.Utils.expandHexColor(f)+"')"}else{this._cl_viewElement.style.background="";this._cl_viewElement.style.background="-moz-linear-gradient("+(g===true?"left":"top")+",  "+h+",  "+f+")";if(this._cl_viewElement.style.background.indexOf("gradient")===-1){this._cl_viewElement.style.background="-webkit-gradient(linear, left top, "+(g===true?"right top":"left bottom")+", from("+h+"), to("+f+"))"}}}else{this._cl_viewElement.style.background="";this._cl_viewElement.style.backgroundColor=h}return this}return this._cl_viewElement.style.backgroundColor};e.alpha=function(f,g,h){if(typeof f==="number"){if(typeof g==="number"){return this.animate(g,{alpha:f,ease:h})}if(this.DOM().clientPlatform()=="IE"&&this.DOM().browserVersion()<9){this._cl_viewElement.style.filter=this._cl_viewElement.style.filter.replace(/alpha\(.*?\)/gi,"")+" alpha(opacity="+(f*100)+")"}else{this._cl_viewElement.style.opacity=f+""}this._cl_alpha=f;return this}return this._cl_alpha};e.animate=function(g,f){var h=this.plugins().getRegisteredProcess("animation");if(h){h.animate(this,g,f)}else{this.warn("No animation plugin was found.");for(var j in f){if(typeof e[j]==="function"){e[j].call(this,f[j])}}}return this};e.easing=function(){var f=this.plugins().getRegisteredProcess("animation");if(f){return f.easing.call(this)}else{return{}}};e.border=function(j,h,g,f){if(j!==b||h!==b||g!==b||f!==b){this.borderWidth(j||0);this.borderStyle(h||"solid");this.borderColor(g||"#000");this.borderRadius(f||0);return this}return this._cl_viewElement.style.border};e.borderWidth=function(f,g,h){if(f!==b){if(typeof f==="number"){if(typeof g==="number"){return this.animate(g,{borderWidth:f,ease:h})}this._cl_viewElement.style.borderWidth=f+"px"}else{for(var j in f){this._cl_viewElement.style["border"+(a.cl.core.Utils.initialCap(j))+"Width"]=(f[j]||0)+"px"}}this._cl_borderWidth=f;this._cl_calculateOffset();return this}return this._cl_viewElement.style.borderWidth};e.borderStyle=function(f){if(f!==b){if(typeof f==="string"){this._cl_viewElement.style.borderStyle=f}else{for(var g in f){this._cl_viewElement.style["border"+(a.cl.core.Utils.initialCap(g))+"Style"]=f[g]||"solid"}}return this}return this._cl_viewElement.style.borderStyle};e.borderColor=function(f){if(f!==b){if(typeof f==="string"){this._cl_viewElement.style.borderColor=f}else{for(var g in f){this._cl_viewElement.style["border"+(a.cl.core.Utils.initialCap(g))+"Color"]=f[g]||"#000"}}return this}return this._cl_viewElement.style.borderColor};e.borderRadius=function(f,g,h){if(f!==b){if(typeof f==="number"){if(typeof g==="number"){return this.animate(g,{borderRadius:f,ease:h})}this._cl_viewElement.style[a.cl.initializers.dom.Utils.getCSSProp("borderRadius")]=f+"px"}else{for(var j in f){this._cl_viewElement.style["border"+(a.cl.core.Utils.initialCap(j))+"Radius"]=(f[j]||0)+"px"}}return this}return this._cl_viewElement.style.borderRadius};e.padding=function(f,g,h){if(f!==b){if(typeof g==="number"){return this.animate(g,{padding:f,ease:h})}this._cl_padding=f;this._cl_calculateOffset();return this}return this._cl_padding};e.tooltip=function(f){if(typeof f==="string"){this._cl_viewElement.title=f;return this}return this._cl_viewElement.title};e.viewReady=function(){if(!this.plugins().getRegisteredProcess("instanceUIDWriter")&&this.id()!==this.instanceUID()){var f=this.controller();if(f){var g=a.HashString(this.controller().namespace()+this.id());if(!document.getElementById(g)){this._a5_instanceUID=g;this._cl_viewElement.id=g}}}if(this.id()!==this.instanceUID()){this._cl_viewElement.setAttribute("data-a5ID",this.id())}this._cl_viewIsReady=true;this.dispatchEvent(new c.CLViewEvent(c.CLViewEvent.VIEW_READY))};e.redrawComplete=function(){};e.viewIsReady=function(){return this._cl_viewIsReady};e.moveToParentView=function(f){this.removeFromParentView();this._cl_clParentView=null;f.addSubView(this)};e.removeFromParentView=function(f){if(this._cl_parentView){this._cl_parentView.removeSubView(this,f)}};e.addedToParent=function(f){};e.removedFromParent=function(f){};e.hide=function(){this._cl_viewElement.style.display="none";this._cl_visible=false;if(this.parentView()){this.parentView()._cl_redraw()}};e.show=function(){this._cl_viewElement.style.display=this._cl_defaultDisplayStyle;this._cl_visible=true;if(this.parentView()){this.parentView()._cl_redraw()}};e.visible=function(f){if(typeof f==="boolean"){if(f){this.show()}else{this.hide()}return this}return this._cl_visible};e.parentView=function(){return this._cl_parentView};e.toTop=function(){this.parentView().subViewToTop(this)};e.toBottom=function(){this.parentView().subViewToBottom(this)};e.width=function(h,j,k){if(h===b||h===null){h="offset"}if(h==="offset"||h==="client"||h==="content"||h==="inner"||h==="value"){return this._cl_width[h]}if(typeof j==="number"&&typeof h==="number"){return this.animate(j,{height:h,ease:k})}this._cl_width.auto=this._cl_width.percent=this._cl_width.relative=this._cl_width.isDefault=false;if(typeof h==="string"){if(h==="auto"){this._cl_width.auto=true}else{var g=h.indexOf("%")!=-1;this._cl_width.percent=g?(parseFloat(h.substr(0,h.length-1))/100):false;if(this._cl_width.percent>1){this._cl_width.percent=1}if(this._cl_width.percent<0){this._cl_width.percent=0}this._cl_width.relative=!g?parseFloat(h):false;this._cl_width.auto=false}}var f=h!==this._cl_width.value;this._cl_width.value=h;if(f){this.redraw()}return this};e.height=function(h,j,k){if(h===b||h===null){h="offset"}if(h==="offset"||h==="client"||h==="content"||h==="inner"||h==="value"){return this._cl_height[h]}if(typeof j==="number"&&typeof h==="number"){return this.animate(j,{height:h,ease:k})}this._cl_height.auto=this._cl_height.percent=this._cl_height.relative=this._cl_height.isDefault=false;if(typeof h==="string"){if(h==="auto"){this._cl_height.auto=true}else{var g=h.indexOf("%")!=-1;this._cl_height.percent=g?(parseFloat(h.substr(0,h.length-1))/100):false;if(this._cl_height.percent>1){this._cl_height.percent=1}if(this._cl_height.percent<0){this._cl_height.percent=0}this._cl_height.relative=!g?parseFloat(h):false}}var f=h!==this._cl_height.value;this._cl_height.value=h;if(f){this.redraw()}return this};e.redraw=function(f){if(!this._cl_redrawPending&&this.parentView()){this._cl_redrawPending=true;this.cl().MVC().redrawEngine().attemptRedraw(this,f)}};e.isFullyVisible=function(){var f=this;while(f){if(!f.visible()){return false}else{f=f.parentView()}}return true};e.processCustomViewDefNode=function(k,g,f,j,h){switch(k){case"EventListener":this._cl_addEventListenerFromViewDef(g,f);break;case"Bind":this._cl_bindToEventFromViewDef(g,f,h);break}};e._cl_addEventListenerFromViewDef=function(j,f){var g=j.type,k=(this._cl_controller instanceof a.cl.CLController&&j.view!==true)?this._cl_controller:this,l=(typeof j.target==="string")?this.getChildView(j.target):this,m=k[j.method],h;if(typeof j.event==="string"){h=a.GetNamespace(j.event,f);if(typeof h!=="function"){a.ThrowError('Error adding event listener: Could not find the event class "'+j.event+'".');return}else{if(typeof j.type!=="string"){a.ThrowError('Error adding event listener: No type specified for the event class "'+j.event+'".');return}}g=h[j.type];if(typeof g!=="string"){a.ThrowError('Error adding event listener: Could not find the type "'+j.type+'" on class "'+j.event+'".');return}}if(!(l instanceof d)){a.ThrowError('Error adding event listener: Could not find the target with id "'+j.target+'".  Make sure that the EventListener node comes after the node for the target view.');return}if(typeof m!=="function"){a.ThrowError('Error adding event listener: Could not find the method "'+j.method+'". Note that the method must be publicly accessible.');return}l.addEventListener(g,m,j.useCapture===true,this)};e._cl_bindToEventFromViewDef=function(j,f,m){var g=j.type,l,k,n;if(typeof j.event==="string"){var h=a.GetNamespace(j.event,f);if(typeof h!=="function"){a.ThrowError('Error binding to event: Could not find the event class "'+j.event+'".');return}else{if(typeof j.type!=="string"){a.ThrowError('Error binding to event: No type specified for the event class "'+j.event+'".');return}}g=h[j.type];if(typeof g!=="string"){a.ThrowError('Error binding to event: Could not find the type "'+j.type+'" on class "'+j.event+'".');return}}if(typeof j.listener==="string"){l=m.getChildView(j.listener);if(!l){a.ThrowError('Error binding to event: Could not find a listener with the ID "'+j.listener+'".');return}if(l instanceof a.cl.CLController&&j.view===true){l=l.view()}if(!l){a.ThrowError('Error binding to event: The controller with ID "'+j.listener+'" does not have a view.');return}}else{if(typeof j.singleton==="string"){k=a.GetNamespace(j.singleton,f);if(typeof singleon!=="function"){a.ThrowError('Error binding to event: Unable to locate the class "'+j.singleton+'". Make sure to import this class, or reference it with a fully-qualified package.');return}else{if(!k.isSingleton()){a.ThrowError('Error binding to event: Listener class "'+j.singleton+'" is not a singleton. You should specify the listener by ID with the "listener" attribute.');return}}l=singleon.instance()}else{a.ThrowError('Error binding to event: No listener was specified.  Either specify a "listener" by ID, or a "singleton" by class.');return}}n=l[j.method];if(typeof n!=="function"){a.ThrowError('Error binding to event: Could not find the method "'+j.method+'" on listener "'+(j.listener||j.singleton)+'". Note that the method must be publicly accessible.');return}this.addEventListener(g,n,j.useCapture===true,l)};e.viewRedrawn=function(){};e.addedToTree=function(){};e.removedFromTree=function(){};e.isInTree=function(){return this._cl_isInTree};e._cl_addedToTree=function(){this._cl_isInTree=true;this.addedToTree();if(this._cl_controller){this._cl_controller._cl_viewAddedToTree()}};e._cl_removedFromTree=function(){this._cl_isInTree=false;this.removedFromTree();if(this._cl_controller){this._cl_controller._cl_viewRemovedFromTree()}};e._cl_addedToParent=function(f){this.addedToParent(f);if(f.isInTree()){this._cl_addedToTree()}e.suspendRedraws.call(this,f.suspendRedraws());if(this._cl_vdViewIsReady&&f._cl_buildingFromViewDef){f._cl_vdViewAdded()}this.dispatchEvent(c.CLMVCEvent.ADDED_TO_PARENT)};e._cl_removedFromParent=function(f){this.removedFromParent(f);this._cl_removedFromTree();if(this._cl_viewElement){this._cl_viewElement.style.display="none"}this._cl_initialRenderComplete=false;this.dispatchEvent(c.CLMVCEvent.REMOVED_FROM_PARENT)};e._cl_propGetSet=function(h,g,f){if((f&&typeof g===f)||(!f&&g!==b)){this[h]=g;return this}return this[h]};e._cl_css=function(h,g,f){f=f||false;if(f){h=a.cl.initializers.dom.Utils.getCSSProp(h)}if(h){this._cl_viewElement.style[h]=g}return this};e._cl_setParent=function(f){this._cl_parentView=f};e._cl_calculateOffset=function(){var g=d._cl_calcOffsetObj(this,"_cl_calculatedOffset",["_cl_borderWidth"]),f=d._cl_calcOffsetObj(this,"_cl_calculatedClientOffset",["_cl_padding"]);if(g||f){this.redraw()}};e._cl_redraw=function(m,l){if((!this._cl_initialRenderComplete||this._cl_redrawPending||m)&&a.cl.CLView._cl_viewCanRedraw(this)){var g=this._cl_x.percent!==false?(this._cl_parentView.width()*this._cl_x.percent):this.x(true),n=this._cl_y.percent!==false?(this._cl_parentView.height()*this._cl_y.percent):this.y(true),f=d._cl_setWH(this,"width",this._cl_width),k=d._cl_setWH(this,"height",this._cl_height),j=(f!==b||k!==b);this._cl_pendingViewElementProps.width=f!==null?(Math.max(0,d._cl_updateWH(this,f,"width",g,this._cl_minWidth,this._cl_maxWidth,this._cl_width))+"px"):b;this._cl_pendingViewElementProps.height=k!==null?(Math.max(0,d._cl_updateWH(this,k,"height",n,this._cl_minHeight,this._cl_maxHeight,this._cl_height))+"px"):b;this._cl_pendingViewElementProps.left=d._cl_updateXY(this,g,this._cl_alignX,this._cl_parentView.width("inner"),"width")+"px";this._cl_pendingViewElementProps.top=d._cl_updateXY(this,n,this._cl_alignY,this._cl_parentView.height("inner"),"height")+"px";this._cl_pendingViewElementProps.paddingTop=this._cl_calculatedClientOffset.top+"px";this._cl_pendingViewElementProps.paddingRight=this._cl_calculatedClientOffset.right+"px";this._cl_pendingViewElementProps.paddingBottom=this._cl_calculatedClientOffset.bottom+"px";this._cl_pendingViewElementProps.paddingLeft=this._cl_calculatedClientOffset.left+"px";if(this._cl_redrawPending){this._cl_alertParentOfRedraw()}this._cl_redrawPending=false;if(l!==true){this._cl_render()}d._cl_initialRedraw(this);return{force:j,shouldRedraw:true}}d._cl_initialRedraw(this);return{force:false,shouldRedraw:false}};e._cl_alertParentOfRedraw=function(){var f={width:this._cl_pendingViewElementProps.width!==this._cl_currentViewElementProps.width,height:this._cl_pendingViewElementProps.height!==this._cl_currentViewElementProps.height,x:this._cl_pendingViewElementProps.left!==this._cl_currentViewElementProps.left,y:this._cl_pendingViewElementProps.top!==this._cl_currentViewElementProps.top};if(this._cl_parentView){this._cl_parentView._cl_childRedrawn(this,f)}};e._cl_render=function(){if(d._cl_useTransforms&&d._cl_transformProp){var g="";if(this._cl_pendingViewElementProps.top!==b){g+="translateY("+this._cl_pendingViewElementProps.top+") ";this._cl_currentViewElementProps.top=this._cl_pendingViewElementProps.top}if(this._cl_pendingViewElementProps.left!==b){g+="translateX("+this._cl_pendingViewElementProps.left+") ";this._cl_currentViewElementProps.left=this._cl_pendingViewElementProps.left}if(g!==""){if(d._cl_forceGPU){g+="translateZ(0px)"}this._cl_viewElement.style[d._cl_transformProp]=g}}for(var h in this._cl_pendingViewElementProps){var f=this._cl_pendingViewElementProps[h];if(this._cl_currentViewElementProps[h]!==f){this._cl_currentViewElementProps[h]=this._cl_viewElement.style[h]=f}}this._cl_pendingViewElementProps={};this.viewRedrawn()};e._cl_setIndex=function(f){this._cl_viewElement.style.zIndex=f};e.Override.dispatchEvent=function(j,k,g){var l=this._a5_createEvent(j,k,g);var h=this._cl_getViewChain();l._a5_phase=a.EventPhase.CAPTURING;for(var f=0,m=h.length;f<m;f++){if(this._a5_initialized){this._a5_dispatchEvent.call(h[f],l)}}l._a5_phase=a.EventPhase.AT_TARGET;this._a5_dispatchEvent(l);if(l.bubbles()){l._a5_phase=a.EventPhase.BUBBLING;for(var f=h.length-1;f>=0;f--){if(this._a5_initialized){this._a5_dispatchEvent.call(h[f],l)}}}if(!l.shouldRetain()){l.destroy()}l=null;h=null};e._cl_getViewChain=function(){var f=[];var g=this;while(g._cl_parentView){g=g._cl_parentView;f.unshift(g)}return f};e._cl_vdViewReady=function(){this._cl_vdViewIsReady=true;if(this._cl_parentView&&!this._cl_controller){this._cl_parentView._cl_vdViewAdded()}else{if(this._cl_controller){this._cl_controller._cl_viewReady()}}};e._cl_destroyElement=function(f){this.MVC().garbageCollector().destroyElement(f)};e.dealloc=function(){if(this._cl_parentView){this.removeFromParentView(false)}this._cl_destroyElement(this._cl_viewElement);this._cl_viewElement=null}});a.Package("a5.cl.mvc.core").Import("a5.cl.CLEvent","a5.cl.initializers.dom.Utils").Extends("a5.cl.CLMVCBase").Class("EnvManager",function(e,d){var j,c={},k,h;e.EnvManager=function(){e.superclass(this);g();e.cl().addEventListener(d.CLEvent.ORIENTATION_CHANGED,f);e.cl().addEventListener(d.CLEvent.WINDOW_RESIZED,f);k=h=e.DOM().clientEnvironment();f();d.Utils.addEventListener(window,"focus",function(l){f()})};this.scrollBarWidth=function(){return j};this.windowProps=function(l){if(l){return f(true)}else{return c}};var f=function(l){var n=l===true?true:false;var m=null;if(document.documentElement&&document.documentElement.clientHeight){m=document.documentElement}else{if(document.body&&document.body.clientHeight){m=document.body}}if(m){c.height=m.clientHeight;c.width=m.clientWidth;c.scrollHeight=m.scrollHeight;c.scrollWidth=m.scrollWidth}else{if(typeof(window.innerHeight)=="number"){c.height=window.innerHeight;c.width=window.innerWidth;c.scrollHeight=window.innerHeight+window.scrollMaxY;c.scrollWidth=window.innerWidth+window.scrollMaxX}}if(c.scrollHeight===0){c.scrollHeight=c.height}if(c.scrollWidth===0){c.scrollWidth=c.width}if(e.DOM().pluginConfig().clientEnvironmentOverrides){if(k==="MOBILE"&&c.width>=e.MVC().pluginConfig().mobileWidthThreshold){k=h;e.cl().dispatchEvent(d.CLEvent.CLIENT_ENVIRONMENT_UPDATED,[k])}else{if(k!=="MOBILE"&&c.width<e.MVC().pluginConfig().mobileWidthThreshold){k="MOBILE";e.cl().dispatchEvent(d.CLEvent.CLIENT_ENVIRONMENT_UPDATED,[k])}}}if(n){return c}else{e.cl().MVC().redrawEngine().triggerAppRedraw(true)}};var g=function(){var n=null,l=null,o=0,m=0;n=document.createElement("div");n.style.position="absolute";n.style.left=n.style.top="-500px";n.style.height=n.style.width="100px";n.style.overflow="hidden";l=document.createElement("div");l.style.width="100%";l.style.height="500px";n.appendChild(l);document.getElementsByTagName("body")[0].appendChild(n);o=n.clientWidth;n.style.overflow="scroll";m=n.clientWidth;document.getElementsByTagName("body")[0].removeChild(n);j=o-m;n=l=null}});a.Package("a5.cl.mvc.core").Static("XMLUtils",function(c){c.parseXML=function(e){var d;if(window.DOMParser){d=(new DOMParser()).parseFromString(e,"text/xml");if(d.documentElement.nodeName==="parsererror"){throw d.documentElement.childNodes[0].nodeValue;return}}else{d=new ActiveXObject("Msxml2.DOMDocument.3.0");d.async="false";d.loadXML(e);if(d.parseError.errorCode!=0){throw ("Error parsing XML. Line "+d.parseError.line+" position "+d.parseError.linePos+"\nError Code: "+d.parseError.errorCode+"\nError Reason: "+d.parseError.reason+"Error Line: "+d.parseError.srcText);return}}if(d.documentElement.textContent&&d.documentElement.textContent.indexOf("This page contains the following errors:")===0){var f=d.documentElement.textContent.replace("This page contains the following errors:","Error parsing XML: ");throw f}return d};c.getElementsByTagNameNS=function(f,e,d,g){if(typeof f.getElementsByTagNameNS==="function"){return f.getElementsByTagNameNS(d,e)}else{return f.getElementsByTagName(g+":"+e)}};c.getNamedItemNS=function(d,f,e,g){if(typeof d.getNamedItemNS==="function"){return d.getNamedItemNS(e,f)}else{return d.getNamedItem(g+":"+f)}};c.localName=function(d){if(typeof d.localName==="string"){return d.localName}else{return(d.tagName?d.tagName:d.name).replace(/.+?:/,"")}};c.children=function(g){if(g.children){return g.children}else{var f=[],d,h,e;for(d=0,h=g.childNodes.length;d<h;d++){e=g.childNodes[d];if(e.nodeType===1){f.push(e)}}return f}};c.getPrefix=function(d){if(typeof d.prefix!=="undefined"){return d.prefix}else{var e=d.tagName?d.tagName.split(":"):d.name.split(":");return(e.length>1?e[0]:null)}}});a.Package("a5.cl.core.viewDef").Import("a5.cl.*","a5.cl.mvc.core.XMLUtils","a5.cl.core.Utils").Extends("a5.cl.CLMVCBase").Static(function(d,c){d._cl_ns="http://corelayerjs.com/";d._cl_nsPrefix="cl";d.getImports=function(j){var g=d.getElementsByTagName(j.documentElement,"Imports"),h=(g&&g.length>0)?d.getElementsByTagName(g[0],"Import"):[],k=[],f,l,e;for(f=0,l=h.length;f<l;f++){e=h[f];k.push(e.getAttribute("ns"))}return a._a5_processImports(k)};d._cl_getEnvironmentNode=function(g,h,f){var k=c.XMLUtils.children(g);for(var e=0,l=k.length;e<l;e++){var j=k[e];if(j.prefix===d._cl_nsPrefix&&c.XMLUtils.localName(j)===h){if(j.getAttribute("value").toUpperCase().indexOf(f)!==-1){return j}}}return null};d._cl_resolveQualifiedClass=function(g,e){var f=a.GetNamespace(g.replace(/_/g,"."));if(typeof e==="object"){e[g]=f}return f};d.getElementsByTagName=function(e,f){return c.XMLUtils.getElementsByTagNameNS(e,f,d._cl_ns,d._cl_nsPrefix)};d.processAttribute=function(p){var h=p.substr(0,8)=="{Single}"?[p.substr(8)]:p.split("|"),q=window.JSON||a.cl.core.JSON,f=/{RegExp}|{Boolean}|{Number}|{Array}|{String}|{Object}|{Namespace}/,g=[],o,n,k,m;for(o=0,n=h.length;o<n;o++){k=h[o];m=f.exec(k);if(c.Utils.isArray(m)){m=m[0]}k=k.replace(f,"");switch(m){case"{Boolean}":g.push(k==="true");break;case"{Number}":g.push(parseInt(k));break;case"{Array}":case"{Object}":g.push(q.parse(k));break;case"{String}":g.push(k+"");break;case"{Namespace}":g.push(a.GetNamespace(k,this._cl_imports));break;case"{RegExp}":var l=k.split("/");g.push(new RegExp(l[1],l[2]));break;default:if(!isNaN(k)){g.push(parseFloat(k))}else{if(k==="true"||k==="false"){g.push(k==="true")}else{if(/(^\[.*\]$)|(\{.*\})$/.test(k)){try{g.push(q.parse(k))}catch(j){g.push(k+"")}}else{g.push(k+"")}}}}}return g}}).Prototype("ViewDefParser",function(d,c,e){d.ViewDefParser=function(g,f){d.superclass(this);this._cl_controller=f;this._cl_xml=(typeof g==="string")?c.XMLUtils.parseXML(g):g;this._cl_rootView=f.view();this._cl_imports=e.getImports(this._cl_xml);this._cl_definitionNode=this._cl_getDefinitionNode();this._cl_defaultsNode=this._cl_getDefaults();if(!this._cl_definitionNode){this.redirect(500,"Unable to find a valid cl:Definition element in the view definition.");return}};d.parse=function(h,g,j){if(this._cl_rootView){this._cl_definitionNode=this._cl_getDefinitionNode()}var k=c.XMLUtils.children(this._cl_definitionNode)[0],f=new a.cl.core.viewDef.ViewBuilder(this._cl_controller,k,this._cl_defaultsNode,this._cl_imports,this._cl_rootView);f.build(function(l){this._cl_rootView=l;if(typeof h==="function"){h.call(j,l)}},function(l){if(typeof g==="function"){g.call(j,l)}},this,this._cl_rootView)};d.hasOrientationOptions=function(){var f=e.getElementsByTagName(this._cl_xml.documentElement,"Orientation");return(f&&f.length>0)};d.hasEnvironmentOptions=function(h){var g=e.getElementsByTagName(this._cl_xml.documentElement,"Environment");if(g&&g.length>0){if(typeof h==="string"){for(var f=0,k=g.length;f<k;f++){var j=g[f];if(c.Utils.arrayIndexOf(j.getAttribute("value").split("|"),h)>-1){return true}}return false}return true}return false};d._cl_getDefaults=function(){var f=e.getElementsByTagName(this._cl_xml.documentElement,"Defaults");return(f&&f.length>0)?f[0]:null};d._cl_getDefinitionNode=function(){var k=this.DOM().clientEnvironment(true).toUpperCase(),n=this.DOM().clientPlatform().toUpperCase(),j=this.DOM().clientOrientation().toUpperCase(),m=e.getElementsByTagName(this._cl_xml.documentElement,"Definition"),h=(m&&m.length>0)?m[0]:null,l=e._cl_getEnvironmentNode(h,"Environment",k);if(h&&l){var f=e._cl_getEnvironmentNode(l,"Platform",n);if(f){var g=e._cl_getEnvironmentNode(f,"Orientation",j);if(g.length>0){return g}else{return f}}else{var g=e._cl_getEnvironmentNode(l,"Orientation",j);if(g){return g}else{return l}}}else{return h}}});a.Package("a5.cl.core.viewDef").Import("a5.cl.mvc.core.XMLUtils","a5.cl.core.Utils","a5.cl.CLView").Extends("a5.cl.CLMVCBase").Static(function(d,c){d._cl_isInternalNodeType=function(g){var f=["Imports","Defaults","Definition","Environment","Platform","Orientation"];if(g.prefix!==c.ViewDefParser._cl_nsPrefix||g.namespaceURI!==c.ViewDefParser._cl_ns){return false}for(var e=0,h=f.length;e<h;e++){if(c.XMLUtils.localName(g)===f[e]){return true}}return false}}).Prototype("ViewBuilder",function(e,c,d){this.Properties(function(){this._cl_xml=null;this._cl_defaults=null;this._cl_imports=null;this._cl_rootView=null;this._cl_ids=null;this._cl_id=null;this._cl_view=null;this._cl_childIndex=0;this._cl_children=null;this._cl_viewName=null;this._cl_viewReadyCallback=null;this._cl_buildCompleteCallback=null;this._cl_callbackScope;this._cl_isCustomNode=false});e.ViewBuilder=function(g,h,l,f,k,j){e.superclass(this);this._cl_controller=g;this._cl_xml=h;this._cl_defaults=l;this._cl_imports=f;this._cl_rootView=k;this._cl_ids=j||[];this._cl_children=c.XMLUtils.children(h);this._cl_viewName=c.XMLUtils.localName(h)};e.build=function(q,h,u,r){this._cl_viewReadyCallback=q;this._cl_buildCompleteCallback=h;this._cl_callbackScope=u;var l=this._cl_xml,p=c.ViewDefParser._cl_ns,g=c.ViewDefParser._cl_nsPrefix;if(r instanceof c.CLView){var n=l.attributes.getNamedItem("_isCustomNode");if(n){this._cl_isCustomNode=n.value==="true"}this._cl_viewCreated(r)}else{var m=l.namespaceURI===p&&l.prefix===g,t=c.ViewBuilder._cl_isInternalNodeType(l);if(m&&!t){var k=l.attributes.getNamedItem("id");if(k){this._cl_id=k.value}r=this._cl_findChild(this._cl_id);if(r instanceof c.CLView&&c.Utils.arrayIndexOf(this._cl_ids,this._cl_id)===-1){this._cl_viewCreated(r)}else{if(!this._cl_id||c.Utils.arrayIndexOf(this._cl_ids,this._cl_id)===-1){var s=this._cl_imports[this._cl_viewName]||c.ViewDefParser._cl_resolveQualifiedClass(this._cl_viewName,this._cl_imports);if(!s){this.redirect(500,'Error parsing the view definition for controller "'+this._cl_controller.namespace()+'". '+c.XMLUtils.localName(l)+" could not be found. 							Make sure this class was imported into the view definition and included in the dependencies.");return}var f=c.XMLUtils.getNamedItemNS(l.attributes,"Construct",p,g),o=f?c.ViewDefParser.processAttribute(f.value):[];r=a.Create(s,o);if(r instanceof c.CLView){this._cl_viewCreated(r)}else{if(r instanceof a.cl.CLController){var j=r;r=null;j.id(this._cl_id);this._cl_compileCustomNodes(j);this._cl_controller._cl_childControllers.push(j);j.generateView(this._cl_viewCreated,this)}}}else{this.redirect(500,"Error: Duplicate id ("+this._cl_id+') found in view definition for controller "'+this._cl_controller.namespace()+'".');return}}}else{if(typeof this._cl_buildCompleteCallback==="function"){this._cl_buildCompleteCallback.call(this._cl_callbackScope,null)}}}};e._cl_viewCreated=function(f){this._cl_view=f;f._cl_fromViewDef=true;f._cl_vdViewIsReady=false;if(!this._cl_rootView){this._cl_rootView=f;f._cl_controller=this._cl_controller}if(this._cl_id){f.id(this._cl_id)}this._cl_ids.push(f.id());if(!f._cl_controller||f===this._cl_rootView){this._cl_removeViewDefViews();this._cl_resetViewProperties();this._cl_compileCustomNodes()}this._cl_applyAttributeTree();if(typeof this._cl_viewReadyCallback==="function"){this._cl_viewReadyCallback.call(this._cl_callbackScope,f)}this._cl_childIndex=0;f._cl_pendingChildren=this._cl_children.length;this._cl_buildNextChild()};e._cl_buildNextChild=function(){if(this._cl_children&&this._cl_childIndex<this._cl_children.length){this._cl_view._cl_buildingFromViewDef=true;var m=this._cl_children[this._cl_childIndex],l=this._cl_view._cl_controller instanceof a.cl.CLController&&this._cl_view!==this._cl_rootView,g=l?this._cl_view._cl_controller.constructor._cl_customViewDefNodes:this._cl_view.constructor._cl_customViewDefNodes,f=l?this._cl_view._cl_controller:this._cl_view,k=this._cl_view===this._cl_rootView?this._cl_compileCustomNodes(this._cl_controller):[],j=c.XMLUtils.localName(m);if(c.Utils.arrayContains(g,j)||c.Utils.arrayContains(k,j)){var n=this._cl_convertNodeToObject(m);if(c.Utils.arrayContains(k,j)){f=this._cl_controller}f.processCustomViewDefNode(n._name,n,this._cl_imports,this._cl_defaults,this._cl_rootView);this._cl_childIndex++;if(this._cl_view._cl_vdViewAdded&&!this._cl_isCustomNode){this._cl_view._cl_vdViewAdded()}this._cl_buildNextChild();return}else{if(!l||this._cl_view===this._cl_rootView){var h=new c.ViewBuilder(this._cl_controller,m,this._cl_defaults,this._cl_imports,this._cl_rootView,this._cl_ids);h.build(this._cl_viewReadyHandler,this._cl_buildCompleteHandler,this)}else{this.throwError("Error parsing view definition for "+this._cl_controller.id()+".  Views cannot be applied to the controller '"+this._cl_view._cl_controller.id()+"'.  Use a separate view definition to define the view structure for each controller.");return}}}else{if(this._cl_view._cl_vdViewReady&&!this._cl_view._cl_vdViewIsReady){this._cl_view._cl_vdViewReady()}if(typeof this._cl_buildCompleteCallback==="function"){this._cl_buildCompleteCallback.call(this._cl_callbackScope,this._cl_view)}this._cl_view.suspendRedraws(false);this.destroy()}};e._cl_findChild=function(k){if(typeof k!=="string"||!this._cl_rootView){return null}var j=this._cl_rootView.getChildView(k),f,h,g;if(j){return j}for(f=0,h=this._cl_controller._cl_orphanage.length;f<h;f++){g=this._cl_controller._cl_orphanage[f];if(g.id()===k){return g}}return this._cl_controller.getChildController(k)};e._cl_viewReadyHandler=function(f){if(f){this._cl_view.addSubViewAtIndex(f,this._cl_childIndex);if(f._cl_controller){this._cl_view._cl_vdViewAdded()}}};e._cl_buildCompleteHandler=function(f){this._cl_childIndex++;this._cl_buildNextChild()};e._cl_removeViewDefViews=function(g){if(!g){g=this._cl_view}if(!(g instanceof a.cl.CLViewContainer)||!g._cl_fromViewDef){return}var j=g._cl_childViews.slice(0),f,k,h;for(f=0,k=j.length;f<k;f++){h=j[f];if(h._cl_fromViewDef){this._cl_controller._cl_orphanage.push(h);this._cl_removeViewDefViews(h);g.removeSubView(h,false)}}};e._cl_resetViewProperties=function(){var f=this._cl_view;for(var g in f._cl_viewDefDefaults){if(c.Utils.arrayIndexOf(f.skipViewDefReset,g)===-1){if(typeof f[g]==="function"){f[g].call(f,f._cl_viewDefDefaults[g])}else{f[g]=f._cl_viewDefDefaults[g]}}}};e._cl_applyAttributeTree=function(){var g=this._cl_defaults;if(g){this._cl_applyDefaults(g);var o=this.DOM().clientEnvironment(true).toUpperCase(),n=this.DOM().clientPlatform().toUpperCase(),h=this.DOM().clientOrientation().toUpperCase();var k=this._cl_applyEnvironmentDefaults(g,"Environment",o);for(var l=0,j=k.length;l<j;l++){this._cl_applyEnvironmentDefaults(k[l],"Orientation",h)}var m=[];for(var l=0,j=k.length;l<j;l++){var f=this._cl_applyEnvironmentDefaults(k[l],"Platform",n);m.push.apply(m,f)}for(var l=0,j=m.length;l<j;l++){this._cl_applyEnvironmentDefaults(m[l],"Orientation",h)}}this._cl_applyAttributes(this._cl_xml)};e._cl_applyEnvironmentDefaults=function(m,j,g){var h=[],l=c.XMLUtils.children(m);for(var f=0,n=l.length;f<n;f++){var k=l[f];if(k.prefix===c.ViewDefParser._cl_nsPrefix&&c.XMLUtils.localName(k)===j){if(k.getAttribute("value").toUpperCase().indexOf(g)!==-1){this._cl_applyDefaults(k);h.push(k)}}}return h};e._cl_applyDefaults=function(j){var h=c.XMLUtils.children(j);for(var f=0,k=h.length;f<k;f++){var g=h[f];if(c.XMLUtils.localName(g)===this._cl_viewName){this._cl_applyAttributes(g)}}};e._cl_applyAttributes=function(j){var g,l,f,h,k;for(var g=0,l=j.attributes.length;g<l;g++){f=j.attributes[g];h=c.XMLUtils.localName(f);if(h!=="id"&&c.XMLUtils.getPrefix(f)!==c.ViewDefParser._cl_nsPrefix){k=(this._cl_view._cl_controller&&typeof this._cl_view._cl_controller[c.XMLUtils.localName(f)]!=="undefined")?this._cl_view._cl_controller:this._cl_view;if(typeof k[h]==="function"){if(!k._cl_viewDefDefaults[h]){k._cl_viewDefDefaults[h]=k[h].apply(k,this._cl_getParamsForRetrievingDefault(h))}k[h].apply(k,c.ViewDefParser.processAttribute(f.value))}else{if(!k._cl_viewDefDefaults[h]){k._cl_viewDefDefaults[h]=k[h]}k[h]=c.ViewDefParser.processAttribute(f.value)[0]}}}};e._cl_getParamsForRetrievingDefault=function(f){switch(f){case"width":case"height":return["value"];default:return[]}};e._cl_compileCustomNodes=function(j){var f=j||this._cl_view,g=f.constructor,h=[];if(c.Utils.isArray(f.constructor._cl_customViewDefNodes)){return f.constructor._cl_customViewDefNodes}while(g!==null){var k=g.customViewDefNodes||[];Array.prototype.push.apply(h,k);g=g.superclass&&g.superclass().constructor.namespace?g.superclass().constructor:null}f.constructor._cl_customViewDefNodes=h;return h};e._cl_convertNodeToObject=function(g){var h={};h._name=c.XMLUtils.localName(g);h.node=g;for(var f=0,k=g.attributes.length;f<k;f++){var j=g.attributes[f];h[j.name]=c.ViewDefParser.processAttribute(j.value);if(h[j.name].length===1){h[j.name]=h[j.name][0]}}g.setAttribute("_isCustomNode","true");return h}});a.Package("a5.cl.mvc.core").Extends("a5.cl.CLMVCBase").Class("Filters","singleton final",function(d){var e;this.Filters=function(){d.superclass(this);e=["_cl_appPlaceholder"]};this.addFilter=function(k,j){var h=j||false;if(typeof h==="number"){e.splice(h,0,k)}else{if(h){e.push(k)}else{e.unshift(k)}}};this.addAppFilters=function(j){var m;for(var k=0,h=e.length;k<h;k++){if(e[k]==="_cl_appPlaceholder"){m=k;e.splice(k,1);break}}if(j){for(var k=0,h=j.length;k<h;k++){this.addFilter(j[k],m);m++}}};this.test=function(k,h,j){g(k,"before",function(l){if(l){if(h){g(h,"after",function(m){j(m)})}else{j(true)}}else{j(false)}})};var g=function(o,k,p){var j=true;var n=true;var l=0;function m(){l++;h()}function h(){if(l<e.length){if(n){var q=e[l];if(c(o.controller,q.controller)){if(!o.action||q.action==null||q.action==b||c(o.action,q.action)){j=false;f(o,q,k,function(r){n=r;m()})}else{m()}}else{m()}}}else{if(j){p(true)}else{p(n)}}}h()};var c=function(j,h){if(h=="*"||h==j){return true}else{return false}};var f=function(m,j,l,n){var k=false;if(j[l]){k=true;var h={pass:function(){n(true)},fail:function(){n(false)},hash:m.hash,controller:m.controller,action:m.action,id:m.id};j[l].call(d,h)}if(!k){n(true)}}});a.Package("a5.cl.mvc.core").Import("a5.cl.core.Instantiator").Extends("a5.cl.CLMVCBase").Class("Mappings","singleton final",function(f,e){var k,c,h=null,d=["controller","action","id"];this.Mappings=function(){f.superclass(this);k=["_cl_appPlaceholder"];c=["_cl_appPlaceholder"]};this.addMapping=function(m,o){var l=o||false,n=m.controller?e.Instantiator.instance().getClassInstance("Controller",m.controller,true):null;if(n){if(!(n instanceof a.cl.CLController)){this.throwError("Unable to instantiate the controller "+m.controller);return}else{if(n.instanceCount()>1){this.throwError("Cannot add a mapping to a controller with multiple instances ("+n.namespace()+").");return}}n.setMappable()}if(typeof m.desc==="number"){if(m.controller){if(l){c.push(m)}else{c.unshift(m)}}}else{if(typeof m.desc==="string"){m.desc=m.desc.split("/");if(m.desc[0]===""){m.desc.shift()}}else{f.throwError('invalid mapping: "desc" param must be a string')}if(typeof l==="number"){k.splice(l,0,m)}else{if(l){k.push(m)}else{k.unshift(m)}}}};this.addAppMappings=function(q){var p,o;for(var n=0,m=k.length;n<m;n++){if(k[n]==="_cl_appPlaceholder"){p=n;k.splice(n,1);break}}for(var n=0,m=c.length;n<m;n++){if(c[n]==="_cl_appPlaceholder"){o=n;c.splice(n,1);break}}if(q){for(var n=0,m=q.length;n<m;n++){if(typeof q[n].desc==="number"){this.addMapping(q[n],o);o++}else{this.addMapping(q[n],p);p++}}}};this.getCallSignature=function(l){var m=j(l);if(m){m.hash=l.join("/");h=m;return m}else{return null}};this.geLastCallSignature=function(){return h};this.getErrorSignature=function(n){for(var o=0,m=c.length;o<m;o++){if(c[o].desc==n){return{controller:c[o].controller,action:c[o].action,id:c[o].id}}}return null};var j=function(o){var q=(typeof o=="object"?o:[o]);for(var n in q){if(q[n]==b){q[n]=""}}if(!q.length){q=[""]}var u=null;for(var r=0,p=k.length;r<p;r++){var t=g(k[r],q);if(t){var s={controller:k[r].controller||null,action:k[r].action||null,id:k[r].id||null};for(var n in t){if(s[n]==b){s[n]=t[n]}}if(s.id==null){s.id=[]}var m=true;if(k[r].constraints){m=k[r].constraints(s.controller,s.action,s.id)}if(m){u=s}}if(u){break}}return u};var g=function(n,r){var t={},y=false,z=false;for(var v=0,q=n.desc.length;v<q;v++){var x=n.desc[v].indexOf(":")==0;if(x){var u=n.desc[v].indexOf("?")==n.desc[v].length-1;var p=false,w=n.desc[v].substr(1,n.desc[v].length-(u?2:1));if(!u&&v>=r.length){return null}for(var s=0,o=d.length;s<o;s++){if(w==d[s]){p=y=true;if(v>=r.length){if(!u){y=false}}else{if(d[s]=="id"){if(r.length===1&&r[0]===""&&!u){y=false}else{t.id=r.slice(v);z=true}}else{t[d[s]]=r[v]}}break}}if(!p){y=true;t[w]=r[v];t.customParams=true}}else{y=(v<r.length&&n.desc[v]==r[v]);if(!y){return null}}}if(y){if(!z&&r.length>n.desc.length){return null}else{for(var v=0,q=d.length;v<q;v++){if(n[d[v]]){t[d[v]]=n[d[v]]}}return t}}else{return null}}});a.Package("a5.cl.mvc.core").Extends("a5.cl.CLMVCBase").Class("GarbageCollector","singleton final",function(e,c){var f=document.createElement("div"),h=0,d=10;this.GarbageCollector=function(){e.superclass(this)};this.destroyElement=function(k,l){if(!a.cl.core.Utils.isArray(k)){k=[k]}for(var j=0,m=k.length;j<m;j++){g(k[j])}if(h>=d||l===true){f.innerHTML="";h=0}};var g=function(j){try{f.appendChild(j);h++}catch(k){}}});a.Package("a5.cl.mvc.mixins").Mixin("CSS3Props",function(c){c.MustExtend("a5.cl.CLView");c.CSS3Props=function(){};c._cl_processCSS3Prop=function(f,d,e){if(e===true){return a.cl.initializers.dom.Utils.getCSSProp(f)!==null}return this._cl_css(f,e,true)};c.rotation=function(d){return this._cl_processCSS3Prop("transform",(d===true),"rotate("+d+"deg)",true)};c.maskImage=function(d){return this._cl_processCSS3Prop("maskImage",(d===true),"url("+d+")",true)};c.shadow=function(d){return this._cl_processCSS3Prop("boxShadow",(d===true),d,true)}});a.Package("a5.cl").Import("a5.cl.CLEvent").Static(function(c){c.CONTENT_UPDATED="clHTMLViewContentUpdated"}).Extends("CLView").Prototype("CLHTMLView",function(d,c,e){e.customViewDefNodes=["HTML"];this.Properties(function(){this._cl_pendingWrapperProps={};this._cl_currentWrapperProps={};this._cl_handleAnchors=false;this._cl_disallowHrefs=false;this._cl_scrollWidth=null;this._cl_scrollHeight=null;this._cl_cachedHTML=null;this._cl_loadURL=null;this._cl_clickHandlingEnabled=false;this._cl_isInDocument=false;this._cl_htmlViewReady=false});d.CLHTMLView=function(f,g){d.superclass(this);this.clickHandlingEnabled(true);this.width("100%").height("100%");if(f!==b){if(g){this.loadURL(f)}else{this.drawHTML(f)}}};d.Override.viewReady=function(){d.superclass().viewReady.call(this);if(this._cl_cachedHTML!==null){this.drawHTML(this._cl_cachedHTML);this._cl_cachedHTML=null}};d.Override.processCustomViewDefNode=function(k,g,f,j,h){if(k==="HTML"){if(this.viewIsReady()){this.drawHTML(g.node.textContent)}else{this._cl_cachedHTML=g.node.textContent}}else{self.superclass().processCustomViewDefNode.apply(this,arguments)}};d.htmlWrapper=function(){return this._cl_viewElement};d.elemID=function(f){this._cl_viewElement.id=f};d.htmlViewReady=function(){return this._cl_htmlViewReady};d.clickHandlingEnabled=function(g){if(typeof g==="boolean"){if(g!==this._cl_clickHandlingEnabled){var f=this}this._cl_viewElement.onclick=!g?null:function(h){f._cl_handleClicks.call(f,h||window.event)};this._cl_clickHandlingEnabled=g;return this}return this._cl_clickHandlingEnabled};d._cl_handleClicks=function(k){var j=k.target||k.srcElement,g,f,h;if(j&&j.tagName.toUpperCase()==="A"){g=j.href;f=g?g.indexOf("#"):null;h=false;if(typeof g!=="undefined"){if(f===0||g.substr(0,f-1)===this.DOM().appPath(true)){h=true}if(this._cl_handleAnchors&&h){this.scrollToAnchor(g.substr(f+1));return false}else{if(this._cl_disallowHrefs){return false}return this.handleHrefClick(g)}}}};d.handleAnchors=function(f){if(typeof f==="boolean"){this._cl_handleAnchors=f}return this._cl_handleAnchors};d.scrollToAnchor=function(j){var m=this._cl_viewElement.getElementsByTagName("a"),h,k,g;for(k=0,g=m.length;k<g;k++){if(m[k].getAttribute("name")===j){h=m[k];break}}try{if(h){var f=0;var o=h;do{if(o==this._cl_viewElement){break}f+=o.offsetTop}while(o=o.parentNode);this.parentView().scrollY(f-h.offsetHeight)}}catch(n){}};d.disallowHrefs=function(f){if(typeof f==="boolean"){this._cl_disallowHrefs=f}return this._cl_disallowHrefs};d.handleHrefClick=function(f){return true};d.drawHTML=function(g,f){this._cl_htmlViewReady=false;if(g===""){g=" "}if(f&&typeof f==="object"){var h=this.plugins().getRegisteredProcess("htmlTemplate");if(h){g=h.populateTemplate(g,f)}}this._cl_replaceNodeValue(this._cl_viewElement,g);return this};d.drawElement=function(f){var g=f!=="input",j=this.instanceUID()+"_CLHtmlViewElement",h=document.createElement(this._qbr_elementType);h.id=j;if(g){h.style.height="100%";h.style.width="100%"}this.drawHTML(h);return j};d.loadURL=function(g){this._cl_htmlViewReady=false;if(typeof g=="string"){this._cl_loadURL=g;var f=this;this.cl().initializer().load(g,function(h){f.drawHTML(h)});return this}return this._cl_loadURL};d.clearHTML=function(){while(this._cl_viewElement.childNodes.length){this._cl_destroyElement(this._cl_viewElement.firstChild)}this.htmlUpdated();return this};d.appendChild=function(f){this._cl_viewElement.appendChild(f);this.htmlUpdated();return this};d.css=function(h,g,f){f=f||false;if(f){h=a.cl.initializers.dom.Utils.getCSSProp(h)}if(h){this._cl_viewElement.style[h]=g}return this};d.cssClass=function(f){if(typeof f==="string"){this._cl_viewElement.className=f;return this}return this._cl_viewElement.className};d.htmlUpdated=function(f){if(f!==false){this._cl_scrollWidth=this._cl_scrollHeight=null}if((this._cl_height.auto||this._cl_width.auto)&&this.parentView()){this.parentView().redraw()}};d.Override.width=function(f){if(f==="scroll"||f==="content"){this._cl_scrollWidth=this._cl_viewElement.scrollWidth-this._cl_calculatedClientOffset.width;return f==="content"?this._cl_scrollWidth:Math.max(this._cl_scrollWidth+this._cl_calculatedClientOffset.left+this._cl_calculatedOffset.left,this.width("offset"))}return d.superclass().width.apply(this,arguments)};d.Override.height=function(f){if(f==="scroll"||f==="content"){this._cl_scrollHeight=this._cl_viewElement.scrollHeight-this._cl_calculatedClientOffset.height;return f==="content"?this._cl_scrollHeight:Math.max(this._cl_scrollHeight+this._cl_calculatedClientOffset.top+this._cl_calculatedOffset.top,this.height("offset"))}return d.superclass().height.apply(this,arguments)};d.Override._cl_redraw=function(j,h){var k=d.superclass()._cl_redraw.call(this,j,true);if(k.shouldRedraw){this._cl_pendingViewElementProps.paddingTop=this._cl_calculatedClientOffset.top+"px";this._cl_pendingViewElementProps.paddingRight=this._cl_calculatedClientOffset.right+"px";this._cl_pendingViewElementProps.paddingBottom=this._cl_calculatedClientOffset.bottom+"px";this._cl_pendingViewElementProps.paddingLeft=this._cl_calculatedClientOffset.left+"px";this._cl_pendingViewElementProps.width=Math.max(0,this._cl_intFromPX(this._cl_pendingViewElementProps.width)-this._cl_calculatedClientOffset.width)+"px";this._cl_pendingViewElementProps.height=Math.max(0,this._cl_intFromPX(this._cl_pendingViewElementProps.height)-this._cl_calculatedClientOffset.height)+"px";if(h!==true){this._cl_render()}if(!this._cl_isInDocument&&a.cl.initializers.dom.Utils.elementInDocument(this._cl_viewElement)){this._cl_isInDocument=true;if(this._cl_viewElement.innerHTML!==""&&(this._cl_width.auto||this._cl_height.auto)){var g=[];for(var f=0,l=this._cl_viewElement.childNodes.length;f<l;f++){g.push(this._cl_viewElement.childNodes[f])}this._cl_replaceNodeValue(this._cl_viewElement,g)}}}return k};d._cl_intFromPX=function(f){return parseInt(f.replace(/px$/i,""))};d._cl_dispatchUpdated=function(){var f=this;this.async(function(){this._cl_htmlViewReady=true;this.dispatchEvent(e.CONTENT_UPDATED)},null,200)};d._cl_replaceNodeValue=function(k,l){var g=this,j=null,f=function(){if(k.innerHTML!==""&&document.getElementById(this.instanceUID())){if(m){k.style.width="auto"}if(h){k.style.height="auto"}j.cancel();g._cl_dispatchUpdated.call(g);g.htmlUpdated.call(g,false)}};var m=(k===this._cl_viewElement)?this._cl_width.auto:(k.style.width==="auto"),h=(k===this._cl_viewElement)?this._cl_height.auto:(k.style.height==="auto");if(m){k.style.width=0}if(h){k.style.height=0}while(k.childNodes.length){k.removeChild(k.firstChild)}this._cl_scrollWidth=this._cl_scrollHeight=null;if(l!=""){j=this.cycle(f,null,0.2,1000)}else{g._cl_dispatchUpdated();this.htmlUpdated(false)}if(typeof l=="string"){k.innerHTML=l}else{if(a.cl.core.Utils.isArray(l)){while(l.length){k.appendChild(l.shift())}}else{k.appendChild(l)}if(m){k.style.width="auto"}if(h){k.style.height="auto"}}};d.dealloc=function(){this._cl_viewElement.onclick=null}});a.Package("a5.cl").Extends("CLView").Import("a5.ContractAttribute","a5.cl.mvc.CLViewContainerEvent").Static(function(c){c.redrawLog={};c.logRedraw=function(d){var e=d.instanceUID();if(c.redrawLog[e]){c.redrawLog[e]++}else{c.redrawLog[e]=1}};c.getRedrawCounts=function(){var f=[];for(var h in c.redrawLog){f.push({id:h,count:c.redrawLog[h]})}f.sort(function(k,j){return j.count-k.count});for(var e=0,g=f.length;e<g;e++){var d=f[e]}};c.clearRedrawLog=function(){c.redrawLog={}};c.viewAffectsAutoWidth=function(d){return(d.visible()&&d._cl_width.percent===false&&d._cl_width.relative===false&&d._cl_alignX!=="right")||(d._cl_minWidth!==null&&d._cl_width.inner<=d._cl_minWidth)};c.viewAffectsAutoHeight=function(d){return(d.visible()&&d._cl_height.percent===false&&d._cl_height.relative===false&&d._cl_alignY!=="bottom")||(d._cl_minHeight!==null&&d._cl_height.inner<=d._cl_minHeight)}}).Prototype("CLViewContainer",function(e,c,d){this.Properties(function(){this._cl_childViews=[];this._cl_queuedLoads=[];this._cl_relX=false;this._cl_relY=false;this._cl_outerW=null;this._cl_outerH=null;this._cl_lockedVal=false;this._cl_pendingChildren=0;this._cl_isInitialVDReady=true;this._cl_constrainChildren=false;this._cl_scrollXEnabled={value:false,state:false};this._cl_scrollYEnabled={value:false,state:false};this._cl_passDataToChildren=true;this._cl_passedData=null;this._cl_scrollLeftVal=null;this._cl_scrollTopVal=null;this._cl_childViewTarget=this});e.CLViewContainer=function(){e.superclass(this)};e.constrainChildren=function(f){return this._cl_propGetSet("_cl_constrainChildren",f)};e.passDataToChildren=function(f){return this._cl_propGetSet("_cl_passDataToChildren",f)};e.Override.renderFromData=function(h){if(this._cl_passDataToChildren){this._cl_passedData=h;for(var g=0,f=this._cl_childViews.length;g<f;g++){this._cl_childViews[g].renderFromData(h)}}a.cl.CLViewContainer.superclass().renderFromData.apply(this,arguments)};e.relX=function(h){if(h!==b){this._cl_relX=h;if(h===false){for(var g=0,f=this._cl_childViews.length;g<f;g++){this._cl_childViews[g]._cl_x.state=false}}else{if(this.relY()){this.relY(false)}}this.redraw();return this}return this._cl_relX};e.relY=function(h){if(h!==b){this._cl_relY=h;if(h===false){for(var g=0,f=this._cl_childViews.length;g<f;g++){this._cl_childViews[g]._cl_y.state=false}}else{if(this.relX()){this.relX(false)}}this.redraw();return this}return this._cl_relY};e.scrollXEnabled=function(f){if(f!==b){if(f==="state"){return this._cl_scrollXEnabled.state}this._cl_scrollXEnabled.value=f;return this}return this._cl_scrollXEnabled.value};e.scrollYEnabled=function(f){if(f!==b){if(f==="state"){return this._cl_scrollYEnabled.state}this._cl_scrollYEnabled.value=f;return this}return this._cl_scrollYEnabled.value};e.scrollY=function(h,g){if(h!==b){var f;if(typeof h==="number"){f=h}else{f=h.y(true)}if(g!==b){f+=g}this._cl_scrollTopVal=f;this.redraw();return f}else{return this._cl_viewElement.scrollTop}};e.scrollX=function(h,g){if(h!==b){var f;if(typeof h==="number"){f=h}else{f=h.y(true)}if(g!==b){f+=g}this._cl_scrollLeftVal=f;this.redraw();return f}else{return this._cl_viewElement.scrollLeft}};e.subViewCount=function(){return this._cl_childViewTarget._cl_childViews.length};e.subViewAtIndex=function(f){return this._cl_childViewTarget._cl_childViews[f]};e.subViewWithName=function(g){for(var h=0,f=this._cl_childViewTarget._cl_childViews.length;h<f;h++){if(this._cl_childViewTarget._cl_childViews[h].mvcName()==g){return this._cl_childViewTarget._cl_childViews[h]}}return null};e.subViewToTop=function(f){if(!this._cl_childViewTarget._cl_lockedVal){this._cl_childViewTarget._cl_childViews.splice(f.index(),1);this._cl_childViewTarget._cl_childViews.push(f);this._cl_childViewTarget._cl_orderChildren()}else{this._cl_throwLockedError()}};e.subViewToBottom=function(f){if(!this._cl_childViewTarget._cl_lockedVal){this._cl_childViewTarget._cl_childViews.splice(f.index(),1);this._cl_childViewTarget._cl_childViews.unshift(f);this._cl_childViewTarget._cl_orderChildren()}else{this._cl_throwLockedError()}};e._cl_orderChildren=function(){var j=false;for(var h=0,f=this._cl_childViews.length;h<f;h++){var k=this._cl_childViews[h],g=k._cl_viewElement;if(g.parentElement!==this._cl_viewElement){j=true;this._cl_viewElement.appendChild(g)}if(k._cl_pendingViewElementProps.zIndex!==h){j=true;k._cl_pendingViewElementProps.zIndex=h}}if(j){this.redraw(true)}};e._cl_addChildView=function(g,f,j){if(!this._cl_lockedVal){if(!(this instanceof a.cl.mvc.core.WindowContainer)&&g instanceof a.cl.CLWindow){this.throwError("Cannot add a CLWindow to a generic view container.");return}if(g.parentView() instanceof a.cl.CLViewContainer&&g.parentView()!==this){g.parentView().removeSubView(g,false)}var h=(typeof f=="number")?f:null;if(h>this._cl_childViews.length-1){h=null}this.willAddView(g);g.draw(this);this.viewAdded(g);g._cl_setParent(this);g._cl_addedToParent(this);if(j){j(g)}if(h!==null){this._cl_childViews.splice(h,0,g)}else{this._cl_childViews.push(g)}this._cl_orderChildren();if(this._cl_passDataToChildren&&this._cl_passedData){g.renderFromData(this._cl_passedData)}}else{this._cl_throwLockedError()}};e.containsSubView=function(g){for(var h=0,f=this._cl_childViewTarget._cl_childViews.length;h<f;h++){if(this._cl_childViewTarget._cl_childViews[h]==g){return true}}return false};e.removeSubView=function(h,g){if(!this._cl_childViewTarget._cl_lockedVal){var k=g===false?false:true;for(var j=0,f=this._cl_childViewTarget._cl_childViews.length;j<f;j++){if(this._cl_childViewTarget._cl_childViews[j]===h){this.willRemoveView(h);this.dispatchEvent(a.cl.mvc.CLViewContainerEvent.WILL_REMOVE_VIEW,{view:h});this._cl_childViewTarget._cl_childViews.splice(j,1);h._cl_parentView=null;h._cl_removedFromParent(this);if(h._cl_viewElement&&h._cl_viewElement.parentNode===this._cl_viewElement){this._cl_childViewTarget._cl_viewElement.removeChild(h._cl_viewElement)}this.viewRemoved(h);this.dispatchEvent(a.cl.mvc.CLViewContainerEvent.VIEW_REMOVED,{view:h});if(k===true){h.destroy()}if(this._cl_childViewTarget._cl_relX||this._cl_childViewTarget._cl_relY||this._cl_childViewTarget._cl_width.auto||this._cl_childViewTarget._cl_height.auto){this.redraw()}return}}this.warn("Unable to remove subview "+(h.id()||h.instanceUID())+".  Subview is not a child of the view container.")}else{this._cl_throwLockedError()}};e.removeAllSubViews=function(f){while(this.subViewCount()){this.removeViewAtIndex(0,f)}return this};e.removeViewAtIndex=function(h,g){var f=this._cl_childViewTarget._cl_childViews[h];this.removeSubView(f,g)};e.replaceView=function(j,k){var h;for(var g=0,f=this._cl_childViewTarget._cl_childViews.length;g<f;g++){if(this._cl_childViewTarget._cl_childViews[g]===h){h=this._cl_childViewTarget._cl_childViews[g]}break}if(h){this.replaceViewAtIndex(k,h.index())}else{this.redirect(500,"cannot replace view "+(h.id()||h.instanceUID())+", view is not a child of container "+this.instanceUID())}};e.replaceViewAtIndex=function(g,f){this.removeViewAtIndex(f);this.addSubViewAtIndex(g,f)};e.swapViewsAtIndex=function(g,f){if(!this._cl_lockedVal){var j=this._cl_childViewTarget._cl_childViews,h=j.length;if(g<0){g=0}if(f<0){f=0}if(g>h-1){g=h-1}if(f>h-1){g=h-1}if(g!=f){var k=j[g];j[g]=j[f];j[f]=k;this._cl_childViewTarget._cl_orderChildren()}}else{this._cl_throwLockedError()}};e.addSubView=this.Attributes(["Contract",{view:"a5.cl.CLView",callback:"function=null"}],function(f){if(f){this._cl_childViewTarget._cl_addChildView(f.view,null,f.callback)}});e.addSubViewAtIndex=function(f,g,h){this._cl_childViewTarget._cl_addChildView(f,g,h)};e.addSubViewBelow=function(f,g,h){this.addSubViewAtIndex(f,(parseInt(g.index())-1),h)};e.addSubViewAbove=function(f,g,h){this.addSubViewAtIndex(f,(parseInt(g.index())+1),h)};e.Override.width=function(f){if(f==="scroll"){return Math.max(this._cl_width.content+this._cl_calculatedClientOffset.left+this._cl_calculatedOffset.left,this._cl_width.offset)}else{return e.superclass().width.apply(this,arguments)}};e.Override.height=function(f){if(f==="scroll"){return Math.max(this._cl_height.content+this._cl_calculatedClientOffset.top+this._cl_calculatedOffset.top,this._cl_height.offset)}else{return e.superclass().height.apply(this,arguments)}};e.Override.redrawComplete=function(h){e.superclass().redrawComplete.apply(this,arguments);for(var g=0,f=this._cl_childViews.length;g<f;g++){this._cl_childViews[g].redrawComplete()}};e.Override.suspendRedraws=function(h,g){if(typeof h==="boolean"){for(var f=0,j=this.subViewCount();f<j;f++){this.subViewAtIndex(f).suspendRedraws(h,true)}}return e.superclass().suspendRedraws.call(this,h)};e.Override._cl_redraw=function(g,n){var m=this._cl_redrawPending,w=e.superclass()._cl_redraw.call(this,g,true),y=a.cl.mvc.core.EnvManager.instance().scrollBarWidth(),s=c.CLView._cl_viewCanRedraw(this),u=false,z=false;if(s){this._cl_width.inner=this._cl_width.client-(this._cl_scrollYEnabled.state?y:0);this._cl_height.inner=this._cl_height.client-(this._cl_scrollXEnabled.state?y:0);m=m||w.force;var B=0,k=0,q,o,A,j,v,t,h=false,r=false,x=false,f=false,p=[],o=null;for(v=0,t=this._cl_childViews.length;v<t;v++){q=this._cl_childViews[v];if(q.visible()){if(((this._cl_height.auto||this._cl_scrollYEnabled.value)&&q._cl_height.percent!==false)||((this._cl_width.auto||this._cl_scrollXEnabled.value)&&q._cl_width.percent!==false)){p.push(q)}if(this._cl_relX||this._cl_relY){if(o){if(this._cl_relX){q._cl_x.state=o.x(true)+q.x()+o.width()}if(this._cl_relY){q._cl_y.state=o.y(true)+q.y()+o.height()}}else{if(this._cl_relX){q._cl_x.state=q.x()}if(this._cl_relY){q._cl_y.state=q.y()}}}q._cl_redraw(true,true);if(d.viewAffectsAutoWidth(q)){A=q.width()+q.x(true);if(A>B){B=A}}if(d.viewAffectsAutoHeight(q)){j=q.height()+q.y(true);if(j>k){k=j}}o=q}}u=true;z=true;this._cl_height.content=k;this._cl_width.content=B;for(v=0,t=p.length;v<t;v++){q=p[v];if((q._cl_width.percent!==false&&u)||(q._cl_height.percent!==false&&z)){q._cl_redraw(g||m,true)}}if(this._cl_width.auto!==false||this._cl_height.auto!==false){e.superclass()._cl_redraw.call(this,true,true);this._cl_height.content=k;this._cl_width.content=B;this._cl_alertParentOfRedraw()}if(this._cl_scrollXEnabled.value&&B>this._cl_width.client+this._cl_calculatedClientOffset.right){h=true}if(this._cl_scrollYEnabled.value&&k>this._cl_height.client+this._cl_calculatedClientOffset.bottom){r=true}if((this._cl_scrollXEnabled.value&&this._cl_scrollYEnabled.value)&&y>0&&((h&&!r)||(r&&!h))){if(r&&(this._cl_width.client-y)<B){h=true}else{if(h&&(this._cl_height.client-y)<k){r=true}}}if(r!==this._cl_scrollYEnabled.state){this._cl_scrollYEnabled.state=r;this._cl_pendingViewElementProps.overflowY=r?"auto":(this._cl_showOverflow?"visible":"hidden");f=true}if(h!==this._cl_scrollXEnabled.state){this._cl_scrollXEnabled.state=h;this._cl_pendingViewElementProps.overflowX=h?"auto":(this._cl_showOverflow?"visible":"hidden");x=true}if(f||x){this._cl_pendingViewElementProps.webkitOverflowScrolling=(h||r)?"touch":"none"}this._cl_width.inner=this._cl_width.client-(this._cl_scrollYEnabled.state?y:0);this._cl_height.inner=this._cl_height.client-(this._cl_scrollXEnabled.state?y:0);if(y>0&&(x||f)){for(v=0,t=this._cl_childViews.length;v<t;v++){this._cl_childViews[v]._cl_redraw(true)}}else{for(v=0,t=this._cl_childViews.length;v<t;v++){this._cl_childViews[v]._cl_render()}}if(n!==true){this._cl_render()}}return w};e.Override._cl_render=function(){e.superclass()._cl_render.call(this);if(this._cl_scrollLeftVal){this._cl_viewElement.scrollLeft=this._cl_scrollLeftVal;this._cl_scrollLeftVal=null}if(this._cl_scrollTopVal){this._cl_viewElement.scrollTop=this._cl_scrollTopVal;this._cl_scrollTopVal=null}};e._cl_locked=function(f){return this._cl_propGetSet("_cl_lockedVal",f,"boolean")};e._cl_throwLockedError=function(){this.redirect(500,"Error: attempted to modify child views on a structure locked view.")};e._cl_childRedrawn=function(f,l){var j=this._cl_width.auto!==false&&(l.width||l.x)&&d.viewAffectsAutoWidth(f),p=this._cl_height.auto!==false&&(l.height||l.y)&&d.viewAffectsAutoHeight(f),m=this._cl_relX&&(l.width||l.x),k=this._cl_relY&&(l.height||l.y),o=this._cl_scrollXEnabled.value&&(l.width||l.x),n=this._cl_scrollYEnabled.value&&(l.height||l.y),g=f._cl_alignY!=="top"&&(l.height||l.y),h=f._cl_alignX!=="left"&&(l.width||l.x);if(j||p||m||k||o||n||h||g){this.redraw(true)}};e.Override._cl_addedToTree=function(){e.superclass()._cl_addedToTree.call(this);for(var f=0;f<this.subViewCount();f++){this.subViewAtIndex(f)._cl_addedToTree()}};e.Override._cl_removedFromTree=function(){e.superclass()._cl_removedFromTree.call(this);for(var f=0;f<this.subViewCount();f++){this.subViewAtIndex(f)._cl_removedFromTree()}};e.getChildView=function(k){var f,j,h,g;for(f=0,j=this.subViewCount();f<j;f++){h=this.subViewAtIndex(f);if(h._cl_controller){continue}if(h.id()===k){return h}g=h instanceof d?h.getChildView(k):false;if(g){return g}}return null};e.getChildViews=function(){return this._cl_childViews.slice(0)};e.getMaximumViewDepth=function(){var f=0;if(this.subViewCount()>0){(function(j,k){k++;if(k>f){f=k}for(var g=0,l=j.subViewCount();g<l;g++){var h=j.subViewAtIndex(g);if(h.subViewCount()>0){arguments.callee.call(this,h)}}})(this,0)}return f};e.Override._cl_vdViewReady=function(){this.childrenReady(this._cl_isInitialVDReady);this._cl_isInitialVDReady=this._cl_buildingFromViewDef=false;e.superclass()._cl_vdViewReady.call(this)};e._cl_vdViewAdded=function(){this._cl_pendingChildren--;if(this._cl_pendingChildren<=0){this._cl_vdViewReady()}};e.childrenReady=function(f){this.dispatchEvent(c.CLViewContainerEvent.CHILDREN_READY)};e.willAddView=function(f){};e.willRemoveView=function(f){};e.viewRemoved=function(){};e.viewAdded=function(){};e.dealloc=function(){this._cl_lockedVal=false;this.removeAllSubViews(true)}});a.Package("a5.cl").Extends("CLViewContainer").Prototype("CLWindow",function(d,c){this.Properties(function(){this._cl_windowLevel=a.cl.CLWindowLevel.APPLICATION;this._cl_isRootWindow=false});d.CLWindow=function(){d.superclass(this);this._cl_width.percent=this._cl_height.percent=1;this._cl_width.value=this._cl_height.value="100%";d.backgroundColor.call(this,"#fff")};d.isRootWindow=function(){return this._cl_isRootWindow};d.application=function(){return this.MVC().application()};d.Override.moveToParentView=function(e){this.throwError("moveToParentView is not a valid manipulation method on a5.cl.CLWindow.")};d.didFinishLoading=function(e){};d.Override.hide=function(){if(!this.isRootWindow()){a.cl.CLWindow.superclass().hide.call(this)}};d._cl_setRootWindow=function(){this._cl_isRootWindow=true}});a.Package("a5.cl").Static(function(c){c.APPLICATION="Application";c.MODAL="Modal";c.CONTEXT="Context";c.ALERT="Alert";c.SYSTEM="System"}).Class("CLWindowLevel",function(){});a.Package("a5.cl").Import("a5.cl.core.viewDef.ViewDefParser").Extends("CLMVCBase").Mix("a5.cl.mixins.Binder").Prototype("CLController",function(d,c,e){e.ASSUME_XML_VIEW="clControllerAssumeXMLView";this.Properties(function(){this._cl_view=null;this._cl_mappable=false;this._cl_defaultViewDef=null;this._cl_viewDefDefaults=[];this._cl_viewDefParser=null;this._cl_viewDefCallback=null;this._cl_viewDefCallbackScope=null;this._cl_defaultViewDef=null;this._cl_viewReadyPending=true;this._cl_renderTarget=null;this._cl_orphanage=[];this._cl_childControllers=[];this._cl_id=null;this._cl_viewIsInTree=false;this._cl_viewAddedToTreePending=false});d.CLController=function(f){var g=e.instance();if(g&&g._cl_mappable){this.throwError("Cannot create multiple instances of a controller which has a mapping associated with it.");return}d.superclass(this);this._cl_setMVCName(this.className().replace("Controller",""));if(f===e.ASSUME_XML_VIEW){this.defaultViewDefinition(e.ASSUME_XML_VIEW)}else{if(typeof f==="string"){this.defaultViewDefinition(f)}else{if(f instanceof a.cl.CLView){this._cl_viewCreated(f);this._cl_viewReady()}else{if(f===true){this._cl_viewCreated(new a.cl.CLViewContainer());this._cl_viewReady()}}}}};d.index=function(f){this.render(f)};d.view=function(){return this._cl_view};d.id=function(f){if(typeof f==="string"){this._cl_id=f;return this}return this._cl_id||this.instanceUID()};d.generateView=function(l,j){if(this._cl_view){if(typeof l==="function"){l.call(j,this._cl_view)}}else{var k=/<.+>/.test(this._cl_defaultViewDef);if(k){this._cl_buildViewDef(this._cl_defaultViewDef,l,j)}else{var g,h=false,f=this;if(this._cl_defaultViewDef){if(this._cl_defaultViewDef===e.ASSUME_XML_VIEW){h=true;g=this.MVC().pluginConfig().applicationViewPath+this.mvcName()+".xml"}else{g=((this._cl_defaultViewDef.indexOf("://")==-1&&this._cl_defaultViewDef.charAt(0)!=="/")?this.MVC().pluginConfig().applicationViewPath:"")+this._cl_defaultViewDef}this.cl().initializer().load(g,function(m){f._cl_buildViewDef(m,l,j)},null,function(m){if(h){f._cl_viewCreated(new a.cl.CLViewContainer());f._cl_viewReady();l.call(j,f._cl_view)}else{f.redirect(404,g)}})}else{this._cl_viewCreated(new a.cl.CLViewContainer());this._cl_viewReady();if(typeof l==="function"){l.call(j,this._cl_view)}}}}};d.viewReady=function(){};d.renderInto=function(f,g){this.generateView(function(h){this._cl_finalizeRender(f,h,g)},this)};d.render=function(f,h){var h=typeof f==="function"?f:h,g;this.generateView(function(j){g=this._cl_renderTarget||j;this._cl_finalizeRender(g,f,h)},this)};d._cl_finalizeRender=function(h,f,j){if(f instanceof a.cl.CLWindow){h=a.cl.mvc.core.AppViewContainer.instance()}if(f instanceof a.cl.CLView){if(!h.containsSubView(f)){if(!(h instanceof a.cl.mvc.core.AppViewContainer)){h.removeAllSubViews(false);h.addSubView(f)}else{h.addWindow(f)}}this._cl_renderComplete(j)}else{if(f instanceof e){var g=this;f.generateView(function(k){if(!h.containsSubView(k)){h.removeAllSubViews(false);h.addSubView(k)}g._cl_renderComplete(j)})}else{this._cl_renderComplete(j)}}};d._cl_renderComplete=function(f){if(this._cl_mappable){this.MVC().application().dispatchEvent(c.CLMVCEvent.RENDER_CONTROLLER,{controller:this},false)}if(f){f.call(this,this._cl_view)}};d.renderTarget=function(f){if(f!==b){this._cl_renderTarget=f;return this}return this._cl_renderTarget||this._cl_view};d.Override.bind=function(k,j,l,f,g,h){d.mixins().bind.call(this,k,j,l,f,g,h)};d.defaultViewDefinition=function(f){if(typeof f==="string"){this._cl_defaultViewDef=f;return this}return this._cl_defaultViewDef};d.getChildController=function(j){var f,h,g;for(f=0,h=this._cl_childControllers.length;f<h;f++){g=this._cl_childControllers[f];if(g.id()===j){return g}}return null};d.orientationChanged=function(f){if(this._cl_viewDefParser&&this._cl_viewDefParser.hasOrientationOptions()){this._cl_viewDefParser.parse()}};d.clientEnvironmentUpdated=function(f){if(this._cl_viewDefParser&&this._cl_viewDefParser.hasEnvironmentOptions()){this._cl_viewDefParser.parse()}};d.processCustomViewDefNode=function(k,g,f,j,h){};d.setMappable=function(){if(e.instanceCount()>1){return this.throwError("Cannot call setMappable on a controller with multiple instances.")}this._cl_mappable=true};d._cl_buildViewDef=function(h,g,f){this._cl_viewDefCallback=g;this._cl_viewDefCallbackScope=f;this._cl_viewDefParser=new c.ViewDefParser(h,this);this._cl_viewDefParser.parse(this._cl_viewCreated,this._cl_viewDefComplete,this)};d._cl_viewCreated=function(f){this._cl_view=f;f.addOneTimeEventListener(a.Event.DESTROYED,this._cl_viewDestroyedHandler,false,this);f._cl_controller=this};d._cl_viewDestroyedHandler=function(f){this._cl_view=null};d._cl_viewDefComplete=function(f){if(this._cl_viewDefCallback){this._cl_viewDefCallback.call(this._cl_viewDefCallbackScope,f)}this._cl_viewReady()};d._cl_viewReady=function(){if(this._cl_viewReadyPending){this._cl_viewReadyPending=false;this.viewReady();if(this._cl_viewAddedToTreePending){this._cl_viewAddedToTreePending=false;this._cl_viewAddedToTree()}}};d._cl_viewAddedToTree=function(){if(this._cl_viewReadyPending){this._cl_viewAddedToTreePending=true}else{if(!this.bindingsConnected()){this.setBindingEnabled(true)}this.cl().addEventListener(c.CLEvent.CLIENT_ENVIRONMENT_UPDATED,this.clientEnvironmentUpdated,false,this);this.cl().addEventListener(c.CLEvent.ORIENTATION_CHANGED,this.orientationChanged,false,this);this._cl_viewIsInTree=true;this.viewAddedToTree()}};d.viewAddedToTree=function(){};d._cl_viewRemovedFromTree=function(){if(this._cl_bindingsConnected){this.setBindingEnabled(false)}this.cl().removeEventListener(c.CLEvent.CLIENT_ENVIRONMENT_UPDATED,this.clientEnvironmentUpdated);this.cl().removeEventListener(c.CLEvent.ORIENTATION_CHANGED,this.orientationChanged);this._cl_viewIsInTree=false;this.viewRemovedFromTree()};d.viewRemovedFromTree=function(){};d.viewIsInTree=function(){return this._cl_viewIsInTree};d.dealloc=function(){if(this.view()){this.view().destroy()}}});a.Package("a5.cl").Extends("CLController").Prototype("CLApplication",function(d,c){this.Properties(function(){this._cl_activePresenter=null;this._cl_rootWindow=null});d.CLApplication=function(){d.superclass(this);this.addEventListener(a.cl.CLMVCEvent.RENDER_CONTROLLER,this._cl_eRenderControllerHandler,false,this);this.cl().addOneTimeEventListener(c.CLEvent.APPLICATION_WILL_RELAUNCH,this.applicationWillRelaunch);this.cl().addEventListener(c.CLEvent.ONLINE_STATUS_CHANGE,this.onlineStatusChanged);this.cl().addOneTimeEventListener(c.CLEvent.APPLICATION_CLOSED,this.applicationClosed);this.cl().addOneTimeEventListener(c.CLEvent.AUTO_INSTANTIATION_COMPLETE,this.autoInstantiationComplete);this.cl().addOneTimeEventListener(c.CLEvent.APPLICATION_WILL_LAUNCH,this.applicationWillLaunch);this.cl().addOneTimeEventListener(c.CLEvent.APPLICATION_LAUNCHED,this.applicationLaunched);this._cl_view=new a.cl.mvc.core.AppViewContainer();this.viewReady();return[false]};d.addWindow=function(e){return this.view().addWindow(e)};d.removeWindow=function(e,f){return this.view().removeWindow(e,f)};d.containsWindow=function(e){return this.view().containsWindow(e)};d.backgroundColor=function(e){if(e){document.body.style.backgroundColor=e;return this}return document.body.style.backgroundColor};d.activePresenter=function(){return this._cl_activePresenter};d.Override.viewReady=function(){};d.activePresenterChanged=function(e){};d.onlineStatusChanged=function(e){};d.autoInstantiationComplete=function(){};d.rootWindowLoaded=function(e){if(!this._cl_renderTarget){this._cl_renderTarget=e}this._cl_rootWindow=e};d.applicationWillLaunch=function(){};d.applicationLaunched=function(){};d.applicationWillClose=function(){};d.applicationClosed=function(){};d.applicationWillRelaunch=function(){};d.rootWindow=function(){return this._cl_rootWindow};d._cl_renderError=function(j,n,g){if(!this._cl_errorStopped){var k=n.replace(/\n/g,"<br/>")+"<br/>";if(j===500){if(g){if(g.line&&g.url){k+=g.url+", "+g.line+"<br/>"}if(g.stack&&typeof g.stack=="object"){if(g.stack.length){k+="<br/><br/>Call Stack ["+g.stack.length+"]:<br/>";for(var h=0,e=g.stack.length;h<e;h++){k+=unescape(g.stack[h])+"<br/>"}}else{k+="<br/><br/>Call stack not supported."}}}}var m=new a.cl.mvc.core.SystemWindow();this.addWindow(m);m.scrollYEnabled(true).scrollXEnabled(true);var f=a.Create(a.cl.CLHTMLView);f.height("auto").padding(30).alignX("center").alignY("middle");m.addSubView(f);f.drawHTML('<div style="margin:0px auto;text-align:center;font-family:Arial;">					<div style="border-bottom: 1px solid;font-family: Arial;font-size: 20px;font-weight: bold;margin-bottom: 10px;">					A5 CL: '+j+' Error					</div>					<div style="text-align:left;margin-bottom:50px;">'+k+"</div></div>");if(j==500){this._cl_errorStopped=true;a.cl.core.GlobalUpdateTimer.instance()._cl_killTimer()}}};d._cl_eRenderControllerHandler=function(g){this.render(g.data().controller.view());var f=this._cl_activePresenter;this._cl_activePresenter=g.data().controller;if(f!==this._cl_activePresenter){this.activePresenterChanged(this._cl_activePresenter)}}});a.Package("a5.cl.plugins.hashManager").Import("a5.cl.CLEvent").Extends("a5.cl.CLPlugin").Class("HashManager","singleton final",function(r,p,s){var e,d,g,l,q;r.HashManager=function(){r.superclass(this);g=null;e=null;l=false;r.configDefaults({delimiter:"#!"})};r.Override.initializePlugin=function(){k();q=r.pluginConfig().delimiter;if(h(true)==""){j(q)}};r.initialize=function(){r.cl().addEventListener(p.CLEvent.APPLICATION_LAUNCHED,m)};r.getHash=function(t){if(t===true){return e}else{var u=e.split("/");u.shift();return u}};r.setHash=function(x,y,w){var u="";if(x instanceof Array){x=x.join("/")}if(x==null||x=="/"){x=""}if(w===true||(x!==e&&x!==h())){r.dispatchEvent(p.CLHashEvent.HASH_WILL_CHANGE,{hashArray:x});if(x==""){j(q,false,y)}else{if(typeof x=="object"){for(var v=0,t=x.length;v<t;v++){if(x[v]==b&&x[v]==null){x.splice(v,1);t=x.length;v--}}for(v=0,t=x.length;v<t;v++){u+=(x[v]+(v<x.length-1?"/":""))}}else{u=x}if(u.substr(0,1)=="/"){u=u.substr(1)}if(u.substr(0,q.length)!=q){u=q+"/"+u}if(y===true){e=u}j(u,false,y)}if(w){l=true;f()}}};var o=function(u){u=u.substring(q.length);u=((u.indexOf("?")!==-1)?u.substr(0,u.indexOf("?")):u);var t=u.split("/");if(t[0]===""){t.shift()}return t},m=function(){f();var t=r.DOM().clientPlatform()==="IE"&&r.DOM().browserVersion()<9;if("onhashchange" in window&&!t){window.onhashchange=f}else{r.cl().addEventListener(p.CLEvent.GLOBAL_UPDATE_TIMER_TICK,f)}},f=function(){var u=h();if(u!=e||l){l=false;e=u;if(g&&e!=null){j(e)}var t=o(e);r.dispatchEvent(p.CLHashEvent.HASH_CHANGE,{hashArray:t})}},h=function(t){var v;if(g){try{if(e!=location.hash){v=location.hash}else{v=c().body.innerText}}catch(u){v=e||""}}else{v=location.hash}return v},k=function(){if(r.DOM().clientPlatform()=="IE"&&r.DOM().browserVersion()<8){n()}else{if(history.navigationMode){history.navigationMode="compatible"}}},j=function(u,t,x){if(x){if(history.replaceState){history.replaceState({},document.title,u);return}else{e=q}}var w=t||false;if(!w){location.hash=u}if(g){var v=c();v.open();v.write("<html><body>"+u+"</body></html>");v.close()}},n=function(){g=document.createElement("iframe");g.style.display="none";document.getElementsByTagName("head")[0].appendChild(g)},c=function(){return(g.contentDocument)?g.contentDocument:g.Document}});a.Package("a5.cl.plugins.hashManager").Extends("a5.cl.CLEvent").Prototype("CLHashEvent",function(d,c,e){e.HASH_CHANGE="clHashChangeEvent";e.HASH_WILL_CHANGE="clHashWillChangeEvent";d.CLHashEvent=function(){d.superclass(this)}});a.Package("a5.cl.mvc").Import("a5.cl.CLEvent","a5.cl.CLMVCEvent","a5.cl.plugins.hashManager.CLHashEvent").Extends("a5.cl.CLAddon").Class("MVC",function(d,n,p){var k,w,t,s,m,g,q,f,u,e,j=true,r;d.MVC=function(){d.superclass(this);d.configDefaults({rootController:null,rootViewDef:null,applicationViewPath:"views/",mobileWidthThreshold:768,rootWindow:null,titleDelimiter:": "});d.createMainConfigMethod("filters");d.createMainConfigMethod("mappings")};this.rootController=function(){return r};this.rootWindow=function(){return u};this.application=function(){return g};this.mappings=function(){return k};this.filters=function(){return w};this.hash=function(){return s};this.redrawEngine=function(){return t};this.locationManager=function(){return m};this.garbageCollector=function(){return q};this.envManager=function(){return f};this.triggerAppRedraw=function(){this.redrawEngine().triggerAppRedraw()};this.addFilter=function(z,y){return this.MVC().filters().addFilter(z,y)};this.addMapping=function(z,y){return this.MVC().mappings().addMapping(z,y)};this.setRedirectRewriter=function(y){e=y};this.controller=function(){return r};this.applicationRenderTarget=function(y){if(y!==b){g.renderTarget(y);return this}return g.renderTarget()};d.Override.initializePlugin=function(){var y=a.GetNamespace(d.cl().applicationPackage(true)+".Application");if(y){g=new y();if(!g instanceof a.cl.CLApplication){throw"Error: application must extend a5.cl.CLApplication."}}else{g=new a.cl.CLApplication()}t=new a.cl.mvc.core.RedrawEngine();f=new a.cl.mvc.core.EnvManager();k=new a.cl.mvc.core.Mappings();w=new a.cl.mvc.core.Filters();s=d.plugins().HashManager();q=new a.cl.mvc.core.GarbageCollector();m=new a.cl.mvc.core.LocationManager();g.view().initialize();m.addEventListener("CONTROLLER_CHANGE",c);s.addEventListener(n.CLHashEvent.HASH_CHANGE,x);d.cl().addOneTimeEventListener(n.CLEvent.DEPENDENCIES_LOADED,v);d.cl().addOneTimeEventListener(n.CLEvent.APPLICATION_WILL_LAUNCH,h);d.cl().addEventListener(n.CLEvent.ERROR_THROWN,l);document.getElementsByTagName("body")[0].style.margin="0px";d.application().view().draw();d.cl().addOneTimeEventListener(n.CLEvent.APPLICATION_PREPARED,o)};var o=function(){if(d.DOM().clientEnvironment()=="MOBILE"){a.cl.mvc.core.AppSetup.mobileSetup()}else{if(d.DOM().clientEnvironment()=="TABLET"){a.cl.mvc.core.AppSetup.tabletSetup()}else{if(d.DOM().clientEnvironment()=="DESKTOP"){a.cl.mvc.core.AppSetup.desktopSetup()}}}var y=d.getMainConfigProps("filters");w.addAppFilters(y);var z=d.getMainConfigProps("mappings");k.addAppMappings(z)};this.windowProps=function(){return f.windowProps()};this.redirect=function(B,A,z,C){if(m){if(e){B=e(B,A,z,C)}return m.redirect(B,A,z,C)}else{if(B===500){var y=A instanceof a.Error;if(y&&!A.isWindowError()){this.throwError(A)}else{throw A}}}};d.setTitle=function(A,y){var B=d.cl().appName(),z=d.MVC().pluginConfig().titleDelimiter;if(A!==b&&A!=""){if(y===true){B=B+z+A}else{if(y!==b){B=B+y+A}else{B=A}}}document.title=B};var l=function(y){d.redirect(y)};var v=function(){f.windowProps(true)};var h=function(){s.initialize();document.body.tabIndex=0;document.body.focus();document.body.removeAttribute("tabIndex");u.didFinishLoading(d.application())};var c=function(B){var A,z=B.data(),y=z.action?z.action:"index";if(z.controller instanceof a.cl.CLController){A=z.controller}else{A=d.cl()._core().instantiator().getClassInstance("Controller",z.controller,true)}if(!A){d.redirect(500,"Error trying to instantiate controller "+z.controller+', controller does not exist in package "'+d.cl().applicationPackage(true)+'.controllers".');return}d.dispatchEvent(n.CLMVCEvent.PRIMARY_CONTROLLER_WILL_CHANGE,z);if(!A._cl_mappable){A.setMappable()}if(typeof A[y]==="function"){if(z.customParams){A[y].call(A,z)}else{A[y].apply(A,(z.id||[]))}}else{d.redirect(500,'Error calling action "'+y+'" on controller "'+z.controller+'", action not defined.')}if(j){j=false;a.cl.mvc.core.AppViewContainer.instance()._cl_initialRenderCompete();d.dispatchEvent(n.CLMVCEvent.INITIAL_CONTROLLER_LOADED,z)}r=A;d.dispatchEvent(n.CLMVCEvent.PRIMARY_CONTROLLER_CHANGED,z)};var x=function(y){m.processMapping(y.data().hashArray)};d.Override.initializeAddOn=function(){var C=false,A=d.pluginConfig();var y=function(){if(A.rootWindow){var F=applicationPackage+".views."+A.rootWindow;if(a.GetNamespace(F)){windowSourceLoaded(F)}else{d.throwError('root window specified in namespace "'+F+'" does not exist.')}}else{E(a.cl.CLWindow)}};var E=function(F){u=new F();r._cl_view=u;D()};var D=function(){u._cl_setRootWindow();d.application().addWindow(u);B()};var B=function(){if(u){d.application().rootWindowLoaded(u)}if(C){d.dispatchEvent(a.cl.CLAddon.INITIALIZE_COMPLETE)}};var z;if(A.rootController){if(A.rootController.indexOf(".")!==-1){r=a.Create(a.GetNamespace(A.rootController))}else{r=d.cl()._core().instantiator().createClassInstance(A.rootController,"Controller")}if(!r||!(r instanceof a.cl.CLController)){d.redirect(500,'Invalid rootController specified, "'+A.rootController+'" controller does not exist in application package "'+d.cl().applicationPackage(true)+'.controllers".');return}z=r.namespace()}else{a.Package("a5.cl.mvc.core").Extends("a5.cl.CLController").Class("RootController",function(F){F.RootController=function(){F.superclass(this)};F.Override.index=function(){F.redirect(500,"No mapping created for default '/' mapping.")}});r=new a.cl.mvc.core.RootController();z="a5.cl.mvc.core.RootController"}d.addMapping({desc:"/",controller:z},true);if(A.rootViewDef){r.defaultViewDefinition(A.rootViewDef);C=!(/<.+>/.test(A.rootViewDef));r.generateView(function(F){u=F;D()})}else{y()}return C}})})(a5);